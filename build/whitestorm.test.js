/**
 * Â© Alexander Buzin, 2014-2015
 * Site: http://alexbuzin.me/
 * Email: alexbuzin88@gmail.com
*/

function Events(e){var t={},n=[];e=e||this,e.on=function(e,n,r){(t[e]=t[e]||[]).push([n,r])},e.off=function(e,r){e||(t={});for(var a=t[e]||n,o=a.length=r?a.length:0;o--;)r==a[o][0]&&a.splice(o,1)},e.emit=function(e){for(var r,a=t[e]||n,o=0;r=a[o++];)r[0].apply(r[1],n.slice.call(arguments,1))}}function addCSSRule(e,t,n,r){e.insertRule?e.insertRule(t+"{"+n+"}",r):e.addRule&&e.addRule(t,n,r)}var THREE=require("three"),jQuery=require("jquery"),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};THREE.AnaglyphEffect=function(e,t,n){var r,a,o,i,s=new THREE.Matrix4,c=new THREE.Matrix4,l=125,u=new THREE.PerspectiveCamera;u.matrixAutoUpdate=!1;var m=new THREE.PerspectiveCamera;m.matrixAutoUpdate=!1;var p=new THREE.OrthographicCamera(-1,1,1,-1,0,1),d=new THREE.Scene,h={minFilter:THREE.LinearFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat};void 0===t&&(t=512),void 0===n&&(n=512);var f=new THREE.WebGLRenderTarget(t,n,h),E=new THREE.WebGLRenderTarget(t,n,h),v=new THREE.ShaderMaterial({uniforms:{mapLeft:{type:"t",value:f},mapRight:{type:"t",value:E}},vertexShader:["varying vec2 vUv;","void main() {","	vUv = vec2( uv.x, uv.y );","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D mapLeft;","uniform sampler2D mapRight;","varying vec2 vUv;","void main() {","	vec4 colorL, colorR;","	vec2 uv = vUv;","	colorL = texture2D( mapLeft, uv );","	colorR = texture2D( mapRight, uv );","	gl_FragColor = vec4( colorL.g * 0.7 + colorL.b * 0.3, colorR.g, colorR.b, colorL.a + colorR.a ) * 1.1;","}"].join("\n")}),g=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),v);d.add(g),this.setSize=function(t,n){f&&f.dispose(),E&&E.dispose(),f=new THREE.WebGLRenderTarget(t,n,h),E=new THREE.WebGLRenderTarget(t,n,h),v.uniforms.mapLeft.value=f,v.uniforms.mapRight.value=E,e.setSize(t,n)},this.render=function(t,n){t.updateMatrixWorld(),void 0===n.parent&&n.updateMatrixWorld();var h=r!==n.aspect||a!==n.near||o!==n.far||i!==n.fov;if(h){r=n.aspect,a=n.near,o=n.far,i=n.fov;var v,g,y=n.projectionMatrix.clone(),w=l/30*.5,T=w*a/l,b=a*Math.tan(THREE.Math.degToRad(.5*i));s.elements[12]=w,c.elements[12]=-w,v=-b*r+T,g=b*r+T,y.elements[0]=2*a/(g-v),y.elements[8]=(g+v)/(g-v),u.projectionMatrix.copy(y),v=-b*r-T,g=b*r-T,y.elements[0]=2*a/(g-v),y.elements[8]=(g+v)/(g-v),m.projectionMatrix.copy(y)}u.matrixWorld.copy(n.matrixWorld).multiply(c),u.position.copy(n.position),u.near=n.near,u.far=n.far,e.render(t,u,f,!0),m.matrixWorld.copy(n.matrixWorld).multiply(s),m.position.copy(n.position),m.near=n.near,m.far=n.far,e.render(t,m,E,!0),e.render(d,p)},this.dispose=function(){f&&f.dispose(),E&&E.dispose()}},THREE.BufferGeometryUtils={computeTangents:function(e){function t(e,t,n){h.fromArray(i,3*e),f.fromArray(i,3*t),E.fromArray(i,3*n),v.fromArray(c,2*e),g.fromArray(c,2*t),y.fromArray(c,2*n);var r=f.x-h.x,a=E.x-h.x,o=f.y-h.y,s=E.y-h.y,l=f.z-h.z,u=E.z-h.z,d=g.x-v.x,b=y.x-v.x,H=g.y-v.y,R=y.y-v.y,x=1/(d*R-b*H);w.set((R*r-H*a)*x,(R*o-H*s)*x,(R*l-H*u)*x),T.set((d*a-b*r)*x,(d*s-b*o)*x,(d*u-b*l)*x),m[e].add(w),m[t].add(w),m[n].add(w),p[e].add(T),p[t].add(T),p[n].add(T)}function n(e){j.fromArray(s,3*e),W.copy(j),O=m[e],L.copy(O),L.sub(j.multiplyScalar(j.dot(O))).normalize(),A.crossVectors(W,O),C=A.dot(p[e]),P=0>C?-1:1,u[4*e]=L.x,u[4*e+1]=L.y,u[4*e+2]=L.z,u[4*e+3]=P}var r=e.index,a=e.attributes;if(null===r||void 0===a.position||void 0===a.normal||void 0===a.uv)return void console.warn("THREE.BufferGeometry: Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");var o=r.array,i=a.position.array,s=a.normal.array,c=a.uv.array,l=i.length/3;void 0===a.tangent&&e.addAttribute("tangent",new THREE.BufferAttribute(new Float32Array(4*l),4));for(var u=a.tangent.array,m=[],p=[],d=0;l>d;d++)m[d]=new THREE.Vector3,p[d]=new THREE.Vector3;var h=new THREE.Vector3,f=new THREE.Vector3,E=new THREE.Vector3,v=new THREE.Vector2,g=new THREE.Vector2,y=new THREE.Vector2,w=new THREE.Vector3,T=new THREE.Vector3,b=e.groups;0===b.length&&(b=[{start:0,count:o.length}]);for(var H=0,R=b.length;R>H;++H)for(var x=b[H],S=x.start,_=x.count,k=S,M=S+_;M>k;k+=3)t(o[k+0],o[k+1],o[k+2]);for(var P,O,C,L=new THREE.Vector3,A=new THREE.Vector3,j=new THREE.Vector3,W=new THREE.Vector3,H=0,R=b.length;R>H;++H)for(var x=b[H],S=x.start,_=x.count,k=S,M=S+_;M>k;k+=3)n(o[k+0]),n(o[k+1]),n(o[k+2])}},function(e){"undefined"!=typeof e.event&&!function(){var t=function(){var t=this,n=e(this).data("mousestop");this.movement=!0,n.timeToStop&&(this.timeToStopTimer=window.setTimeout(function(){t.movement=!1,window.clearTimeout(t.timer)},n.timeToStop))},n=function(){window.clearTimeout(this.timer),window.clearTimeout(this.timeToStopTimer)},r=function(){var t=e(this),n=t.data("mousestop");this.movement&&(window.clearTimeout(this.timer),this.timer=window.setTimeout(function(){t.trigger("mousestop")},n.delay))},a=function(t){return e.isNumeric(t)?t={delay:t}:"object"!==("undefined"==typeof t?"undefined":_typeof(t))&&(t={}),e.extend({},e.fn.mousestop.defaults,t)};e.event.special.mousestop={setup:function(o){e(this).data("mousestop",a(o)).bind("mouseenter.mousestop",t).bind("mouseleave.mousestop",n).bind("mousemove.mousestop",r)},teardown:function(){e(this).removeData("mousestop").unbind(".mousestop")}},e.fn.mousestop=function(e,t){return"function"==typeof e&&(t=e),arguments.length>0?this.bind("mousestop",e,t):this.trigger("mousestop")},e.fn.mousestop.defaults={delay:300,timeToStop:null}}()}(jQuery),THREE.OrbitControls=function(e,t){function n(){return 2*Math.PI/60/60*p.autoRotateSpeed}function r(){return Math.pow(.95,p.zoomSpeed)}function a(e){if(p.enabled!==!1){if(e.preventDefault(),0===e.button){if(p.noRotate===!0)return;M=k.ROTATE,h.set(e.clientX,e.clientY)}else if(1===e.button){if(p.noZoom===!0)return;M=k.DOLLY,w.set(e.clientX,e.clientY)}else if(2===e.button){if(p.noPan===!0)return;M=k.PAN,v.set(e.clientX,e.clientY)}p.domElement.addEventListener("mousemove",o,!1),p.domElement.addEventListener("mouseup",i,!1)}}function o(e){if(p.enabled!==!1){e.preventDefault();var t=p.domElement===document?p.domElement.body:p.domElement;if(M===k.ROTATE){if(p.noRotate===!0)return;f.set(e.clientX,e.clientY),E.subVectors(f,h),p.rotateLeft(2*Math.PI*E.x/t.clientWidth*p.rotateSpeed),p.rotateUp(2*Math.PI*E.y/t.clientHeight*p.rotateSpeed),h.copy(f)}else if(M===k.DOLLY){if(p.noZoom===!0)return;T.set(e.clientX,e.clientY),b.subVectors(T,w),b.y>0?p.dollyIn():p.dollyOut(),w.copy(T)}else if(M===k.PAN){if(p.noPan===!0)return;g.set(e.clientX,e.clientY),y.subVectors(g,v),p.pan(y),v.copy(g)}p.update()}}function i(){p.enabled!==!1&&(p.domElement.removeEventListener("mousemove",o,!1),p.domElement.removeEventListener("mouseup",i,!1),M=k.NONE)}function s(e){if(p.enabled!==!1&&p.noZoom!==!0){var t=0;e.wheelDelta?t=e.wheelDelta:e.detail&&(t=-e.detail),t>0?p.dollyOut():p.dollyIn()}}function c(e){if(p.enabled!==!1&&p.noKeys!==!0&&p.noPan!==!0){var t=!1;switch(e.keyCode){case p.keys.UP:p.pan(new THREE.Vector2(0,p.keyPanSpeed)),t=!0;break;case p.keys.BOTTOM:p.pan(new THREE.Vector2(0,-p.keyPanSpeed)),t=!0;break;case p.keys.LEFT:p.pan(new THREE.Vector2(p.keyPanSpeed,0)),t=!0;break;case p.keys.RIGHT:p.pan(new THREE.Vector2(-p.keyPanSpeed,0)),t=!0}t&&p.update()}}function l(e){if(p.enabled!==!1)switch(e.touches.length){case 1:if(p.noRotate===!0)return;M=k.TOUCH_ROTATE,h.set(e.touches[0].pageX,e.touches[0].pageY);break;case 2:if(p.noZoom===!0)return;M=k.TOUCH_DOLLY;var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,r=Math.sqrt(t*t+n*n);w.set(0,r);break;case 3:if(p.noPan===!0)return;M=k.TOUCH_PAN,v.set(e.touches[0].pageX,e.touches[0].pageY);break;default:M=k.NONE}}function u(e){if(p.enabled!==!1){e.preventDefault(),e.stopPropagation();var t=p.domElement===document?p.domElement.body:p.domElement;switch(e.touches.length){case 1:if(p.noRotate===!0)return;if(M!==k.TOUCH_ROTATE)return;f.set(e.touches[0].pageX,e.touches[0].pageY),E.subVectors(f,h),p.rotateLeft(2*Math.PI*E.x/t.clientWidth*p.rotateSpeed),p.rotateUp(2*Math.PI*E.y/t.clientHeight*p.rotateSpeed),h.copy(f);break;case 2:if(p.noZoom===!0)return;if(M!==k.TOUCH_DOLLY)return;var n=e.touches[0].pageX-e.touches[1].pageX,r=e.touches[0].pageY-e.touches[1].pageY,a=Math.sqrt(n*n+r*r);T.set(0,a),b.subVectors(T,w),b.y>0?p.dollyOut():p.dollyIn(),w.copy(T);break;case 3:if(p.noPan===!0)return;if(M!==k.TOUCH_PAN)return;g.set(e.touches[0].pageX,e.touches[0].pageY),y.subVectors(g,v),p.pan(y),v.copy(g);break;default:M=k.NONE}}}function m(){p.enabled!==!1&&(M=k.NONE)}this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.target=new THREE.Vector3,this.center=this.target,this.noZoom=!1,this.zoomSpeed=1,this.minDistance=0,this.maxDistance=1/0,this.noRotate=!1,this.rotateSpeed=1,this.noPan=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.noKeys=!1,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40};var p=this,d=1e-6,h=new THREE.Vector2,f=new THREE.Vector2,E=new THREE.Vector2,v=new THREE.Vector2,g=new THREE.Vector2,y=new THREE.Vector2,w=new THREE.Vector2,T=new THREE.Vector2,b=new THREE.Vector2,H=0,R=0,x=1,S=new THREE.Vector3,_=new THREE.Vector3,k={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},M=k.NONE,P={type:"change"};this.rotateLeft=function(e){void 0===e&&(e=n()),R-=e},this.rotateUp=function(e){void 0===e&&(e=n()),H-=e},this.panLeft=function(e){var t=new THREE.Vector3,n=this.object.matrix.elements;t.set(n[0],n[1],n[2]),t.multiplyScalar(-e),S.add(t)},this.panUp=function(e){var t=new THREE.Vector3,n=this.object.matrix.elements;t.set(n[4],n[5],n[6]),t.multiplyScalar(e),S.add(t)},this.pan=function(e){var t=p.domElement===document?p.domElement.body:p.domElement;if(void 0!==p.object.fov){var n=p.object.position,r=n.clone().sub(p.target),a=r.length();a*=Math.tan(p.object.fov/2*Math.PI/180),p.panLeft(2*e.x*a/t.clientHeight),p.panUp(2*e.y*a/t.clientHeight)}else void 0!==p.object.top?(p.panLeft(e.x*(p.object.right-p.object.left)/t.clientWidth),p.panUp(e.y*(p.object.top-p.object.bottom)/t.clientHeight)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")},this.dollyIn=function(e){void 0===e&&(e=r()),x/=e},this.dollyOut=function(e){void 0===e&&(e=r()),x*=e},this.update=function(){var e=this.object.position,t=e.clone().sub(this.target),r=Math.atan2(t.x,t.z),a=Math.atan2(Math.sqrt(t.x*t.x+t.z*t.z),t.y);this.autoRotate&&this.rotateLeft(n()),r+=R,a+=H,a=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,a)),a=Math.max(d,Math.min(Math.PI-d,a));var o=t.length()*x;o=Math.max(this.minDistance,Math.min(this.maxDistance,o)),this.target.add(S),t.x=o*Math.sin(a)*Math.sin(r),t.y=o*Math.cos(a),t.z=o*Math.sin(a)*Math.cos(r),e.copy(this.target).add(t),this.object.lookAt(this.target),R=0,H=0,x=1,S.set(0,0,0),_.distanceTo(this.object.position)>0&&(this.dispatchEvent(P),_.copy(this.object.position))},this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1),this.domElement.addEventListener("mousedown",a,!1),this.domElement.addEventListener("mousewheel",s,!1),this.domElement.addEventListener("DOMMouseScroll",s,!1),this.domElement.addEventListener("keydown",c,!1),this.domElement.addEventListener("touchstart",l,!1),this.domElement.addEventListener("touchend",m,!1),this.domElement.addEventListener("touchmove",u,!1)},THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype);var Stats=function(){function e(e,t,n){return e=document.createElement(e),e.id=t,e.style.cssText=n,e}function t(t,n,r){var a=e("div",t,"padding:0 0 3px 3px;text-align:left;background:"+r),o=e("div",t+"Text","font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px;color:"+n);for(o.innerHTML=t.toUpperCase(),a.appendChild(o),t=e("div",t+"Graph","width:74px;height:30px;background:"+n),a.appendChild(t),n=0;74>n;n++)t.appendChild(e("span","","width:1px;height:30px;float:left;opacity:0.9;background:"+r));return a}function n(e){for(var t=l.children,n=0;n<t.length;n++)t[n].style.display=n===e?"block":"none";c=e}function r(e,t){e.appendChild(e.firstChild).style.height=Math.min(30,30-30*t)+"px"}var a=self.performance&&self.performance.now?self.performance.now.bind(performance):Date.now,o=a(),i=o,s=0,c=0,l=e("div","stats","width:80px;opacity:0.9;cursor:pointer");l.addEventListener("mousedown",function(e){e.preventDefault(),n(++c%l.children.length)},!1);var u=0,m=1/0,p=0,d=t("fps","#0ff","#002"),h=d.children[0],f=d.children[1];l.appendChild(d);var E=0,v=1/0,g=0,d=t("ms","#0f0","#020"),y=d.children[0],w=d.children[1];if(l.appendChild(d),self.performance&&self.performance.memory){var T=0,b=1/0,H=0,d=t("mb","#f08","#201"),R=d.children[0],x=d.children[1];l.appendChild(d)}return n(c),{REVISION:14,domElement:l,setMode:n,begin:function(){o=a()},end:function(){var e=a();if(E=e-o,v=Math.min(v,E),g=Math.max(g,E),y.textContent=(0|E)+" MS ("+(0|v)+"-"+(0|g)+")",r(w,E/200),s++,e>i+1e3&&(u=Math.round(1e3*s/(e-i)),m=Math.min(m,u),p=Math.max(p,u),h.textContent=u+" FPS ("+m+"-"+p+")",r(f,u/100),i=e,s=0,void 0!==T)){var t=performance.memory.usedJSHeapSize,n=performance.memory.jsHeapSizeLimit;T=Math.round(9.54e-7*t),b=Math.min(b,T),H=Math.max(H,T),R.textContent=T+" MB ("+b+"-"+H+")",r(x,t/n)}return e},update:function(){o=this.end()}}};"object"===("undefined"==typeof module?"undefined":_typeof(module))&&(module.exports=Stats),THREE.SubdivisionModifier=function(e){"use strict";this.subdivisions=void 0===e?1:e},THREE.SubdivisionModifier.prototype.modify=function(e){for(var t=this.subdivisions;t-- >0;)this.smooth(e);delete e.__tmpVertices,e.computeFaceNormals(),e.computeVertexNormals()},function(){function e(e,t,n){var r=Math.min(e,t),a=Math.max(e,t),o=r+"_"+a;return n[o]}function t(e,t,n,r,a,o){var i,s=Math.min(e,t),c=Math.max(e,t),l=s+"_"+c;if(l in r)i=r[l];else{var u=n[s],m=n[c];i={a:u,b:m,newEdge:null,faces:[]},r[l]=i}i.faces.push(a),o[e].edges.push(i),o[t].edges.push(i)}function n(e,n,r,a){var o,i,s;for(o=0,i=e.length;i>o;o++)r[o]={edges:[]};for(o=0,i=n.length;i>o;o++)s=n[o],t(s.a,s.b,e,a,s,r),t(s.b,s.c,e,a,s,r),t(s.c,s.a,e,a,s,r)}function r(e,t,n,r){e.push(new THREE.Face3(t,n,r))}var a=!1,o=["a","b","c"];THREE.SubdivisionModifier.prototype.smooth=function(t){var i,s,c,l,u,m,p,d,h,f,E,E,v,g,y=new THREE.Vector3;i=t.vertices,s=t.faces,f=new Array(i.length),E={},n(i,s,f,E),v=[];var w,T,b,H,R,x,S;for(m in E){for(T=E[m],b=new THREE.Vector3,R=3/8,x=1/8,S=T.faces.length,2!=S&&(R=.5,x=0,1!=S&&a&&console.warn("Subdivision Modifier: Number of connected faces != 2, is: ",S,T)),b.addVectors(T.a,T.b).multiplyScalar(R),y.set(0,0,0),d=0;S>d;d++){for(H=T.faces[d],h=0;3>h&&(w=i[H[o[h]]],w===T.a||w===T.b);h++);y.add(w)}y.multiplyScalar(x),b.add(y),T.newEdge=v.length,v.push(b)}var _,k,M,P,O,C,L;for(g=[],m=0,p=i.length;p>m;m++){for(C=i[m],O=f[m].edges,u=O.length,3==u?_=3/16:u>3&&(_=3/(8*u)),k=1-u*_,M=_,2>=u&&(2==u?(a&&console.warn("2 connecting edges",O),k=.75,M=1/8):1==u?a&&console.warn("only 1 connecting edge"):0==u&&a&&console.warn("0 connecting edges")),L=C.clone().multiplyScalar(k),y.set(0,0,0),d=0;u>d;d++)P=O[d],w=P.a!==C?P.a:P.b,y.add(w);y.multiplyScalar(M),L.add(y),g.push(L)}c=g.concat(v);var A,j,W,V=g.length;for(l=[],m=0,p=s.length;p>m;m++)H=s[m],A=e(H.a,H.b,E).newEdge+V,j=e(H.b,H.c,E).newEdge+V,W=e(H.c,H.a,E).newEdge+V,r(l,A,j,W),r(l,H.a,A,W),r(l,H.b,j,A),r(l,H.c,W,j);t.vertices=c,t.faces=l}}(),"undefined"==typeof Array.isArray&&(Array.isArray=function(e){"use strict";return"[object Array]"===Object.prototype.toString.call(e)}),addCSSRule(document.styleSheets[0],"@keyframes fadeOut","to {opacity: 0}",0),addCSSRule(document.styleSheets[0],"@keyframes fadeIn","from {opacity: 0} to {opacity: 1}",0),Element.prototype.fadeOut=function(e){this.style.webkitAnimationDuration=(e||1)+"s",this.style.webkitAnimationName="fadeOut",this.style.webkitAnimationPlayState="running",this.addEventListener("animationend",function(){this.style.display="none",this.style.webkitAnimationPlayState="paused"})},Element.prototype.fadeIn=function(e,t){this.style.display=t||"block",this.style.webkitAnimationDuration=(e||1)+"s",this.style.webkitAnimationName="fadeIn",this.style.webkitAnimationPlayState="running",this.addEventListener("animationend",function(){this.style.display=t||"block"})};var MouseEvent=MouseEvent||{prototype:{}};!function(){if(!MouseEvent.prototype.hasOwnProperty("movementX")||!MouseEvent.prototype.hasOwnProperty("mozMovementX")){var e={lastX:0,lastY:0};MouseEvent.prototype.getMovementX=function(){"use strict";var t=this.clientX-e.lastX;return e.lastX=this.clientX,t},MouseEvent.prototype.getMovementY=function(){"use strict";var t=this.clientY-e.lastY;return e.lastY=this.clientY,t}}}(),Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:function(e){"use strict";if(void 0===e||null===e)throw new TypeError("Cannot convert first argument to object");for(var t=Object(e),n=1;n<arguments.length;n++){var r=arguments[n];if(void 0!==r&&null!==r){r=Object(r);for(var a=Object.keys(r),o=0,i=a.length;i>o;o++){var s=a[o],c=Object.getOwnPropertyDescriptor(r,s);void 0!==c&&c.enumerable&&(t[s]=r[s])}}}return t}});var WHS={REVISION:"0.0.6",API:{},plugins:{settings:{plug_id:0,loop_id:0},list:{},queue:[]},grounds:[]},api=WHS.API;"function"==typeof define&&define.amd?define("whitestorm",WHS):"undefined"!=typeof exports&&"undefined"!=typeof module&&(module.exports=WHS),THREE.ShaderTerrain={terrain:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{enableDiffuse1:{type:"i",value:0},enableDiffuse2:{type:"i",value:0},enableSpecular:{type:"i",value:0},enableReflection:{type:"i",value:0},tDiffuse1:{type:"t",value:null},tDiffuse2:{type:"t",value:null},tDetail:{type:"t",value:null},tNormal:{type:"t",value:null},tSpecular:{type:"t",value:null},tDisplacement:{type:"t",value:null},uNormalScale:{type:"f",value:1},uDisplacementBias:{type:"f",value:0},uDisplacementScale:{type:"f",value:1},diffuse:{type:"c",value:new THREE.Color(15658734)},specular:{type:"c",value:new THREE.Color(1118481)},shininess:{type:"f",value:30},opacity:{type:"f",value:1},uRepeatBase:{type:"v2",value:new THREE.Vector2(1,1)},uRepeatOverlay:{type:"v2",value:new THREE.Vector2(1,1)},uOffset:{type:"v2",value:new THREE.Vector2(0,0)}}]),fragmentShader:["\n		        uniform vec3 diffuse;\n		        uniform vec3 emissive;\n		        uniform float opacity;\n		        uniform vec3 ambientLightColor;\n		        varying vec3 vLightFront;\n		        #ifdef DOUBLE_SIDED\n			        varying vec3 vLightBack;\n			        uniform vec2 uRepeatOverlay;\n			        uniform vec2 uRepeatBase;\n			        uniform vec2 uOffset;\n			        uniform float uNormalScale;\n			        uniform sampler2D tNormal;\n		        #endif\n		        uniform sampler2D oceanTexture;\n		        uniform sampler2D sandyTexture;\n		        uniform sampler2D grassTexture;\n		        uniform sampler2D rockyTexture;\n		        uniform sampler2D snowyTexture;\n		        varying vec3 vTangent;\n		        varying vec3 vBinormal;\n		        varying vec3 vNormal;\n		        varying vec3 vViewPosition;\n		"+[THREE.ShaderChunk.common,THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.alphamap_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment].join("\n")+"\n		        varying vec2 vUv;\n		        varying float vAmount;\n		        void main() {\n		        	// UVs.\n		            vec2 uvOverlay = uRepeatOverlay * vUv + uOffset;\n		            vec2 uvBase = uRepeatBase * vUv;\n					vec3 specularTex = vec3( 1.0 );\n		            vec3 normalTex = texture2D( tNormal, uvOverlay ).xyz * 2.0 - 1.0;\n		            normalTex.xy *= uNormalScale;\n		            normalTex = normalize( normalTex );\n		            mat3 tsb = mat3( vTangent, vBinormal, vNormal );\n		            vec3 finalNormal = tsb * normalTex;\n		            vec3 normal = normalize( finalNormal );\n		            vec3 viewPosition = normalize( vViewPosition );\n		            vec3 shadowMask = vec3( 1.0 );\n		            vec3 outgoingLight = vec3( 0.0 );\n		            vec3 totalAmbientLight = ambientLightColor;\n		            vec4 diffuseColor = vec4(0.0);\n		            // Color by texture.\n		            vec4 water = (smoothstep(0.01, 0.25, vAmount)\n		            - smoothstep(0.24, 0.26, vAmount))\n		            * texture2D( oceanTexture, vUv * 10.0 );\n		            vec4 sandy = (smoothstep(0.24, 0.27, vAmount)\n		            - smoothstep(0.28, 0.31, vAmount))\n		            * texture2D( sandyTexture, vUv * 10.0 );\n		            vec4 grass = (smoothstep(0.28, 0.32, vAmount)\n		            - smoothstep(0.35, 0.40, vAmount))\n		            * texture2D( grassTexture, vUv * 20.0 );\n		            vec4 rocky = (smoothstep(0.30, 0.40, vAmount)\n		            - smoothstep(0.40, 0.70, vAmount))\n		            * texture2D( rockyTexture, vUv * 20.0 );\n		            vec4 snowy = (smoothstep(0.42, 0.45, vAmount))\n		            * texture2D( snowyTexture, vUv * 10.0 );\n		            diffuseColor = vec4(0.0, 0.0, 0.0, 1.0)\n		            + water + sandy + grass + rocky + snowy;\n		"+[THREE.ShaderChunk.logdepthbuf_fragment,THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphamap_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment].join("\n")+"\n		            #ifdef DOUBLE_SIDED\n		                if ( gl_FrontFacing )\n		                    outgoingLight += diffuseColor.rgb * \n		                		( vLightFront * shadowMask + totalAmbientLight )\n		                		+ emissive;\n		                else\n		                    outgoingLight += diffuseColor.rgb * \n		                		( vLightBack * shadowMask + totalAmbientLight )\n		                		+ emissive;\n		            #else\n		                outgoingLight += diffuseColor.rgb * \n		                	( vLightFront * shadowMask + totalAmbientLight )\n		                	+ emissive;\n		            #endif\n		           gl_FragColor = vec4( outgoingLight, diffuseColor.a );\n		      }\n		"],vertexShader:["\n		    #define TERRAIN;\n		    varying vec3 vLightFront;\n		    #ifdef DOUBLE_SIDED\n		        varying vec3 vLightBack;\n		    #endif\n		    \n		    varying float vAmount;\n		    attribute vec4 tangent;\n		    uniform vec2 uRepeatBase;\n		    uniform sampler2D tNormal;\n		    #ifdef VERTEX_TEXTURES\n			    uniform sampler2D tDisplacement;\n			    uniform float uDisplacementScale;\n			    uniform float uDisplacementBias;\n		    #endif\n		    varying vec3 vTangent;\n		    varying vec3 vBinormal;\n		    varying vec3 vNormal;\n		    varying vec2 vUv;\n		    varying vec3 vViewPosition;\n		"+[THREE.ShaderChunk.common,THREE.ShaderChunk.uv_pars_vertex,THREE.ShaderChunk.uv2_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_lambert_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex].join("\n")+"\n		    void main() {\n		"+[THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.beginnormal_vertex,THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,THREE.ShaderChunk.begin_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.project_vertex,THREE.ShaderChunk.logdepthbuf_vertex,THREE.ShaderChunk.uv_vertex,THREE.ShaderChunk.uv2_vertex].join("\n")+"\n			    vNormal = normalize( normalMatrix * normal);\n			    // Tangent and binormal vectors.\n			    vTangent = normalize( normalMatrix * tangent.xyz );\n			    vBinormal = cross( vNormal, vTangent ) * tangent.w;\n			    vBinormal = normalize( vBinormal );\n			    // Texture coordinates.\n			    vUv = uv;\n			    vec2 uvBase = uv * uRepeatBase;\n			    // displacement mapping\n			    vec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n			    mvPosition = modelViewMatrix * vec4( position, 1.0 );\n			    transformedNormal = normalize( normalMatrix * normal );\n			    gl_Position = projectionMatrix * mvPosition;\n			    vViewPosition = -mvPosition.xyz;\n			    vAmount = position.z * 0.005 + 0.1;\n		"+[THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.lights_lambert_vertex,THREE.ShaderChunk.shadowmap_vertex].join("\n")+"\n		   }\n		"],side:THREE.DoubleSide,shading:THREE.SmoothShading}},WHS.API.construct=function(e,t,n){"use strict";e||console.error("@constructor: WHS root object is not defined.");var r=function(e,t,n){this.x=e,this.y=t,this.z=n};t.pos&&(t.pos.set=r),t.rot&&(t.rot.set=r),t.scale&&(t.scale.set=r),t.target&&(t.target.set=r);var a=$.extend(!0,{pos:{x:0,y:0,z:0,set:r},rot:{x:0,y:0,z:0,set:r},scale:{x:1,y:1,z:1,set:r},target:{x:0,y:0,z:0,set:r},morph:{speed:1,duration:1},onlyvis:!1},t),o=0;e.modellingQueue.forEach(function(e){e.type==n&&o++});var i=$.Deferred(),s={root:e,_key:o,_whsobject:!0,_name:n+o,__releaseTime:(new Date).getTime(),__deferred:i,_state:i.promise(),_pos:a.pos,_rot:a.rot,_scale:a.scale,_morph:a.morph,_target:a.target,_onlyvis:a.onlyvis};return Object.assign(this,s),e.children.push(s),this},WHS.API.construct.prototype.build=function(e){"use strict";e=e||this.mesh;try{e.castShadow=!0,e.receiveShadow=!0,e.position.set(this._pos.x,this._pos.y,this._pos.z),e.rotation.set(this._rot.x,this._rot.y,this._rot.z),e.scale.set(this._scale.x,this._scale.y,this._scale.z)}catch(t){console.error(t.message),this.__deferred.reject()}return this},WHS.API.def=function(e,t,n){"use strict";if(arguments.length<2)console.error("Something wrong! option? value?");else{if(2==arguments.length)return e=e||t;if(3==arguments.length&&n)return n=e||t}},WHS.API.extend=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;t>r;r++)n[r-1]=arguments[r];var a=!0,o=!1,i=void 0;try{for(var s,c=n[Symbol.iterator]();!(a=(s=c.next()).done);a=!0){var l=s.value;if(l){var u=!0,m=!1,p=void 0;try{for(var d,h=Object.getOwnPropertyNames(l)[Symbol.iterator]();!(u=(d=h.next()).done);u=!0){var f=d.value;void 0!=e[f]&&"[object Object]"==e[f].toString()&&"[object Object]"==l[f].toString()?WHS.API.extend(e[f],l[f]):e[f]=0===e[f]?0:e[f]||l[f]}}catch(E){m=!0,p=E}finally{try{!u&&h["return"]&&h["return"]()}finally{if(m)throw p}}}}}catch(E){o=!0,i=E}finally{try{!a&&c["return"]&&c["return"]()}finally{if(o)throw i}}return e},WHS.API.getheight=function(e,t,n,r){"use strict";return t=t||1e3,r=r||1,this.raycaster=new THREE.Raycaster(new THREE.Vector3(e.x,t,r*e.y),new THREE.Vector3(0,-1,0)),this.intersect=this.raycaster.intersectObject(n.mesh),this.intersect},WHS.API.isSame=function(e,t){return!(e.sort()>t.sort()||e.sort()<t.sort())},WHS.API.JSONLoader=function(){return new THREE.JSONLoader},WHS.API.TextureLoader=function(){return new THREE.TextureLoader},WHS.API.loadMaterial=function(e){"use strict";"string"!=typeof e.kind&&console.error("Type of material is undefined or not a string. @loadMaterial");var t={_type:e.kind,_restitution:e.restitution||e.rest||.3,_friction:e.friction||e.fri||.8},n=$.extend({},e);switch(delete n.kind,delete n.friction,delete n.fric,delete n.restitution,delete n.rest,e.kind){case"basic":t._material=new THREE.MeshBasicMaterial(n);break;case"linebasic":t._params=new THREE.LineBasicMaterial(n);break;case"linedashed":t._material=new THREE.LineDashedMaterial(n);break;case"material":t._material=new THREE.Material(n);break;case"depth":t._material=new THREE.MeshDepthMaterial(n);break;case"face":t._material=new THREE.MeshFaceMaterial(n);break;case"lambert":t._material=new THREE.MeshLambertMaterial(n);break;case"normal":t._material=new THREE.MeshNormalMaterial(n);break;case"phong":t._material=new THREE.MeshPhongMaterial(n);break;case"pointcloud":t._material=new THREE.PointCloudMaterial(n);break;case"rawshader":t._material=new THREE.RawShaderMaterial(n);break;case"shader":t._material=new THREE.ShaderMaterial(n);break;case"spritecanvas":t._material=new THREE.SpriteCanvasMaterial(n);break;case"sprite":t._material=new THREE.SpriteMaterial(n)}return t._material=Physijs.createMaterial(t._material,t._friction,t._restitution),t},WHS.API.merge=function(e,t){"use strict";if(("object"!==("undefined"==typeof e?"undefined":_typeof(e))||"object"!==("undefined"==typeof t?"undefined":_typeof(t)))&&console.error("No rabbits for the box. (arguments)",["undefined"==typeof e?"undefined":_typeof(e),"undefined"==typeof t?"undefined":_typeof(t)]),e)if(Array.isArray(t)&&1===t.length)e.add(t[0]);else if(Array.isArray(t)&&t.length>1&&e)for(var n=0;n<t.length;n++)e.add(t[n]);else Array.isArray(t)||e.add(t);else console.error("box is undefined. Line "+(new Error).lineNumber+". Func merge.",[e,t])},WHS.API.PackUvs=function(e){e.computeBoundingBox();var t=e.boundingBox.max,n=e.boundingBox.min,r=new THREE.Vector2(0-n.x,0-n.y),a=new THREE.Vector2(t.x-n.x,t.y-n.y);e.faceVertexUvs[0]=[];for(var o=e.faces,i=0;i<e.faces.length;i++){var s=e.vertices[o[i].a],c=e.vertices[o[i].b],l=e.vertices[o[i].c];e.faceVertexUvs[0].push([new THREE.Vector2((s.x+r.x)/a.x,(s.y+r.y)/a.y),new THREE.Vector2((c.x+r.x)/a.x,(c.y+r.y)/a.y),new THREE.Vector2((l.x+r.x)/a.x,(l.y+r.y)/a.y)])}e.uvsNeedUpdate=!0},WHS.API.removeDuplicateFaces=function(e){for(var t=0;t<e.faces.length;t++)for(var n=e.faces[t],r=[n.a,n.b,n.c,n.d].sort(),a=0;t>a;a++){var o=e.faces[a];if(void 0!==o){var i=[o.a,o.b,o.c,o.d].sort();WHS.API.isSame(r,i)&&(delete e.faces[t],delete e.faces[a])}}return e.faces=e.faces.filter(function(e){return void 0===e}),e},WHS.API.rotateGeometry=function(e,t){"use strict";var n=new THREE.Matrix4;n.makeRotationFromEuler(new THREE.Euler(t.x,t.y,t.z,"XYZ"));for(var r in e.vertices)e.vertices[r].applyMatrix4(n);return e},WHS.API.texture=function(e,t){"use strict";var n=THREE.ImageUtils.loadTexture(e);if(t){var r=t;r.offset=r.offset||{x:1,y:1},r.offset.x=r.offset.x||1,r.offset.y=r.offset.y||1,r.repeat=r.repeat||{x:1,y:1},r.repeat.x=r.repeat.x||1,r.repeat.y=r.repeat.y||1,n.wrapS=n.wrapT=THREE.RepeatWrapping,n.repeat.set(r.repeat.x,r.repeat.y),n.magFilter=THREE.NearestFilter,n.minFilter=THREE.LinearMipMapLinearFilter}return n},WHS.API.Triangulate=function(e,t){"use strict";if(e instanceof THREE.Geometry){if(t){var n=new THREE.Geometry,r=[];e.faces.forEach(function(a){var o=new THREE.Geometry;[].push.apply(o.vertices,[e.vertices[a.a],e.vertices[a.b],e.vertices[a.c]]),o.faceVertexUvs[0].push([new THREE.Vector2(0,0),new THREE.Vector2(0,1),new THREE.Vector2(1,1),new THREE.Vector2(1,0)]),o.faces.push(new THREE.Face3(0,1,2)),o.computeFaceNormals();var i=new THREE.Mesh(o,t);i.updateMatrix(),n.merge(i.geometry,i.matrix),r.push(t)});var a=new THREE.Mesh(n,new THREE.MeshFaceMaterial(r));return a}}else console.error("No THREE.js geometry")},WHS.API.Wrap=function(e,t){"use strict";this._mesh=t,this._scope=e,this._key=e.root.modellingQueue.length;try{api.merge(this._scope.root.scene,this._mesh),this._scope.root.modellingQueue.push(this._scope)}catch(n){console.error(n.message),this._scope.__deferred.reject()}finally{if(this._scope._wait){var r=this;r._mesh.addEventListener("ready",function(){r._scope.__deferred.resolve()})}else this._scope.__deferred.resolve()}return this},WHS.API.Wrap.prototype.remove=function(){"use strict";return this._scope.root.scene.remove(this._mesh),WHS.objects.splice(this._key,1),this},WHS.API.Wrap.prototype.retrieve=function(){"use strict";return this._scope.root.scene.add(this._mesh),WHS.objects.push(this._scope),this},WHS.Watch=function(e){
"use strict";return this._queue=Array.isArray(e)?e:[],this},WHS.Watch.prototype.add=function(e){"use strict";return this._queue.push(e),this},WHS.Watch.prototype.remove=function(e){"use strict";return this._queue=this._queue.filter(function(t){return t!=e}),this},WHS.plugins.loop=function(e){this.loop={func:e,id:WHS.plugins.settings.loop_id++,enabled:!1},WHS.plugins.queue.push(this.loop)},WHS.plugins.loop.prototype.start=function(){this.loop.enabled=!0},WHS.plugins.loop.prototype.stop=function(){this.loop.enabled=!1},WHS.gp={},WHS.plugins.register=function(e,t,n){"use strict";var r=WHS.plugins.settings.plug_id;WHS.plugins.list[e]={func:t,id:r},n?WHS.gp[e]=t:WHS.API.construct.prototype[e]=t,WHS.plugins.settings.plug_id++},WHS.init=function(e){"use strict";console.log("WHS.init",WHS.REVISION),THREE||console.warn("whitestormJS requires THREE.js. {Object} THREE not found."),Physijs||console.warn("whitestormJS requires PHYSI.js. {Object} Physijs not found."),WAGNER||console.warn("whitestormJS requires WAGNER.js. {Object} WAGNER not found.");var t=$.extend(!0,{anaglyph:!1,helper:!1,stats:!1,wagner:!0,autoresize:!1,shadowmap:!0,gravity:{x:0,y:0,z:0},camera:{aspect:75,near:1,far:1e3,x:0,y:0,z:0},rWidth:window.innerWidth,rHeight:window.innerHeight,width:window.innerWidth,height:window.innerHeight,physics:{quatNormalizeSkip:0,quatNormalizeFast:!1,solver:{iterations:20,tolerance:0},defMaterial:{contactEquationStiffness:1e8,contactEquationRegularizationTime:3}},background:0,assets:"./assets",container:$("body"),path_worker:"../libs/physijs_worker.js",path_ammo:"../libs/ammo.js"},e);this._settings=t,Physijs.scripts.worker=t.path_worker,Physijs.scripts.ammo=t.path_ammo,this.scene=new Physijs.Scene,this.scene.setGravity(new THREE.Vector3(e.gravity.x,e.gravity.y,e.gravity.z));var n=$('<div class="whs"></div>');t.container.append($(n)),t.stats&&(this._stats=new Stats,"fps"==t.stats?this._stats.setMode(0):"ms"==t.stats?this._stats.setMode(1):"mb"==t.stats?this._stats.setMode(1):(this._stats.setMode(0),console.warn([this._stats],"Please, apply stats mode [fps, ms, mb] .")),this._stats.domElement.style.position="absolute",this._stats.domElement.style.left="0px",this._stats.domElement.style.bottom="0px",$(n).append(this._stats.domElement));var r=new THREE.PerspectiveCamera(t.camera.aspect,t.width/t.height,t.camera.near,t.camera.far);r.position.set(t.camera.x,t.camera.y,t.camera.z),api.merge(this.scene,r);var a=new THREE.WebGLRenderer;a.setClearColor(t.background),a.shadowMap.enabled=t.shadowmap,a.shadowMap.type=THREE.PCFSoftShadowMap,a.shadowMap.cascade=!0,t.anaglyph?(this.effect=new THREE.AnaglyphEffect(a),this.effect.setSize(t.rWidth,t.rHeight),this.effect.render(this.scene,r)):(a.setSize(t.rWidth,t.rHeight),a.render(this.scene,r)),$(a.domElement).css({width:t.width,height:t.height}),$(a.domElement).attr(""),$(n).append(a.domElement),t.container.css({margin:0,padding:0,position:"relative",overflow:"hidden"}),t.wagner&&(this._composer=new WAGNER.Composer(a),this._composer.setSize(t.rWidth,t.rHeight),$(this._composer.domElement).css({width:t.width,height:t.height}),this._composer.autoClearColor=!0,this._composer.reset(),this._composer.render(this.scene,r),this._composer.eff=[]),Object.assign(this,{_camera:r,renderer:a,_settings:t,modellingQueue:[],children:[],_dom:n});var o=this;return t.autoresize&&$(window).on("load resize",function(){o._camera.aspect=window.innerWidth/window.innerHeight,o._camera.updateProjectionMatrix(),o.renderer.setSize(t.rWidth,t.rHeight),$(o.renderer.domElement).css({width:window.innerWidth,height:window.innerHeight}),e.wagner&&(o._composer.setSize(t.rWidth,t.rHeight),$(o._composer.domElement).css({width:window.innerWidth,height:window.innerHeight}))}),o},WHS.init.prototype.start=function(){"use strict";function e(r){requestAnimationFrame(e),n._stats&&n._stats.begin();for(var a=0;a<Object.keys(n.modellingQueue).length;a++)n.modellingQueue[a].morph&&n.modellingQueue[a].mesh.mixer.update(t.getDelta());n.scene.simulate(),n.controls&&(n.controls.update(Date.now()-n.time),n.time=Date.now()),n._composer&&(n._composer.reset(),n._composer.render(n.scene,n._camera),n._composer.eff.forEach(function(e){n._composer.pass(e)}),n._composer.toScreen()),n._stats&&n._stats.end(),WHS.plugins.queue.forEach(function(e){e.enabled&&e.func(r)})}var t=new THREE.Clock,n=this;n._events=new Events,n._events.on("ready",function(){n.update()}),this.update=e,n._queue=[],n._ready=[],n.children.forEach(function(e){n._queue.push(e)}),n.children.forEach(function(e){e._state.done(function(){n._ready.push(e),n._queue.length==n._ready.length&&n._events.emit("ready")})})},WHS.init.prototype.addModel=function(e,t){"use strict";var n=new api.construct(this,t,"model");return n.materialType=api.loadMaterial(t.materialOptions)._material,api.JSONLoader().load(e,function(e){e.computeFaceNormals(),e.computeVertexNormals(),n.mesh=new Physijs.ConcaveMesh(e,n.materialType,t.mass),n._wait=!0,n.build(),n.wrap=new api.Wrap(n,n.mesh)}),n},WHS.init.prototype.addMorph=function(e,t){"use strict";var n=new api.construct(this,t,"morph");return n.skip=!0,n.morph=!0,api.JSONLoader().load(e,function(e){var t=new THREE.MeshLambertMaterial({color:16755285,morphTargets:!0,vertexColors:THREE.FaceColors});n.mesh=new THREE.Mesh(e,t),n.mesh.speed=n._morph.speed,n._mixer=new THREE.AnimationMixer(n.mesh),n._mixer.addAction(new THREE.AnimationAction(e.animations[0]).warpToDuration(.5)),n._mixer.update(600*Math.random()),n.mesh.mixer=n._mixer,n._rot.y=Math.PI/2,n.build(n.mesh),n.wrap=new api.Wrap(n,n.mesh)}),n},WHS.init.prototype.addObject=function(e,t){"use strict";var n=new api.construct(this,t,e),r=t.onlyvis?n._target.mass:1;switch(n.materialType=api.loadMaterial(t.materialOptions)._material,t.geometryOptions=t.geometryOptions||{},e){case"sphere":api.extend(t.geometryOptions,{radius:1,segmentA:32,segmentB:32}),n.visible=new Physijs.SphereMesh(new THREE.SphereGeometry(t.geometryOptions.radius,t.geometryOptions.segmentA,t.geometryOptions.segmentB),n.materialType,10);break;case"cube":api.extend(t.geometryOptions,{width:1,height:1,depth:1}),n.visible=new Physijs.BoxMesh(new THREE.BoxGeometry(t.geometryOptions.width,t.geometryOptions.height,t.geometryOptions.depth),n.materialType,r);break;case"cylinder":api.extend(t.geometryOptions,{radiusTop:1,radiusBottom:1,height:1,radiusSegments:32}),n.visible=new Physijs.CylinderMesh(new THREE.CylinderGeometry(t.geometryOptions.radiusTop,t.geometryOptions.radiusBottom,t.geometryOptions.height,t.geometryOptions.radiusSegments),n.materialType,r);break;case"dodecahedron":api.extend(t.geometryOptions,{radius:1,detail:0}),n.visible=new Physijs.ConvexMesh(new THREE.DodecahedronGeometry(t.geometryOptions.radius,t.geometryOptions.detail),n.materialType,r);break;case"extrude":api.extend(t.geometryOptions,{shapes:[],options:{}}),n.visible=new Physijs.ConvexMesh(new THREE.ExtrudeGeometry(t.geometryOptions.shapes,t.geometryOptions.options),n.materialType,r);break;case"icosahedron":api.extend(t.geometryOptions,{radius:1,detail:0}),n.visible=new Physijs.ConvexMesh(new THREE.IcosahedronGeometry(t.geometryOptions.radius,t.geometryOptions.detail),n.materialType,r);break;case"lathe":api.extend(t.geometryOptions,{points:[]}),n.visible=new Physijs.ConvexMesh(new THREE.LatheGeometry(t.geometryOptions.points),n.materialType,r);break;case"octahedron":api.extend(t.geometryOptions,{radius:1,detail:0}),n.visible=new Physijs.ConvexMesh(new THREE.OctahedronGeometry(t.geometryOptions.radius,t.geometryOptions.detail),n.materialType,r);break;case"parametric":api.extend(t.geometryOptions,{func:function(){},slices:10,stacks:10}),n.visible=new Physijs.ConvexMesh(new THREE.ParametricGeometry(t.geometryOptions.func,t.geometryOptions.slices,t.geometryOptions.stacks),n.materialType,r);break;case"plane":api.extend(t.geometryOptions,{width:1,height:0,segments:32}),n.visible=new Physijs.ConvexMesh(new THREE.PlaneBufferGeometry(t.geometryOptions.width,t.geometryOptions.height,t.geometryOptions.segments),n.materialType,r);break;case"polyhedron":api.extend(t.geometryOptions,{verticesOfCube:[],indicesOfFaces:[],radius:1,detail:1}),n.visible=new Physijs.ConvexMesh(new THREE.PolyhedronGeometry(t.geometryOptions.verticesOfCube,t.geometryOptions.indicesOfFaces),n.materialType,r);break;case"ring":api.extend(t.geometryOptions,{innerRadius:2,outerRadius:5,thetaSegments:30,phiSegments:30,thetaStart:0,thetaLength:2*Math.PI}),n.visible=new Physijs.ConcaveMesh(new THREE.TorusGeometry(t.geometryOptions.outerRadius,(t.geometryOptions.outerRadius-t.geometryOptions.innerRadius)/2,t.geometryOptions.thetaSegments,t.geometryOptions.phiSegments),n.materialType,r);break;case"shape":n.visible=new THREE.Mesh(new THREE.ShapeGeometry(t.geometryOptions.shapes),n.materialType),n.onlyvis=!0,console.warn("This is not physic object. 2D!",[n]);break;case"tetrahedron":api.extend(t.geometryOptions,{radius:1,detail:0}),n.visible=new Physijs.ConvexMesh(new THREE.TetrahedronGeometry(t.geometryOptions.radius,t.geometryOptions.detail),n.materialType,r);break;case"text":if(!t.geometryOptions.parameters)throw new Error("Missing text parameters");n.visible=new Physijs.ConcaveMesh(new THREE.TextGeometry(api.extend(t.geometryOptions,{text:"Hello World!"}),api.extend(t.geometryOptions.parameters,{size:1,height:50,curveSegments:1,font:"Adelle",weight:"normal",style:"normal",bevelEnabled:!1,bevelThickness:10,bevelSize:8})),n.materialType,masss);break;case"torus":api.extend(t.geometryOptions,{radius:100,tube:40,radialSegments:8,tubularSegments:6,arc:2*Math.PI}),n.visible=new Physijs.ConcaveMesh(new THREE.TorusGeometry(t.geometryOptions.radius,t.geometryOptions.tube,t.geometryOptions.radialSegments,t.geometryOptions.tubularSegments,t.geometryOptions.arc),n.materialType,r);break;case"torusknot":api.extend(t.geometryOptions,{radius:100,tube:40,radialSegments:64,tubularSegments:8,p:2,q:3,heightScale:1}),n.visible=new Physijs.ConvexMesh(new THREE.TorusKnotGeometry(t.geometryOptions.radius,t.geometryOptions.tube,t.geometryOptions.radialSegments,t.geometryOptions.tubularSegments,t.geometryOptions.p,t.geometryOptions.q,t.geometryOptions.heightScale),n.materialType,r);break;case"tube":n.CustomSinCurve=THREE.Curve.create(function(e){this.scale=e||1},function(e){var t=3*e-1.5,n=Math.sin(2*Math.PI*e),r=0;return new THREE.Vector3(t,n,r).multiplyScalar(this.scale)}),api.extend(t.geometryOptions,{path:t.geometryOptions.path?new this.CustomSinCurve(100):!1,segments:20,radius:2,radiusSegments:8,closed:!1}),n.visible=new Physijs.ConcaveMesh(new THREE.TubeGeometry(t.geometryOptions.path,t.geometryOptions.segments,t.geometryOptions.radius,t.geometryOptions.radiusSegments,t.geometryOptions.closed),n.materialType,masss)}return n.addCompoundFace=function(){this.compoundFace=new THREE.Geometry,this.compoundFace.faces.push(new THREE.Face3(0,1,2));var e=(new THREE.Box3).setFromObject(this.visible),t=new THREE.BoxGeometry(e.max.x-e.min.x,e.max.y-e.min.y,e.max.z-e.min.z),n=t.vertices[t.faces[7].a].add(this.visible.position),r=t.vertices[t.faces[7].b].add(this.visible.position),a=t.vertices[t.faces[7].c].add(this.visible.position);this.compoundFace.vertices.push(n),this.compoundFace.vertices.push(r),this.compoundFace.vertices.push(a)},n.remove=function(){return n.wrap.remove()},n.retrieve=function(){return n.wrap.retrieve()},n.build(n.visible),n.wrap=new api.Wrap(n,n.visible),n},WHS.init.prototype.addGrass=function(e,t){"use strict";var n={};n.root=this,n.opts=t,n.onlyvis=!0,n.opts.coords||console.warn("Please add grass objects coordinates! @addGrass"),n.grassMeshes=[];var r=new THREE.Mesh(new THREE.Geometry,new THREE.MeshFaceMaterial);return n.opts.coords.forEach(function(t){var a=new THREE.Mesh(new THREE.Geometry,new THREE.MeshBasicMaterial({map:THREE.ImageUtils.loadTexture("assets/textures/thingrass.png"),side:THREE.DoubleSide,blending:THREE.NormalBlending,transparent:!0,alphaTest:.5})),o=WHS.API.getheight({x:t.x,y:t.y},500,e,-1)[0],i=o.object.geometry.vertices,s=new THREE.Geometry;s.faces.push(new THREE.Face3(0,1,2)),s.vertices.push(i[o.face.a]),s.vertices.push(i[o.face.c]),s.vertices.push(i[o.face.b]),s.computeFaceNormals(),a.position.set(0,0,0),a.geometry.vertices.push(i[o.face.a].clone()),a.geometry.vertices.push(i[o.face.c].clone()),a.geometry.vertices.push(i[o.face.a].clone().add(s.faces[0].normal)),a.geometry.vertices.push(i[o.face.c].clone().add(s.faces[0].normal));var c=new THREE.Vector3(i[o.face.a].clone().x/2+i[o.face.c].clone().x/2,i[o.face.a].clone().y/2+i[o.face.c].clone().y/2,i[o.face.a].clone().z/2+i[o.face.c].clone().z/2);a.geometry.vertices.push(c.clone().add(c.clone().sub(i[o.face.b].clone()))),a.geometry.vertices.push(i[o.face.b].clone()),a.geometry.vertices.push(i[o.face.b].clone().add(s.faces[0].normal)),a.geometry.vertices.push(c.clone().add(c.clone().sub(i[o.face.b].clone())).add(s.faces[0].normal)),a.geometry.faces.push(new THREE.Face3(0,1,2)),a.geometry.faces.push(new THREE.Face3(1,2,3)),a.geometry.faces.push(new THREE.Face3(4,6,5)),a.geometry.faces.push(new THREE.Face3(4,6,7)),a.geometry.faceVertexUvs[0].push([new THREE.Vector2(0,0),new THREE.Vector2(1,0),new THREE.Vector2(0,1)]),a.geometry.faceVertexUvs[0].push([new THREE.Vector2(0,0),new THREE.Vector2(1,1),new THREE.Vector2(0,1)]),a.geometry.faceVertexUvs[0].push([new THREE.Vector2(0,0),new THREE.Vector2(1,1),new THREE.Vector2(1,0)]),a.geometry.faceVertexUvs[0].push([new THREE.Vector2(0,0),new THREE.Vector2(1,1),new THREE.Vector2(0,1)]),a.geometry.uvsNeedUpdate=!0,r.geometry.merge(a.geometry,a.matrix),r.material.materials.push(a.material),n.grassMeshes.push(a)}),n.wrap=api.Wrap(n,r),n.update=function(){},n.update(),n},WHS.init.prototype.addGround=function(e,t,n,r){"use strict";var a={pos:r},o=new api.construct(this,a,e);switch(o.skip=!0,api.extend({width:100,height:100},t),o.materialType=api.loadMaterial(n)._material,e){case"smooth":o.mesh=new Physijs.BoxMesh(new THREE.BoxGeometry(t.width,1,t.height),o.materialType,0);break;case"terrain":var i=document.createElement("canvas");if(i.setAttribute("width",t.width),i.setAttribute("height",t.height),i.getContext){var s=i.getContext("2d");s.drawImage(t.terrain,0,0)}var c=api.TextureLoader().load(o.root._settings.assets+"/textures/terrain/dirt-512.jpg");c.wrapS=c.wrapT=THREE.RepeatWrapping;var l=api.TextureLoader().load(o.root._settings.assets+"/textures/terrain/sand-512.jpg");l.wrapS=l.wrapT=THREE.RepeatWrapping;var u=api.TextureLoader().load(o.root._settings.assets+"/textures/terrain/grass-512.jpg");u.wrapS=u.wrapT=THREE.RepeatWrapping;var m=api.TextureLoader().load(o.root._settings.assets+"/textures/terrain/rock-512.jpg");m.wrapS=m.wrapT=THREE.RepeatWrapping;var p=api.TextureLoader().load(o.root._settings.assets+"/textures/terrain/snow-512.jpg");p.wrapS=p.wrapT=THREE.RepeatWrapping;var d=(THREE.NormalMapShader,256),h=256,f={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat},E=new THREE.WebGLRenderTarget(d,h,f);E.texture=api.TextureLoader().load(o.root._settings.assets+"/terrain/default_terrain.png");var v=new THREE.WebGLRenderTarget(d,h,f);v.texture=api.TextureLoader().load(o.root._settings.assets+"/terrain/NormalMap.png");var g=new THREE.WebGLRenderTarget(256,256,f);g.texture=api.TextureLoader().load(o.root._settings.assets+"/terrain/default_terrain.png");var y=THREE.ShaderTerrain.terrain,w=Object.assign(THREE.UniformsUtils.clone(y.uniforms),{oceanTexture:{type:"t",value:c},sandyTexture:{type:"t",value:l},grassTexture:{type:"t",value:u},rockyTexture:{type:"t",value:m},snowyTexture:{type:"t",value:p},fog:!0,lights:!0},THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{ambient:{type:"c",value:new THREE.Color(16777215)},emissive:{type:"c",value:new THREE.Color(0)},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}});w.tDisplacement.value=E,w.shadowMap.value=[v],w.uDisplacementScale.value=100,w.uRepeatOverlay.value.set(6,6);var n=new THREE.ShaderMaterial({uniforms:w,vertexShader:y.vertexShader,fragmentShader:y.fragmentShader,lights:!0,fog:!0,side:THREE.DoubleSide,shading:THREE.SmoothShading}),T=new THREE.PlaneGeometry(256,256,255,255);T.verticesNeedUpdate=!0,o._rot.set(Math.PI/180*-90,0,0);for(var b=0,H=0,R=s.getImageData(0,0,256,256).data,x=0;255>=x;x++)for(var S=255;S>=0;S--)T.vertices[b].z=R[H]/255*100,H+=4,b++;o.mesh=new Physijs.HeightfieldMesh(T,Physijs.createMaterial(n,.8,.1)),T.computeVertexNormals(),T.computeFaceNormals(),T.computeTangents(),o.mesh.updateMatrix(),o.mesh.castShadow=!0,o.mesh.receiveShadow=!0}return o.build(o.mesh),o.wrap=api.Wrap(o,o.mesh),o},WHS.init.prototype.addFog=function(e,t){"use strict";var n={};switch(api.extend(t,{hex:0,near:.015,far:1e3,density:25e-5}),e){case"fog":n=new THREE.Fog(t.hex,t.near,t.far);break;case"fogexp2":n=new THREE.FogExp2(t.hex,t.density)}return n},WHS.init.prototype.addLight=function(e,t,n,r){var a=new api.construct(this,{pos:n},e);switch(a.skip=!0,WHS.API.extend(t,{color:16777215,skyColor:16777215,groundColor:16777215,intensity:1,distance:100,angle:Math.PI/3}),e){case"ambient":a.mesh=new THREE.AmbientLight(16777215);break;case"directional":a.mesh=new THREE.DirectionalLight(t.color,t.intensity);break;case"hemisphere":a.mesh=new THREE.HemisphereLight(t.skyColor,t.groundColor,t.intensity);break;case"light":a.mesh=new THREE.Light(t.color);break;case"point":a.mesh=new THREE.PointLight(t.color,t.intensity,t.distance);break;case"spot":a.mesh=new THREE.SpotLight(t.color,t.intensity,t.distance,t.angle)}a.mesh.castShadow=!0,a.mesh.shadowMapWidth=1024,a.mesh.shadowMapHeight=1024,a.mesh.shadowBias=1e-4,a.mesh.shadowCameraNear=!0,a.mesh.shadowCameraFar=400,a.mesh.shadowCameraFov=60,a.mesh.shadowDarkness=.3;var o=200;return a.mesh.shadowCameraLeft=-o,a.mesh.shadowCameraRight=o,a.mesh.shadowCameraTop=o,a.mesh.shadowCameraBottom=-o,a.mesh.target&&a.mesh.target.position.set(a._target.x,a._target.y,a._target.z),a.build(),a.wrap=api.Wrap(a,a.mesh),a},WHS.init.prototype.addWagner=function(e,t,n){"use strict";n=n||{};var r={_composer:this._composer},a=api.extend(n,{hex:0,near:.015,far:1e3,density:25e-5});switch(t){case"zoomBlurPass":r.effect=new e.ZoomBlurPass,a=api.extend(a,{strength:.05,center:{x:.5*this._composer.width,y:.5*this._composer.height}});break;case"multiPassBloomPass":r.effect=new e.MultiPassBloomPass,a=api.extend(a,{strength:.5,blurAmount:1.32,applyZoomBlur:!0,zoomBlurStrength:.84,useTexture:!0,center:{x:.5*this._composer.width,y:.5*this._composer.height}}),r.effect.glowTexture=e.Pass.prototype.getOfflineTexture(this._composer.width,this._composer.height,!1);break;case"vignettePass":r.effect=new e.VignettePass,a=api.extend(a,{amount:.7,falloff:.2});break;case"directionalBlurPass":r.effect=new e.DirectionalBlurPass,a=api.extend(a,{delta:.1});break;case"motionBlurPass":r.effect=new e.DirectionalBlurPass,r.motionBlurEnable=!0,a=api.extend(a,{delta:0});break;case"ASCIIPass":r.effect=new e.ASCIIPass;break;case"dotScreenPass":r.effect=new e.DotScreenPass;break;case"fxaaPass":r.effect=new e.FXAAPass;break;case"chromaticAberrationPass":r.effect=new e.ChromaticAberrationPass;break;case"dirtPass":r.effect=new e.DirtPass;break;case"edgeDetectionPass":r.effect=new e.SobelEdgeDetectionPass;break;case"highPassPass":r.effect=new e.HighPassPass;break;case"grayscalePass":r.effect=new e.GrayscalePass;break;case"halftonePass":r.effect=new e.HalftonePass;break;case"invertPass":r.effect=new e.InvertPass;break;default:return void console.warn('No Wagner effect "'+t+'" exists. If it should exist, open an issue. (@addWagner)')}return r.effect.params=a,this._composer.pass(r.effect),this._composer.toScreen(),r.apply=function(){return this._composer.eff.push(r.effect),r},r};var PI_2=Math.PI/2;WHS.init.prototype.MakeFirstPerson=function(e,t){"use strict";var n=WHS.API.extend(t,{block:document.getElementById("blocker"),speed:1,ypos:1});this.controls=new function(e,t,n){function r(e){if(c.enabled!==!1){var t=e.movementX||e.mozMovementX||e.getMovementX()||0,n=e.movementY||e.mozMovementY||e.getMovementY()||0;u.rotation.y-=.002*t,l.rotation.x-=.002*n,l.rotation.x=Math.max(-PI_2,Math.min(PI_2,l.rotation.x))}}function a(e){switch(e.keyCode){case 38:case 87:p=!0;break;case 37:case 65:h=!0;break;case 40:case 83:d=!0;break;case 39:case 68:f=!0;break;case 32:1==E&&t.applyCentralImpulse({x:0,y:300,z:0}),E=!1;break;case 15:s=.5}}function o(e){switch(e.keyCode){case 38:case 87:p=!1;break;case 37:case 65:h=!1;break;case 40:case 83:d=!1;break;case 39:case 68:f=!1;break;case 15:s=.25}}var i=1,s=.25;t.setAngularFactor({x:0,y:0,z:0});var c=this,l=new THREE.Object3D;l.add(e);var u=new THREE.Object3D;u.position.y=n.ypos,u.add(l);var m=new THREE.Quaternion,p=!1,d=!1,h=!1,f=!1,E=!1;t.addEventListener("collision",function(e,t,n,r){r.y<.5&&(E=!0)}),document.body.addEventListener("mousemove",r,!1),document.body.addEventListener("keydown",a,!1),document.body.addEventListener("keyup",o,!1),this.enabled=!1,this.getObject=function(){return u},this.getDirection=function(e){e.set(0,0,-1),m.multiplyVector3(e)};var v=new THREE.Vector3,g=new THREE.Euler;this.update=function(e){new THREE.Vector3;if(c.enabled!==!1){e=e||.5,e=Math.min(e,.5),v.set(0,0,0);var r=i*e*n.speed*s;p&&(v.z=-r),d&&(v.z=r),h&&(v.x=-r),f&&(v.x=r),g.x=l.rotation.x,g.y=u.rotation.y,g.order="XYZ",m.setFromEuler(g),v.applyQuaternion(m),t.applyCentralImpulse({x:10*v.x,y:0,z:10*v.z}),t.setAngularVelocity({x:10*v.z,y:0,z:10*-v.x}),u.position.copy(t.position)}}}(this._camera,e.visible,n);var r=this.controls;if(WHS.API.merge(this.scene,this.controls.getObject()),"pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document){var a=document.body;this.pointerlockchange=function(){document.pointerLockElement===a||document.mozPointerLockElement===a||document.webkitPointerLockElement===a?(r.enabled=!0,n.block.fadeOut()):(r.enabled=!1,n.block.fadeIn())}}document.addEventListener("pointerlockchange",this.pointerlockchange,!1),document.addEventListener("mozpointerlockchange",this.pointerlockchange,!1),document.addEventListener("webkitpointerlockchange",this.pointerlockchange,!1),this.pointerlockerror=function(){console.warn("Pointer lock error.")},document.addEventListener("pointerlockerror",this.pointerlockerror,!1),document.addEventListener("mozpointerlockerror",this.pointerlockerror,!1),document.addEventListener("webkitpointerlockerror",this.pointerlockerror,!1),n.block.addEventListener("click",function(){if(a.requestPointerLock=a.requestPointerLock||a.mozRequestPointerLock||a.webkitRequestPointerLock,a.requestFullscreen=a.requestFullscreen||a.mozRequestFullscreen||a.mozRequestFullScreen||a.webkitRequestFullscreen,/Firefox/i.test(navigator.userAgent)){var e=function t(){(document.fullscreenElement===a||document.mozFullscreenElement===a||document.mozFullScreenElement===a)&&(document.removeEventListener("fullscreenchange",t),document.removeEventListener("mozfullscreenchange",t),a.requestPointerLock())};document.addEventListener("fullscreenchange",e,!1),document.addEventListener("mozfullscreenchange",e,!1),a.requestFullscreen()}else a.requestPointerLock()})},WHS.init.prototype.OrbitControls=function(e){if(this.controls=new THREE.OrbitControls(this._camera,this.renderer.domElement),e)if(e._whsobject){var t=e?e.visible.position:new THREE.Vector3(0,0,0);this.controls.target=t}else"object"==("undefined"==typeof e?"undefined":_typeof(e))?this.controls.target.copy(t):console.error("Object must be a THREE.JS vector! @OrbitControls")},WHS.init.prototype.addSkybox=function(e){"use strict";e.skyType=e.skyType||"box",e.imgSuffix="box"==e.skyType?e.imgSuffix||".png":e.imgSuffix||"";var t=new api.construct(this,e,"skybox");t.skip=!0;var n,r;switch(e.skyType){case"box":var a=["xpos","xneg","ypos","yneg","zpos","zneg"];n=new THREE.CubeGeometry(this._camera.far,this._camera.far,this._camera.far);for(var o=[],i=0;6>i;i++)o.push(new THREE.MeshBasicMaterial({map:THREE.ImageUtils.loadTexture(e.src+a[i]+e.imgSuffix),side:THREE.BackSide}));r=new THREE.MeshFaceMaterial(o);break;case"sphere":n=new THREE.SphereGeometry(this._camera.far/2,60,40),r=new THREE.MeshBasicMaterial({map:THREE.ImageUtils.loadTexture(e.src+e.imgSuffix),side:THREE.BackSide})}return t.mesh=new THREE.Mesh(n,r),t.mesh.renderDepth=1e3,t.build(),t.wrap=api.Wrap(t,t.mesh),t};