/**
 * Â© Alexander Buzin, 2014-2015
 * Site: http://alexbuzin.me/
 * Email: alexbuzin88@gmail.com
*/

"use strict";function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Events(e){var t={},r=[];e=e||this,e.on=function(e,r,o){(t[e]=t[e]||[]).push([r,o])},e.off=function(e,o){e||(t={});for(var a=t[e]||r,n=a.length=o?a.length:0;n--;)o==a[n][0]&&a.splice(n,1)},e.emit=function(e){for(var o,a=t[e]||r,n=0;o=a[n++];)o[0].apply(o[1],r.slice.call(arguments,1))}}function addCSSRule(e,t,r,o){e.insertRule?e.insertRule(t+"{"+r+"}",o):e.addRule&&e.addRule(t,r,o)}var _get=function e(t,r,o){null===t&&(t=Function.prototype);var a=Object.getOwnPropertyDescriptor(t,r);if(void 0===a){var n=Object.getPrototypeOf(t);return null===n?void 0:e(n,r,o)}if("value"in a)return a.value;var i=a.get;if(void 0!==i)return i.call(o)},_createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,r,o){return r&&e(t.prototype,r),o&&e(t,o),t}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};THREE.AnaglyphEffect=function(e,t,r){var o,a,n,i,s=new THREE.Matrix4,c=new THREE.Matrix4,l=125,h=new THREE.PerspectiveCamera;h.matrixAutoUpdate=!1;var p=new THREE.PerspectiveCamera;p.matrixAutoUpdate=!1;var u=new THREE.OrthographicCamera(-1,1,1,-1,0,1),m=new THREE.Scene,d={minFilter:THREE.LinearFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat};void 0===t&&(t=512),void 0===r&&(r=512);var g=new THREE.WebGLRenderTarget(t,r,d),y=new THREE.WebGLRenderTarget(t,r,d),f=new THREE.ShaderMaterial({uniforms:{mapLeft:{type:"t",value:g},mapRight:{type:"t",value:y}},vertexShader:["varying vec2 vUv;","void main() {","	vUv = vec2( uv.x, uv.y );","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D mapLeft;","uniform sampler2D mapRight;","varying vec2 vUv;","void main() {","	vec4 colorL, colorR;","	vec2 uv = vUv;","	colorL = texture2D( mapLeft, uv );","	colorR = texture2D( mapRight, uv );","	gl_FragColor = vec4( colorL.g * 0.7 + colorL.b * 0.3, colorR.g, colorR.b, colorL.a + colorR.a ) * 1.1;","}"].join("\n")}),E=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),f);m.add(E),this.setSize=function(t,r){g&&g.dispose(),y&&y.dispose(),g=new THREE.WebGLRenderTarget(t,r,d),y=new THREE.WebGLRenderTarget(t,r,d),f.uniforms.mapLeft.value=g,f.uniforms.mapRight.value=y,e.setSize(t,r)},this.render=function(t,r){t.updateMatrixWorld(),void 0===r.parent&&r.updateMatrixWorld();var d=o!==r.aspect||a!==r.near||n!==r.far||i!==r.fov;if(d){o=r.aspect,a=r.near,n=r.far,i=r.fov;var f,E,v=r.projectionMatrix.clone(),w=l/30*.5,b=w*a/l,T=a*Math.tan(THREE.Math.degToRad(.5*i));s.elements[12]=w,c.elements[12]=-w,f=-T*o+b,E=T*o+b,v.elements[0]=2*a/(E-f),v.elements[8]=(E+f)/(E-f),h.projectionMatrix.copy(v),f=-T*o-b,E=T*o-b,v.elements[0]=2*a/(E-f),v.elements[8]=(E+f)/(E-f),p.projectionMatrix.copy(v)}h.matrixWorld.copy(r.matrixWorld).multiply(c),h.position.copy(r.position),h.near=r.near,h.far=r.far,e.render(t,h,g,!0),p.matrixWorld.copy(r.matrixWorld).multiply(s),p.position.copy(r.position),p.near=r.near,p.far=r.far,e.render(t,p,y,!0),e.render(m,u)},this.dispose=function(){g&&g.dispose(),y&&y.dispose()}},THREE.BufferGeometryUtils={computeTangents:function(e){function t(e,t,r){d.fromArray(i,3*e),g.fromArray(i,3*t),y.fromArray(i,3*r),f.fromArray(c,2*e),E.fromArray(c,2*t),v.fromArray(c,2*r);var o=g.x-d.x,a=y.x-d.x,n=g.y-d.y,s=y.y-d.y,l=g.z-d.z,h=y.z-d.z,m=E.x-f.x,T=v.x-f.x,H=E.y-f.y,S=v.y-f.y,R=1/(m*S-T*H);w.set((S*o-H*a)*R,(S*n-H*s)*R,(S*l-H*h)*R),b.set((m*a-T*o)*R,(m*s-T*n)*R,(m*h-T*l)*R),p[e].add(w),p[t].add(w),p[r].add(w),u[e].add(b),u[t].add(b),u[r].add(b)}function r(e){L.fromArray(s,3*e),A.copy(L),C=p[e],j.copy(C),j.sub(L.multiplyScalar(L.dot(C))).normalize(),W.crossVectors(A,C),M=W.dot(u[e]),P=0>M?-1:1,h[4*e]=j.x,h[4*e+1]=j.y,h[4*e+2]=j.z,h[4*e+3]=P}var o=e.index,a=e.attributes;if(null===o||void 0===a.position||void 0===a.normal||void 0===a.uv)return void console.warn("THREE.BufferGeometry: Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");var n=o.array,i=a.position.array,s=a.normal.array,c=a.uv.array,l=i.length/3;void 0===a.tangent&&e.addAttribute("tangent",new THREE.BufferAttribute(new Float32Array(4*l),4));for(var h=a.tangent.array,p=[],u=[],m=0;l>m;m++)p[m]=new THREE.Vector3,u[m]=new THREE.Vector3;var d=new THREE.Vector3,g=new THREE.Vector3,y=new THREE.Vector3,f=new THREE.Vector2,E=new THREE.Vector2,v=new THREE.Vector2,w=new THREE.Vector3,b=new THREE.Vector3,T=e.groups;0===T.length&&(T=[{start:0,count:n.length}]);for(var H=0,S=T.length;S>H;++H)for(var R=T[H],_=R.start,x=R.count,O=_,k=_+x;k>O;O+=3)t(n[O+0],n[O+1],n[O+2]);for(var P,C,M,j=new THREE.Vector3,W=new THREE.Vector3,L=new THREE.Vector3,A=new THREE.Vector3,H=0,S=T.length;S>H;++H)for(var R=T[H],_=R.start,x=R.count,O=_,k=_+x;k>O;O+=3)r(n[O+0]),r(n[O+1]),r(n[O+2])}},THREE.OrbitControls=function(e,t){function r(){return 2*Math.PI/60/60*u.autoRotateSpeed}function o(){return Math.pow(.95,u.zoomSpeed)}function a(e){if(u.enabled!==!1){if(e.preventDefault(),0===e.button){if(u.noRotate===!0)return;k=O.ROTATE,d.set(e.clientX,e.clientY)}else if(1===e.button){if(u.noZoom===!0)return;k=O.DOLLY,w.set(e.clientX,e.clientY)}else if(2===e.button){if(u.noPan===!0)return;k=O.PAN,f.set(e.clientX,e.clientY)}u.domElement.addEventListener("mousemove",n,!1),u.domElement.addEventListener("mouseup",i,!1)}}function n(e){if(u.enabled!==!1){e.preventDefault();var t=u.domElement===document?u.domElement.body:u.domElement;if(k===O.ROTATE){if(u.noRotate===!0)return;g.set(e.clientX,e.clientY),y.subVectors(g,d),u.rotateLeft(2*Math.PI*y.x/t.clientWidth*u.rotateSpeed),u.rotateUp(2*Math.PI*y.y/t.clientHeight*u.rotateSpeed),d.copy(g)}else if(k===O.DOLLY){if(u.noZoom===!0)return;b.set(e.clientX,e.clientY),T.subVectors(b,w),T.y>0?u.dollyIn():u.dollyOut(),w.copy(b)}else if(k===O.PAN){if(u.noPan===!0)return;E.set(e.clientX,e.clientY),v.subVectors(E,f),u.pan(v),f.copy(E)}u.update()}}function i(){u.enabled!==!1&&(u.domElement.removeEventListener("mousemove",n,!1),u.domElement.removeEventListener("mouseup",i,!1),k=O.NONE)}function s(e){if(u.enabled!==!1&&u.noZoom!==!0){var t=0;e.wheelDelta?t=e.wheelDelta:e.detail&&(t=-e.detail),t>0?u.dollyOut():u.dollyIn()}}function c(e){if(u.enabled!==!1&&u.noKeys!==!0&&u.noPan!==!0){var t=!1;switch(e.keyCode){case u.keys.UP:u.pan(new THREE.Vector2(0,u.keyPanSpeed)),t=!0;break;case u.keys.BOTTOM:u.pan(new THREE.Vector2(0,-u.keyPanSpeed)),t=!0;break;case u.keys.LEFT:u.pan(new THREE.Vector2(u.keyPanSpeed,0)),t=!0;break;case u.keys.RIGHT:u.pan(new THREE.Vector2(-u.keyPanSpeed,0)),t=!0}t&&u.update()}}function l(e){if(u.enabled!==!1)switch(e.touches.length){case 1:if(u.noRotate===!0)return;k=O.TOUCH_ROTATE,d.set(e.touches[0].pageX,e.touches[0].pageY);break;case 2:if(u.noZoom===!0)return;k=O.TOUCH_DOLLY;var t=e.touches[0].pageX-e.touches[1].pageX,r=e.touches[0].pageY-e.touches[1].pageY,o=Math.sqrt(t*t+r*r);w.set(0,o);break;case 3:if(u.noPan===!0)return;k=O.TOUCH_PAN,f.set(e.touches[0].pageX,e.touches[0].pageY);break;default:k=O.NONE}}function h(e){if(u.enabled!==!1){e.preventDefault(),e.stopPropagation();var t=u.domElement===document?u.domElement.body:u.domElement;switch(e.touches.length){case 1:if(u.noRotate===!0)return;if(k!==O.TOUCH_ROTATE)return;g.set(e.touches[0].pageX,e.touches[0].pageY),y.subVectors(g,d),u.rotateLeft(2*Math.PI*y.x/t.clientWidth*u.rotateSpeed),u.rotateUp(2*Math.PI*y.y/t.clientHeight*u.rotateSpeed),d.copy(g);break;case 2:if(u.noZoom===!0)return;if(k!==O.TOUCH_DOLLY)return;var r=e.touches[0].pageX-e.touches[1].pageX,o=e.touches[0].pageY-e.touches[1].pageY,a=Math.sqrt(r*r+o*o);b.set(0,a),T.subVectors(b,w),T.y>0?u.dollyOut():u.dollyIn(),w.copy(b);break;case 3:if(u.noPan===!0)return;if(k!==O.TOUCH_PAN)return;E.set(e.touches[0].pageX,e.touches[0].pageY),v.subVectors(E,f),u.pan(v),f.copy(E);break;default:k=O.NONE}}}function p(){u.enabled!==!1&&(k=O.NONE)}this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.target=new THREE.Vector3,this.center=this.target,this.noZoom=!1,this.zoomSpeed=1,this.minDistance=0,this.maxDistance=1/0,this.noRotate=!1,this.rotateSpeed=1,this.noPan=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.noKeys=!1,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40};var u=this,m=1e-6,d=new THREE.Vector2,g=new THREE.Vector2,y=new THREE.Vector2,f=new THREE.Vector2,E=new THREE.Vector2,v=new THREE.Vector2,w=new THREE.Vector2,b=new THREE.Vector2,T=new THREE.Vector2,H=0,S=0,R=1,_=new THREE.Vector3,x=new THREE.Vector3,O={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},k=O.NONE,P={type:"change"};this.rotateLeft=function(e){void 0===e&&(e=r()),S-=e},this.rotateUp=function(e){void 0===e&&(e=r()),H-=e},this.panLeft=function(e){var t=new THREE.Vector3,r=this.object.matrix.elements;t.set(r[0],r[1],r[2]),t.multiplyScalar(-e),_.add(t)},this.panUp=function(e){var t=new THREE.Vector3,r=this.object.matrix.elements;t.set(r[4],r[5],r[6]),t.multiplyScalar(e),_.add(t)},this.pan=function(e){var t=u.domElement===document?u.domElement.body:u.domElement;if(void 0!==u.object.fov){var r=u.object.position,o=r.clone().sub(u.target),a=o.length();a*=Math.tan(u.object.fov/2*Math.PI/180),u.panLeft(2*e.x*a/t.clientHeight),u.panUp(2*e.y*a/t.clientHeight)}else void 0!==u.object.top?(u.panLeft(e.x*(u.object.right-u.object.left)/t.clientWidth),u.panUp(e.y*(u.object.top-u.object.bottom)/t.clientHeight)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")},this.dollyIn=function(e){void 0===e&&(e=o()),R/=e},this.dollyOut=function(e){void 0===e&&(e=o()),R*=e},this.update=function(){var e=this.object.position,t=e.clone().sub(this.target),o=Math.atan2(t.x,t.z),a=Math.atan2(Math.sqrt(t.x*t.x+t.z*t.z),t.y);this.autoRotate&&this.rotateLeft(r()),o+=S,a+=H,a=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,a)),a=Math.max(m,Math.min(Math.PI-m,a));var n=t.length()*R;n=Math.max(this.minDistance,Math.min(this.maxDistance,n)),this.target.add(_),t.x=n*Math.sin(a)*Math.sin(o),t.y=n*Math.cos(a),t.z=n*Math.sin(a)*Math.cos(o),e.copy(this.target).add(t),this.object.lookAt(this.target),S=0,H=0,R=1,_.set(0,0,0),x.distanceTo(this.object.position)>0&&(this.dispatchEvent(P),x.copy(this.object.position))},this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1),this.domElement.addEventListener("mousedown",a,!1),this.domElement.addEventListener("mousewheel",s,!1),this.domElement.addEventListener("DOMMouseScroll",s,!1),this.domElement.addEventListener("keydown",c,!1),this.domElement.addEventListener("touchstart",l,!1),this.domElement.addEventListener("touchend",p,!1),this.domElement.addEventListener("touchmove",h,!1)},THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype);var Stats=function(){function e(e,t,r){return e=document.createElement(e),e.id=t,e.style.cssText=r,e}function t(t,r,o){var a=e("div",t,"padding:0 0 3px 3px;text-align:left;background:"+o),n=e("div",t+"Text","font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px;color:"+r);for(n.innerHTML=t.toUpperCase(),a.appendChild(n),t=e("div",t+"Graph","width:74px;height:30px;background:"+r),a.appendChild(t),r=0;74>r;r++)t.appendChild(e("span","","width:1px;height:30px;float:left;opacity:0.9;background:"+o));return a}function r(e){for(var t=l.children,r=0;r<t.length;r++)t[r].style.display=r===e?"block":"none";c=e}function o(e,t){e.appendChild(e.firstChild).style.height=Math.min(30,30-30*t)+"px"}var a=self.performance&&self.performance.now?self.performance.now.bind(performance):Date.now,n=a(),i=n,s=0,c=0,l=e("div","stats","width:80px;opacity:0.9;cursor:pointer");l.addEventListener("mousedown",function(e){e.preventDefault(),r(++c%l.children.length)},!1);var h=0,p=1/0,u=0,m=t("fps","#0ff","#002"),d=m.children[0],g=m.children[1];l.appendChild(m);var y=0,f=1/0,E=0,m=t("ms","#0f0","#020"),v=m.children[0],w=m.children[1];if(l.appendChild(m),self.performance&&self.performance.memory){var b=0,T=1/0,H=0,m=t("mb","#f08","#201"),S=m.children[0],R=m.children[1];l.appendChild(m)}return r(c),{REVISION:14,domElement:l,setMode:r,begin:function(){n=a()},end:function(){var e=a();if(y=e-n,f=Math.min(f,y),E=Math.max(E,y),v.textContent=(0|y)+" MS ("+(0|f)+"-"+(0|E)+")",o(w,y/200),s++,e>i+1e3&&(h=Math.round(1e3*s/(e-i)),p=Math.min(p,h),u=Math.max(u,h),d.textContent=h+" FPS ("+p+"-"+u+")",o(g,h/100),i=e,s=0,void 0!==b)){var t=performance.memory.usedJSHeapSize,r=performance.memory.jsHeapSizeLimit;b=Math.round(9.54e-7*t),T=Math.min(T,b),H=Math.max(H,b),S.textContent=b+" MB ("+T+"-"+H+")",o(R,t/r)}return e},update:function(){n=this.end()}}};"object"===("undefined"==typeof module?"undefined":_typeof(module))&&(module.exports=Stats),THREE.SubdivisionModifier=function(e){this.subdivisions=void 0===e?1:e},THREE.SubdivisionModifier.prototype.modify=function(e){for(var t=this.subdivisions;t-- >0;)this.smooth(e);delete e.__tmpVertices,e.computeFaceNormals(),e.computeVertexNormals()},function(){function e(e,t,r){var o=Math.min(e,t),a=Math.max(e,t),n=o+"_"+a;return r[n]}function t(e,t,r,o,a,n){var i,s=Math.min(e,t),c=Math.max(e,t),l=s+"_"+c;if(l in o)i=o[l];else{var h=r[s],p=r[c];i={a:h,b:p,newEdge:null,faces:[]},o[l]=i}i.faces.push(a),n[e].edges.push(i),n[t].edges.push(i)}function r(e,r,o,a){var n,i,s;for(n=0,i=e.length;i>n;n++)o[n]={edges:[]};for(n=0,i=r.length;i>n;n++)s=r[n],t(s.a,s.b,e,a,s,o),t(s.b,s.c,e,a,s,o),t(s.c,s.a,e,a,s,o)}function o(e,t,r,o){e.push(new THREE.Face3(t,r,o))}var a=!1,n=["a","b","c"];THREE.SubdivisionModifier.prototype.smooth=function(t){var i,s,c,l,h,p,u,m,d,g,y,y,f,E,v=new THREE.Vector3;i=t.vertices,s=t.faces,g=new Array(i.length),y={},r(i,s,g,y),f=[];var w,b,T,H,S,R,_;for(p in y){for(b=y[p],T=new THREE.Vector3,S=3/8,R=1/8,_=b.faces.length,2!=_&&(S=.5,R=0,1!=_&&a&&console.warn("Subdivision Modifier: Number of connected faces != 2, is: ",_,b)),T.addVectors(b.a,b.b).multiplyScalar(S),v.set(0,0,0),m=0;_>m;m++){for(H=b.faces[m],d=0;3>d&&(w=i[H[n[d]]],w===b.a||w===b.b);d++);v.add(w)}v.multiplyScalar(R),T.add(v),b.newEdge=f.length,f.push(T)}var x,O,k,P,C,M,j;for(E=[],p=0,u=i.length;u>p;p++){for(M=i[p],C=g[p].edges,h=C.length,3==h?x=3/16:h>3&&(x=3/(8*h)),O=1-h*x,k=x,2>=h&&(2==h?(a&&console.warn("2 connecting edges",C),O=.75,k=1/8):1==h?a&&console.warn("only 1 connecting edge"):0==h&&a&&console.warn("0 connecting edges")),j=M.clone().multiplyScalar(O),v.set(0,0,0),m=0;h>m;m++)P=C[m],w=P.a!==M?P.a:P.b,v.add(w);v.multiplyScalar(k),j.add(v),E.push(j)}c=E.concat(f);var W,L,A,D=E.length;for(l=[],p=0,u=s.length;u>p;p++)H=s[p],W=e(H.a,H.b,y).newEdge+D,L=e(H.b,H.c,y).newEdge+D,A=e(H.c,H.a,y).newEdge+D,o(l,W,L,A),o(l,H.a,W,A),o(l,H.b,L,W),o(l,H.c,A,L);t.vertices=c,t.faces=l}}(),addCSSRule(document.styleSheets[0],"@keyframes fadeOut","to {opacity: 0}",0),addCSSRule(document.styleSheets[0],"@keyframes fadeIn","from {opacity: 0} to {opacity: 1}",0),Element.prototype.fadeOut=function(e){this.style.webkitAnimationDuration=(e||1)+"s",this.style.webkitAnimationName="fadeOut",this.style.webkitAnimationPlayState="running",this.addEventListener("animationend",function(){this.style.display="none",this.style.webkitAnimationPlayState="paused"})},Element.prototype.fadeIn=function(e,t){this.style.display=t||"block",this.style.webkitAnimationDuration=(e||1)+"s",this.style.webkitAnimationName="fadeIn",this.style.webkitAnimationPlayState="running",this.addEventListener("animationend",function(){this.style.display=t||"block"})},"undefined"==typeof Array.isArray&&(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),function(){if(!MouseEvent.prototype.hasOwnProperty("movementX")||!MouseEvent.prototype.hasOwnProperty("mozMovementX")){var e={lastX:0,lastY:0};MouseEvent.prototype.getMovementX=function(){var t=this.clientX-e.lastX;return e.lastX=this.clientX,t},MouseEvent.prototype.getMovementY=function(){var t=this.clientY-e.lastY;return e.lastY=this.clientY,t}}}(),Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if(void 0===e||null===e)throw new TypeError("Cannot convert first argument to object");for(var t=Object(e),r=1;r<arguments.length;r++){var o=arguments[r];if(void 0!==o&&null!==o){o=Object(o);for(var a=Object.keys(o),n=0,i=a.length;i>n;n++){var s=a[n],c=Object.getOwnPropertyDescriptor(o,s);void 0!==c&&c.enumerable&&(t[s]=o[s])}}}return t}});var WHS={REVISION:"7",API:{},_settings:{assets:"./assets",path_worker:"../libs/physijs_worker.js",path_ammo:"../libs/ammo.js"},loops:[],grounds:[]},api=WHS.API;"function"==typeof define&&define.amd?define("whitestorm",WHS):"undefined"!=typeof exports&&"undefined"!=typeof module&&(module.exports=WHS),THREE.ShaderTerrain={terrain:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{enableDiffuse1:{type:"i",value:0},enableDiffuse2:{type:"i",value:0},enableSpecular:{type:"i",value:0},enableReflection:{type:"i",value:0},tDiffuse1:{type:"t",value:null},tDiffuse2:{type:"t",value:null},tDetail:{type:"t",value:null},tNormal:{type:"t",value:null},tSpecular:{type:"t",value:null},tDisplacement:{type:"t",value:null},uNormalScale:{type:"f",value:1},uDisplacementBias:{type:"f",value:0},uDisplacementScale:{type:"f",value:1},diffuse:{type:"c",value:new THREE.Color(15658734)},specular:{type:"c",value:new THREE.Color(1118481)},shininess:{type:"f",value:30},opacity:{type:"f",value:1},uRepeatBase:{type:"v2",value:new THREE.Vector2(1,1)},uRepeatOverlay:{type:"v2",value:new THREE.Vector2(1,1)},uOffset:{type:"v2",value:new THREE.Vector2(0,0)}}]),fragmentShader:["\n		        uniform vec3 diffuse;\n		        uniform vec3 emissive;\n		        uniform float opacity;\n		        uniform vec3 ambientLightColor;\n		        varying vec3 vLightFront;\n		        #ifdef DOUBLE_SIDED\n			        varying vec3 vLightBack;\n			        uniform vec2 uRepeatOverlay;\n			        uniform vec2 uRepeatBase;\n			        uniform vec2 uOffset;\n			        uniform float uNormalScale;\n			        uniform sampler2D tNormal;\n		        #endif\n		        uniform sampler2D oceanTexture;\n		        uniform sampler2D sandyTexture;\n		        uniform sampler2D grassTexture;\n		        uniform sampler2D rockyTexture;\n		        uniform sampler2D snowyTexture;\n		        varying vec3 vTangent;\n		        varying vec3 vBinormal;\n		        varying vec3 vNormal;\n		        varying vec3 vViewPosition;\n		"+[THREE.ShaderChunk.common,THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.alphamap_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment].join("\n")+"\n		        varying vec2 vUv;\n		        varying float vAmount;\n		        void main() {\n		        	// UVs.\n		            vec2 uvOverlay = uRepeatOverlay * vUv + uOffset;\n		            vec2 uvBase = uRepeatBase * vUv;\n					vec3 specularTex = vec3( 1.0 );\n		            vec3 normalTex = texture2D( tNormal, uvOverlay ).xyz * 2.0 - 1.0;\n		            normalTex.xy *= uNormalScale;\n		            normalTex = normalize( normalTex );\n		            mat3 tsb = mat3( vTangent, vBinormal, vNormal );\n		            vec3 finalNormal = tsb * normalTex;\n		            vec3 normal = normalize( finalNormal );\n		            vec3 viewPosition = normalize( vViewPosition );\n		            vec3 shadowMask = vec3( 1.0 );\n		            vec3 outgoingLight = vec3( 0.0 );\n		            vec3 totalAmbientLight = ambientLightColor;\n		            vec4 diffuseColor = vec4(0.0);\n		            // Color by texture.\n		            vec4 water = (smoothstep(0.01, 0.25, vAmount)\n		            - smoothstep(0.24, 0.26, vAmount))\n		            * texture2D( oceanTexture, vUv * 10.0 );\n		            vec4 sandy = (smoothstep(0.24, 0.27, vAmount)\n		            - smoothstep(0.28, 0.31, vAmount))\n		            * texture2D( sandyTexture, vUv * 10.0 );\n		            vec4 grass = (smoothstep(0.28, 0.32, vAmount)\n		            - smoothstep(0.35, 0.40, vAmount))\n		            * texture2D( grassTexture, vUv * 20.0 );\n		            vec4 rocky = (smoothstep(0.30, 0.40, vAmount)\n		            - smoothstep(0.40, 0.70, vAmount))\n		            * texture2D( rockyTexture, vUv * 20.0 );\n		            vec4 snowy = (smoothstep(0.42, 0.45, vAmount))\n		            * texture2D( snowyTexture, vUv * 10.0 );\n		            diffuseColor = vec4(0.0, 0.0, 0.0, 1.0)\n		            + water + sandy + grass + rocky + snowy;\n		"+[THREE.ShaderChunk.logdepthbuf_fragment,THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphamap_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment].join("\n")+"\n		            #ifdef DOUBLE_SIDED\n		                if ( gl_FrontFacing )\n		                    outgoingLight += diffuseColor.rgb * \n		                		( vLightFront * shadowMask + totalAmbientLight )\n		                		+ emissive;\n		                else\n		                    outgoingLight += diffuseColor.rgb * \n		                		( vLightBack * shadowMask + totalAmbientLight )\n		                		+ emissive;\n		            #else\n		                outgoingLight += diffuseColor.rgb * \n		                	( vLightFront * shadowMask + totalAmbientLight )\n		                	+ emissive;\n		            #endif\n		           gl_FragColor = vec4( outgoingLight, diffuseColor.a );\n		      }\n		"],vertexShader:["\n		    #define TERRAIN;\n		    varying vec3 vLightFront;\n		    #ifdef DOUBLE_SIDED\n		        varying vec3 vLightBack;\n		    #endif\n		    \n		    varying float vAmount;\n		    attribute vec4 tangent;\n		    uniform vec2 uRepeatBase;\n		    uniform sampler2D tNormal;\n		    #ifdef VERTEX_TEXTURES\n			    uniform sampler2D tDisplacement;\n			    uniform float uDisplacementScale;\n			    uniform float uDisplacementBias;\n		    #endif\n		    varying vec3 vTangent;\n		    varying vec3 vBinormal;\n		    varying vec3 vNormal;\n		    varying vec2 vUv;\n		    varying vec3 vViewPosition;\n		"+[THREE.ShaderChunk.common,THREE.ShaderChunk.uv_pars_vertex,THREE.ShaderChunk.uv2_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_lambert_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex].join("\n")+"\n		    void main() {\n		"+[THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.beginnormal_vertex,THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,THREE.ShaderChunk.begin_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.project_vertex,THREE.ShaderChunk.logdepthbuf_vertex,THREE.ShaderChunk.uv_vertex,THREE.ShaderChunk.uv2_vertex].join("\n")+"\n			    vNormal = normalize( normalMatrix * normal);\n			    // Tangent and binormal vectors.\n			    vTangent = normalize( normalMatrix * tangent.xyz );\n			    vBinormal = cross( vNormal, vTangent ) * tangent.w;\n			    vBinormal = normalize( vBinormal );\n			    // Texture coordinates.\n			    vUv = uv;\n			    vec2 uvBase = uv * uRepeatBase;\n			    // displacement mapping\n			    vec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n			    mvPosition = modelViewMatrix * vec4( position, 1.0 );\n			    transformedNormal = normalize( normalMatrix * normal );\n			    gl_Position = projectionMatrix * mvPosition;\n			    vViewPosition = -mvPosition.xyz;\n			    vAmount = position.z * 0.005 + 0.1;\n		"+[THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.lights_lambert_vertex,THREE.ShaderChunk.shadowmap_vertex].join("\n")+"\n		   }\n		"],side:THREE.DoubleSide,shading:THREE.SmoothShading}},WHS.API.extend=function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),o=1;t>o;o++)r[o-1]=arguments[o];var a=!0,n=!1,i=void 0;try{for(var s,c=r[Symbol.iterator]();!(a=(s=c.next()).done);a=!0){var l=s.value;if(l){var h=!0,p=!1,u=void 0;try{for(var m,d=Object.getOwnPropertyNames(l)[Symbol.iterator]();!(h=(m=d.next()).done);h=!0){var g=m.value;void 0!=e[g]&&"[object Object]"==e[g].toString()&&"[object Object]"==l[g].toString()?WHS.API.extend(e[g],l[g]):e[g]=0===e[g]?0:e[g]||l[g]}}catch(y){p=!0,u=y}finally{try{!h&&d["return"]&&d["return"]()}finally{if(p)throw u}}}}}catch(y){n=!0,i=y}finally{try{!a&&c["return"]&&c["return"]()}finally{if(n)throw i}}return e},WHS.API.getheight=function(e,t,r,o){return t=t||1e3,o=o||1,this.raycaster=new THREE.Raycaster(new THREE.Vector3(e.x,t,o*e.y),new THREE.Vector3(0,-1,0)),this.intersect=this.raycaster.intersectObject(r.mesh),this.intersect},WHS.Light=function(){function e(t,r){_classCallCheck(this,e);var o=function(e,t,r){this.x=e,this.y=t,this.z=r};t.pos&&(t.pos.set=o),t.rot&&(t.rot.set=o),t.target&&(t.target.set=o);var a=api.extend(t,{light:{color:16777215,skyColor:16777215,groundColor:16777215,intensity:1,distance:100,angle:Math.PI/3},shadowmap:{cast:!0,bias:1e-4,width:1024,height:1024,near:!0,far:400,fov:60,darkness:.3,top:200,bottom:-200,left:-200,right:200},pos:{x:0,y:0,z:0,set:o},rot:{x:0,y:0,z:0,set:o},target:{x:0,y:0,z:0,set:o}}),n=0,i={_key:n,_type:r,_whsobject:!0,_name:r+n,__releaseTime:(new Date).getTime(),_pos:a.pos,_rot:a.rot,_target:a.target,_light:a.light,_shadowmap:a.shadowmap,ready:new Events};return Object.assign(this,i),this}return _createClass(e,[{key:"build",value:function(){for(var e=this,t=arguments.length,r=Array(t),o=0;t>o;o++)r[o]=arguments[o];var a=this.mesh,n=this;return this.build_state=new Promise(function(t,o){try{a.castShadow=!0,a.receiveShadow=!0,a.position.set(e._pos.x,e._pos.y,e._pos.z),a.rotation.set(e._rot.x,e._rot.y,e._rot.z),r.forEach(function(e){n[e]=!0}),t()}catch(i){console.error(i.message),o()}}),this}},{key:"addTo",value:function(e){this.root=e;var t=this.mesh,r=this;return console.log(this),this._key=this.root.modellingQueue.length,r._state=new Promise(function(e,o){try{api.merge(r.root.scene,t),r.root.modellingQueue.push(r)}catch(a){console.error(a.message),o()}finally{r._wait?r._mesh.addEventListener("ready",function(){e(),r.ready.emit("ready")}):(e(),r.ready.emit("ready"))}}),r.root.children.push(r),this}},{key:"buildShadow",value:function(){this.mesh.shadowMapWidth=this._shadowmap.width,this.mesh.shadowMapHeight=this._shadowmap.height,this.mesh.shadowBias=this._shadowmap.bias,this.mesh.shadowCameraNear=this._shadowmap.near,this.mesh.shadowCameraFar=this._shadowmap.far,this.mesh.shadowCameraFov=this._shadowmap.fov,this.mesh.shadowDarkness=this._shadowmap.darkness,this.mesh.shadowCameraLeft=this._shadowmap.left,this.mesh.shadowCameraRight=this._shadowmap.right,this.mesh.shadowCameraTop=this._shadowmap.top,this.mesh.shadowCameraBottom=this._shadowmap.bottom}},{key:"remove",value:function(){return this.root.scene.remove(this.mesh),this}},{key:"retrieve",value:function(){return this.root.scene.add(this.mesh),this}}]),e}(),WHS.API.JSONLoader=function(){return new THREE.JSONLoader},WHS.API.TextureLoader=function(){return new THREE.TextureLoader},WHS.API.loadMaterial=function(e){"string"!=typeof e.kind&&console.error("Type of material is undefined or not a string. @loadMaterial");var t={_type:e.kind,_restitution:e.restitution||e.rest||.3,_friction:e.friction||e.fri||.8},r=api.extend({},e);switch(delete r.kind,delete r.friction,delete r.fri,delete r.restitution,delete r.rest,e.kind){case"basic":t._material=new THREE.MeshBasicMaterial(r);break;case"linebasic":t._params=new THREE.LineBasicMaterial(r);break;case"linedashed":t._material=new THREE.LineDashedMaterial(r);break;case"material":t._material=new THREE.Material(r);break;case"depth":t._material=new THREE.MeshDepthMaterial(r);break;case"face":t._material=new THREE.MeshFaceMaterial(r);break;case"lambert":t._material=new THREE.MeshLambertMaterial(r);break;case"normal":t._material=new THREE.MeshNormalMaterial(r);break;case"phong":t._material=new THREE.MeshPhongMaterial(r);break;case"pointcloud":t._material=new THREE.PointCloudMaterial(r);break;case"rawshader":t._material=new THREE.RawShaderMaterial(r);break;case"shader":t._material=new THREE.ShaderMaterial(r);break;case"spritecanvas":t._material=new THREE.SpriteCanvasMaterial(r);break;case"sprite":t._material=new THREE.SpriteMaterial(r)}return t._material=Physijs.createMaterial(t._material,t._friction,t._restitution),console.log(t._friction),t},WHS.API.merge=function(e,t){if(("object"!==("undefined"==typeof e?"undefined":_typeof(e))||"object"!==("undefined"==typeof t?"undefined":_typeof(t)))&&console.error("No rabbits for the box. (arguments)",["undefined"==typeof e?"undefined":_typeof(e),"undefined"==typeof t?"undefined":_typeof(t)]),e)if(Array.isArray(t)&&1===t.length)e.add(t[0]);else if(Array.isArray(t)&&t.length>1&&e)for(var r=0;r<t.length;r++)e.add(t[r]);else Array.isArray(t)||e.add(t);else console.error("box is undefined. Line "+(new Error).lineNumber+". Func merge.",[e,t])},WHS.API.PackUvs=function(e){e.computeBoundingBox();var t=e.boundingBox.max,r=e.boundingBox.min,o=new THREE.Vector2(0-r.x,0-r.y),a=new THREE.Vector2(t.x-r.x,t.y-r.y);e.faceVertexUvs[0]=[];for(var n=e.faces,i=0;i<e.faces.length;i++){var s=e.vertices[n[i].a],c=e.vertices[n[i].b],l=e.vertices[n[i].c];e.faceVertexUvs[0].push([new THREE.Vector2((s.x+o.x)/a.x,(s.y+o.y)/a.y),new THREE.Vector2((c.x+o.x)/a.x,(c.y+o.y)/a.y),new THREE.Vector2((l.x+o.x)/a.x,(l.y+o.y)/a.y)])}e.uvsNeedUpdate=!0},WHS.API.removeDuplicateFaces=function(e){function t(){return!(a1.sort()>a2.sort()||a1.sort()<a2.sort())}for(var r=0;r<e.faces.length;r++)for(var o=e.faces[r],a=[o.a,o.b,o.c,o.d].sort(),n=0;r>n;n++){var i=e.faces[n];if(void 0!==i){var s=[i.a,i.b,i.c,i.d].sort();t(a,s)&&(delete e.faces[r],delete e.faces[n])}}return e.faces=e.faces.filter(function(e){return void 0===e}),e},WHS.API.rotateGeometry=function(e,t){var r=new THREE.Matrix4;r.makeRotationFromEuler(new THREE.Euler(t.x,t.y,t.z,"XYZ"));for(var o in e.vertices)e.vertices[o].applyMatrix4(r);return e},WHS.Shape=function(){function e(t,r){_classCallCheck(this,e);var o=function(e,t,r){this.x=e,this.y=t,this.z=r};t.pos&&(t.pos.set=o),t.rot&&(t.rot.set=o),t.scale&&(t.scale.set=o),t.target&&(t.target.set=o);var a=api.extend(t,{mass:10,pos:{x:0,y:0,z:0,set:o},rot:{x:0,y:0,z:0,set:o},scale:{x:1,y:1,z:1,set:o},target:{x:0,y:0,z:0,set:o},morph:{speed:1,duration:1},onlyvis:!1}),n=0,i={_key:n,_type:r,_whsobject:!0,_name:r+n,__releaseTime:(new Date).getTime(),_pos:a.pos,_rot:a.rot,_scale:a.scale,_morph:a.morph,_target:a.target,_onlyvis:a.onlyvis,ready:new Events};return Object.assign(this,i),this}return _createClass(e,[{key:"build",value:function(){console.log(this);for(var e=this,t=arguments.length,r=Array(t),o=0;t>o;o++)r[o]=arguments[o];return r.indexOf("wait")>=0?e._loading.then(function(){e.build_state=new Promise(function(t,r){try{e.mesh.castShadow=!0,e.mesh.receiveShadow=!0,e.mesh.position.set(e._pos.x,e._pos.y,e._pos.z),
e.mesh.rotation.set(e._rot.x,e._rot.y,e._rot.z),e.mesh.scale.set(e._scale.x,e._scale.y,e._scale.z),t()}catch(o){console.error(o.message),r()}})}):e.build_state=new Promise(function(t,r){try{e.mesh.castShadow=!0,e.mesh.receiveShadow=!0,e.mesh.position.set(e._pos.x,e._pos.y,e._pos.z),e.mesh.rotation.set(e._rot.x,e._rot.y,e._rot.z),e.mesh.scale.set(e._scale.x,e._scale.y,e._scale.z),t()}catch(o){console.error(o.message),r()}}),this}},{key:"addTo",value:function(e){this.root=e;var t=this.mesh,r=this;this._key=this.root.modellingQueue.length;for(var o=arguments.length,a=Array(o>1?o-1:0),n=1;o>n;n++)a[n-1]=arguments[n];return console.log([a,a.indexOf("wait"),r]),a.indexOf("wait")>=0?r._loading.then(function(){r._state=new Promise(function(e,t){try{api.merge(r.root.scene,r.mesh),r.root.modellingQueue.push(r)}catch(o){console.error(o.message),t()}finally{r._wait?r._mesh.addEventListener("ready",function(){e(),r.ready.emit("ready")}):(e(),r.ready.emit("ready"))}})}):r._state=new Promise(function(e,o){try{api.merge(r.root.scene,t),r.root.modellingQueue.push(r)}catch(a){console.error(a.message),o()}finally{r._wait?r._mesh.addEventListener("ready",function(){e(),r.ready.emit("ready")}):(e(),console.log("wqd"),r.ready.emit("ready"))}}),r.root.children.push(r),this}},{key:"_initMaterial",value:function(e){return api.loadMaterial(e)._material}},{key:"remove",value:function(){return this.root.scene.remove(this.mesh),this}},{key:"retrieve",value:function(){return this.root.scene.add(this.mesh),this}}]),e}(),WHS.API.texture=function(e,t){var r=api.TextureLoader().load(e);if(t){var o=api.extend(t,{offset:{x:0,y:0},repeat:{x:1,y:1}});r.wrapS=r.wrapT=THREE.RepeatWrapping,r.offset.set(o.offset.x,o.offset.y),r.repeat.set(o.repeat.x,o.repeat.y),r.magFilter=THREE.NearestFilter,r.minFilter=THREE.LinearMipMapLinearFilter}return r},WHS.API.Triangulate=function(e,t){if(e instanceof THREE.Geometry){if(t){var r=new THREE.Geometry,o=[];e.faces.forEach(function(a){var n=new THREE.Geometry;[].push.apply(n.vertices,[e.vertices[a.a],e.vertices[a.b],e.vertices[a.c]]),n.faceVertexUvs[0].push([new THREE.Vector2(0,0),new THREE.Vector2(0,1),new THREE.Vector2(1,1),new THREE.Vector2(1,0)]),n.faces.push(new THREE.Face3(0,1,2)),n.computeFaceNormals();var i=new THREE.Mesh(n,t);i.updateMatrix(),r.merge(i.geometry,i.matrix),o.push(t)});var a=new THREE.Mesh(r,new THREE.MeshFaceMaterial(o));return a}}else console.error("No THREE.js geometry")},WHS.Watch=function(e){return this._queue=Array.isArray(e)?e.slice():[],this},WHS.Watch.prototype.add=function(e){return this._queue.push(e),this},WHS.Watch.prototype.remove=function(e){return this._queue=this._queue.filter(function(t){return t!=e}),this},WHS.loop=function(e){this.loop={func:e,id:WHS.loops.length,enabled:!1},WHS.loops.push(this.loop)},WHS.loop.prototype.start=function(){this.loop.enabled=!0},WHS.loop.prototype.stop=function(){this.loop.enabled=!1},WHS.init=function(){function e(t){_classCallCheck(this,e),console.log("WHS.init",WHS.REVISION),THREE||console.warn("whitestormJS requires THREE.js. {Object} THREE not found."),Physijs||console.warn("whitestormJS requires PHYSI.js. {Object} Physijs not found."),WAGNER||console.warn("whitestormJS requires WAGNER.js. {Object} WAGNER not found.");var r=api.extend(t,{anaglyph:!1,helper:!1,stats:!1,wagner:!0,autoresize:!1,shadowmap:!0,gravity:{x:0,y:0,z:0},camera:{aspect:75,near:1,far:1e3,x:0,y:0,z:0},rWidth:window.innerWidth,rHeight:window.innerHeight,width:window.innerWidth,height:window.innerHeight,physics:{quatNormalizeSkip:0,quatNormalizeFast:!1,solver:{iterations:20,tolerance:0},defMaterial:{contactEquationStiffness:1e8,contactEquationRegularizationTime:3}},background:0,assets:"./assets",container:document.body,path_worker:"../libs/physijs_worker.js",path_ammo:"../libs/ammo.js"});this._settings=r,Physijs.scripts.worker=r.path_worker,Physijs.scripts.ammo=r.path_ammo,this.scene=new Physijs.Scene,this.scene.setGravity(new THREE.Vector3(t.gravity.x,t.gravity.y,t.gravity.z));var o=document.createElement("div");o.className="whs",r.container.appendChild(o),r.stats&&(this._stats=new Stats,"fps"==r.stats?this._stats.setMode(0):"ms"==r.stats?this._stats.setMode(1):"mb"==r.stats?this._stats.setMode(1):(this._stats.setMode(0),console.warn([this._stats],"Please, apply stats mode [fps, ms, mb] .")),this._stats.domElement.style.position="absolute",this._stats.domElement.style.left="0px",this._stats.domElement.style.bottom="0px",o.appendChild(this._stats.domElement));var a=new THREE.PerspectiveCamera(r.camera.aspect,r.width/r.height,r.camera.near,r.camera.far);a.position.set(r.camera.x,r.camera.y,r.camera.z),api.merge(this.scene,a);var n=new THREE.WebGLRenderer;n.setClearColor(r.background),n.shadowMap.enabled=r.shadowmap,n.shadowMap.type=THREE.PCFSoftShadowMap,n.shadowMap.cascade=!0,r.anaglyph?(this.effect=new THREE.AnaglyphEffect(n),this.effect.setSize(r.rWidth,r.rHeight),this.effect.render(this.scene,a)):(n.setSize(r.rWidth,r.rHeight),n.render(this.scene,a)),n.domElement.style.width="100%",n.domElement.style.height="100%",o.appendChild(n.domElement),r.container.style.margin=0,r.container.style.padding=0,r.container.style.position="relative",r.container.style.overflow="hidden",r.wagner&&(this._composer=new WAGNER.Composer(n),this._composer.setSize(r.rWidth,r.rHeight),this._composer.autoClearColor=!0,this._composer.reset(),this._composer.render(this.scene,a),this._composer.eff=[]),Object.assign(this,{_camera:a,renderer:n,_settings:r,modellingQueue:[],children:[],_dom:o});var i=this;return r.autoresize&&window.addEventListener("load resize",function(){i._camera.aspect=window.innerWidth/window.innerHeight,i._camera.updateProjectionMatrix(),i.renderer.setSize(r.rWidth,r.rHeight)}),i}return _createClass(e,[{key:"start",value:function(){function e(o){requestAnimationFrame(e),r._stats&&r._stats.begin();for(var a=0;a<r.modellingQueue.length;a++)"morph"==r.modellingQueue[a]._type&&r.modellingQueue[a].mesh.mixer.update(t.getDelta());r.scene.simulate(),r.controls&&(r.controls.update(Date.now()-r.time),r.time=Date.now()),r._composer&&(r._composer.reset(),r._composer.render(r.scene,r._camera),r._composer.eff.forEach(function(e){r._composer.pass(e)}),r._composer.toScreen()),r._stats&&r._stats.end(),WHS.loops.forEach(function(e){e.enabled&&e.func(o)})}var t=new THREE.Clock,r=this;r._events=new Events,this.update=e,r.update()}}]),e}(),WHS.init.prototype.addModel=function(e,t){var r=new api.construct(this,t,"model");return r.materialType=api.loadMaterial(t.materialOptions)._material,api.JSONLoader().load(e,function(e){e.computeFaceNormals(),e.computeVertexNormals(),r.mesh=new Physijs.ConcaveMesh(e,r.materialType,t.mass),r._wait=!0,r.build().wrap()}),r},WHS.init.prototype.addMorph=function(e,t){var r=new WHS.Shape(this,t,"morph");return r.skip=!0,r.morph=!0,api.JSONLoader().load(e,function(e){var t=new THREE.MeshLambertMaterial({color:16755285,morphTargets:!0,vertexColors:THREE.FaceColors});r.mesh=new THREE.Mesh(e,t),r.mesh.speed=r._morph.speed,r._mixer=new THREE.AnimationMixer(r.mesh),r._mixer.addAction(new THREE.AnimationAction(e.animations[0]).warpToDuration(.5)),r._mixer.update(600*Math.random()),r.mesh.mixer=r._mixer,r._rot.y=Math.PI/2,r.build(r.mesh).wrap()}),r},WHS.init.prototype.addObject=function(e,t){var r=new WHS.Shape(this,t,e),o=t.onlyvis?r._target.mass:1;switch(r.materialType=api.loadMaterial(t.materialOptions)._material,t.geometryOptions=t.geometryOptions||{},e){case"sphere":api.extend(t.geometryOptions,{radius:1,segmentA:32,segmentB:32}),r.mesh=new Physijs.SphereMesh(new THREE.SphereGeometry(t.geometryOptions.radius,t.geometryOptions.segmentA,t.geometryOptions.segmentB),r.materialType,10);break;case"cube":api.extend(t.geometryOptions,{width:1,height:1,depth:1}),r.mesh=new Physijs.BoxMesh(new THREE.BoxGeometry(t.geometryOptions.width,t.geometryOptions.height,t.geometryOptions.depth),r.materialType,o);break;case"cylinder":api.extend(t.geometryOptions,{radiusTop:1,radiusBottom:1,height:1,radiusSegments:32}),r.mesh=new Physijs.CylinderMesh(new THREE.CylinderGeometry(t.geometryOptions.radiusTop,t.geometryOptions.radiusBottom,t.geometryOptions.height,t.geometryOptions.radiusSegments),r.materialType,o);break;case"dodecahedron":api.extend(t.geometryOptions,{radius:1,detail:0}),r.mesh=new Physijs.ConvexMesh(new THREE.DodecahedronGeometry(t.geometryOptions.radius,t.geometryOptions.detail),r.materialType,o);break;case"extrude":api.extend(t.geometryOptions,{shapes:[],options:{}}),r.mesh=new Physijs.ConvexMesh(new THREE.ExtrudeGeometry(t.geometryOptions.shapes,t.geometryOptions.options),r.materialType,o);break;case"icosahedron":api.extend(t.geometryOptions,{radius:1,detail:0}),r.mesh=new Physijs.ConvexMesh(new THREE.IcosahedronGeometry(t.geometryOptions.radius,t.geometryOptions.detail),r.materialType,o);break;case"lathe":api.extend(t.geometryOptions,{points:[]}),r.mesh=new Physijs.ConvexMesh(new THREE.LatheGeometry(t.geometryOptions.points),r.materialType,o);break;case"octahedron":api.extend(t.geometryOptions,{radius:1,detail:0}),r.mesh=new Physijs.ConvexMesh(new THREE.OctahedronGeometry(t.geometryOptions.radius,t.geometryOptions.detail),r.materialType,o);break;case"parametric":api.extend(t.geometryOptions,{func:function(){},slices:10,stacks:10}),r.mesh=new Physijs.ConvexMesh(new THREE.ParametricGeometry(t.geometryOptions.func,t.geometryOptions.slices,t.geometryOptions.stacks),r.materialType,o);break;case"plane":api.extend(t.geometryOptions,{width:1,height:0,segments:32}),r.mesh=new Physijs.ConvexMesh(new THREE.PlaneBufferGeometry(t.geometryOptions.width,t.geometryOptions.height,t.geometryOptions.segments),r.materialType,o);break;case"polyhedron":api.extend(t.geometryOptions,{verticesOfCube:[],indicesOfFaces:[],radius:1,detail:1}),r.mesh=new Physijs.ConvexMesh(new THREE.PolyhedronGeometry(t.geometryOptions.verticesOfCube,t.geometryOptions.indicesOfFaces),r.materialType,o);break;case"ring":api.extend(t.geometryOptions,{innerRadius:2,outerRadius:5,thetaSegments:30,phiSegments:30,thetaStart:0,thetaLength:2*Math.PI}),r.mesh=new Physijs.ConcaveMesh(new THREE.TorusGeometry(t.geometryOptions.outerRadius,(t.geometryOptions.outerRadius-t.geometryOptions.innerRadius)/2,t.geometryOptions.thetaSegments,t.geometryOptions.phiSegments),r.materialType,o);break;case"shape":r.mesh=new THREE.Mesh(new THREE.ShapeGeometry(t.geometryOptions.shapes),r.materialType),r.onlyvis=!0,console.warn("This is not physic object. 2D!",[r]);break;case"tetrahedron":api.extend(t.geometryOptions,{radius:1,detail:0}),r.mesh=new Physijs.ConvexMesh(new THREE.TetrahedronGeometry(t.geometryOptions.radius,t.geometryOptions.detail),r.materialType,o);break;case"text":if(!t.geometryOptions.parameters)throw new Error("Missing text parameters");r.mesh=new Physijs.ConcaveMesh(new THREE.TextGeometry(api.extend(t.geometryOptions,{text:"Hello World!"}),api.extend(t.geometryOptions.parameters,{size:1,height:50,curveSegments:1,font:"Adelle",weight:"normal",style:"normal",bevelEnabled:!1,bevelThickness:10,bevelSize:8})),r.materialType,masss);break;case"torus":api.extend(t.geometryOptions,{radius:100,tube:40,radialSegments:8,tubularSegments:6,arc:2*Math.PI}),r.mesh=new Physijs.ConcaveMesh(new THREE.TorusGeometry(t.geometryOptions.radius,t.geometryOptions.tube,t.geometryOptions.radialSegments,t.geometryOptions.tubularSegments,t.geometryOptions.arc),r.materialType,o);break;case"torusknot":api.extend(t.geometryOptions,{radius:100,tube:40,radialSegments:64,tubularSegments:8,p:2,q:3,heightScale:1}),r.mesh=new Physijs.ConvexMesh(new THREE.TorusKnotGeometry(t.geometryOptions.radius,t.geometryOptions.tube,t.geometryOptions.radialSegments,t.geometryOptions.tubularSegments,t.geometryOptions.p,t.geometryOptions.q,t.geometryOptions.heightScale),r.materialType,o);break;case"tube":r.CustomSinCurve=THREE.Curve.create(function(e){this.scale=e||1},function(e){var t=3*e-1.5,r=Math.sin(2*Math.PI*e),o=0;return new THREE.Vector3(t,r,o).multiplyScalar(this.scale)}),api.extend(t.geometryOptions,{path:t.geometryOptions.path?new this.CustomSinCurve(100):!1,segments:20,radius:2,radiusSegments:8,closed:!1}),r.mesh=new Physijs.ConcaveMesh(new THREE.TubeGeometry(t.geometryOptions.path,t.geometryOptions.segments,t.geometryOptions.radius,t.geometryOptions.radiusSegments,t.geometryOptions.closed),r.materialType,masss)}return r.addCompoundFace=function(){this.compoundFace=new THREE.Geometry,this.compoundFace.faces.push(new THREE.Face3(0,1,2));var e=(new THREE.Box3).setFromObject(this.visible),t=new THREE.BoxGeometry(e.max.x-e.min.x,e.max.y-e.min.y,e.max.z-e.min.z),r=t.vertices[t.faces[7].a].add(this.visible.position),o=t.vertices[t.faces[7].b].add(this.visible.position),a=t.vertices[t.faces[7].c].add(this.visible.position);this.compoundFace.vertices.push(r),this.compoundFace.vertices.push(o),this.compoundFace.vertices.push(a)},r.build(r.mesh).wrap(),r},WHS.Cube=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,"cube"));return api.extend(e.geometry,{width:1,height:1,depth:1}),r.mesh=new Physijs.BoxMesh(new THREE.BoxGeometry(e.geometry.width,e.geometry.height,e.geometry.depth),_get(Object.getPrototypeOf(t.prototype),"_initMaterial",r).call(r,e.material),e.mass),_get(Object.getPrototypeOf(t.prototype),"build",r).call(r),r}return _inherits(t,e),t}(WHS.Shape),WHS.init.prototype.Cube=function(e){return new WHS.Cube(e).addTo(this)},WHS.Cylinder=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,"cylinder"));return api.extend(e.geometry,{radiusTop:1,radiusBottom:1,height:1,radiusSegments:32}),r.mesh=new Physijs.CylinderMesh(new THREE.CylinderGeometry(e.geometry.radiusTop,e.geometry.radiusBottom,e.geometry.height,e.geometry.radiusSegments),_get(Object.getPrototypeOf(t.prototype),"_initMaterial",r).call(r,e.material),e.mass),_get(Object.getPrototypeOf(t.prototype),"build",r).call(r),r}return _inherits(t,e),t}(WHS.Shape),WHS.init.prototype.Cylinder=function(e){return new WHS.Cylinder(e).addTo(this)},WHS.Dodecahedron=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,"dodecahedron"));return api.extend(e.geometry,{radius:1,detail:0}),r.mesh=new Physijs.ConvexMesh(new THREE.DodecahedronGeometry(e.geometry.radius,e.geometry.detail),_get(Object.getPrototypeOf(t.prototype),"_initMaterial",r).call(r,e.material),e.mass),_get(Object.getPrototypeOf(t.prototype),"build",r).call(r),r}return _inherits(t,e),t}(WHS.Shape),WHS.init.prototype.Dodecahedron=function(e){return new WHS.Dodecahedron(e).addTo(this)},WHS.Extrude=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,"extrude"));return api.extend(e.geometry,{shapes:[],options:{}}),r.mesh=new Physijs.ConvexMesh(new THREE.ExtrudeGeometry(e.geometry.shapes,e.geometry.options),_get(Object.getPrototypeOf(t.prototype),"_initMaterial",r).call(r,e.material),e.mass),_get(Object.getPrototypeOf(t.prototype),"build",r).call(r),r}return _inherits(t,e),t}(WHS.Shape),WHS.init.prototype.Extrude=function(e){return new WHS.Extrude(e).addTo(this)},WHS.Icosahderon=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,"icosahderon"));return api.extend(e.geometry,{radius:1,detail:0}),r.mesh=new Physijs.ConvexMesh(new THREE.IcosahderonGeometry(e.geometry.radius,e.geometry.detail),_get(Object.getPrototypeOf(t.prototype),"_initMaterial",r).call(r,e.material),e.mass),_get(Object.getPrototypeOf(t.prototype),"build",r).call(r),r}return _inherits(t,e),t}(WHS.Shape),WHS.init.prototype.Icosahderon=function(e){return new WHS.Icosahderon(e).addTo(this)},WHS.Lathe=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,"lathe"));return api.extend(e.geometry,{points:[]}),r.mesh=new Physijs.ConvexMesh(new THREE.LatheGeometry(e.geometry.points),_get(Object.getPrototypeOf(t.prototype),"_initMaterial",r).call(r,e.material),e.mass),_get(Object.getPrototypeOf(t.prototype),"build",r).call(r),r}return _inherits(t,e),t}(WHS.Shape),WHS.init.prototype.Lathe=function(e){return new WHS.Lathe(e).addTo(this)},WHS.Model=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,"model"));api.extend(e.geometry,{path:""});var o=r,a=_get(Object.getPrototypeOf(t.prototype),"_initMaterial",r).call(r,e.material);return r._loading=new Promise(function(t,r){api.JSONLoader().load(e.geometry.path,function(r){r.computeFaceNormals(),r.computeVertexNormals(),o.mesh=new Physijs.ConvexMesh(r,a,e.mass),t()})}),_get(Object.getPrototypeOf(t.prototype),"build",r).call(r,"wait"),r}return _inherits(t,e),t}(WHS.Shape),WHS.init.prototype.Model=function(e){return new WHS.Model(e).addTo(this,"wait")},WHS.Morph=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,"morph"));api.extend(e.geometry,{path:""}),console.log(r);var o=r;return r._loading=new Promise(function(t,r){api.JSONLoader().load(e.geometry.path,function(r){var a=new THREE.MeshLambertMaterial({color:16755285,morphTargets:!0,vertexColors:THREE.FaceColors});r.computeFaceNormals(),r.computeVertexNormals(),o.mesh=new THREE.Mesh(r,a),o.mesh.speed=e.morph.speed,o.mesh.mixer=new THREE.AnimationMixer(o.mesh),o.mesh.mixer.addAction(new THREE.AnimationAction(r.animations[0]).warpToDuration(.5)),o.mesh.mixer.update(600*Math.random()),o._rot.y=Math.PI/2,t()})}),_get(Object.getPrototypeOf(t.prototype),"build",r).call(r,"wait"),r}return _inherits(t,e),t}(WHS.Shape),WHS.init.prototype.Morph=function(e){return new WHS.Morph(e).addTo(this,"wait")},WHS.Octahedron=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,"octahedron"));return api.extend(e.geometry,{radius:1,detail:0}),r.mesh=new Physijs.ConvexMesh(new THREE.OctahedronGeometry(e.geometry.radius,e.geometry.detail),_get(Object.getPrototypeOf(t.prototype),"_initMaterial",r).call(r,e.material),e.mass),_get(Object.getPrototypeOf(t.prototype),"build",r).call(r),r}return _inherits(t,e),t}(WHS.Shape),WHS.init.prototype.Octahedron=function(e){return new WHS.Octahedron(e).addTo(this)},WHS.Parametric=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,"parametric"));return api.extend(e.geometry,{func:function(){},slices:10,stacks:10}),r.mesh=new Physijs.ConvexMesh(new THREE.ParametricGeometry(e.geometry.func,e.geometry.slices,e.geometry.stacks),_get(Object.getPrototypeOf(t.prototype),"_initMaterial",r).call(r,e.material),e.mass),_get(Object.getPrototypeOf(t.prototype),"build",r).call(r),r}return _inherits(t,e),t}(WHS.Shape),WHS.init.prototype.Parametric=function(e){return new WHS.Parametric(e).addTo(this)},WHS.Plane=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,"plane"));return api.extend(e.geometry,{width:10,height:10,segments:32}),r.mesh=new Physijs.ConvexMesh(new THREE.PlaneBufferGeometry(e.geometry.width,e.geometry.height,e.geometry.segments),_get(Object.getPrototypeOf(t.prototype),"_initMaterial",r).call(r,e.material),e.mass),_get(Object.getPrototypeOf(t.prototype),"build",r).call(r),r}return _inherits(t,e),t}(WHS.Shape),WHS.init.prototype.Plane=function(e){return new WHS.Plane(e).addTo(this)},WHS.Polyhedron=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,"polyhedron"));return api.extend(e.geometry,{verticesOfCube:[],indicesOfFaces:[],radius:1,detail:1}),r.mesh=new Physijs.ConvexMesh(new THREE.PolyhedronGeometry(e.geometry.verticesOfCube,e.geometry.indicesOfFaces,e.geometry.radius,e.geometry.detail),_get(Object.getPrototypeOf(t.prototype),"_initMaterial",r).call(r,e.material),e.mass),_get(Object.getPrototypeOf(t.prototype),"build",r).call(r),r}return _inherits(t,e),t}(WHS.Shape),WHS.init.prototype.Polyhedron=function(e){return new WHS.Polyhedron(e).addTo(this)},WHS.Ring=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,"ring"));return api.extend(e.geometry,{innerRadius:2,outerRadius:5,thetaSegments:30,phiSegments:30,thetaStart:0,thetaLength:2*Math.PI}),r.mesh=new Physijs.ConcaveMesh(new THREE.TorusGeometry(e.geometry.innerRadius,e.geometry.outerRadius,e.geometry.thetaSegments,e.geometry.phiSegments,e.geometry.thetaStart,e.geometry.thetaLength),_get(Object.getPrototypeOf(t.prototype),"_initMaterial",r).call(r,e.material),e.mass),_get(Object.getPrototypeOf(t.prototype),"build",r).call(r),r}return _inherits(t,e),t}(WHS.Shape),WHS.init.prototype.Ring=function(e){return new WHS.Ring(e).addTo(this)},WHS.Shape2D=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,"shape2D"));return api.extend(e.geometry,{shapes:[]}),r.mesh=new THREE.Mesh(new THREE.ShapeGeometry(e.geometry.shapes),_get(Object.getPrototypeOf(t.prototype),"_initMaterial",r).call(r,e.material),e.mass),_get(Object.getPrototypeOf(t.prototype),"build",r).call(r,"onlyvis"),r}return _inherits(t,e),t}(WHS.Shape),WHS.init.prototype.Shape2D=function(e){return new WHS.Shape2D(e).addTo(this)},WHS.Sphere=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,"sphere"));return api.extend(e.geometry,{radius:1,segmentA:32,segmentB:32}),r.mesh=new Physijs.SphereMesh(new THREE.SphereGeometry(e.geometry.radius,e.geometry.segmentA,e.geometry.segmentB),_get(Object.getPrototypeOf(t.prototype),"_initMaterial",r).call(r,e.material),e.mass),_get(Object.getPrototypeOf(t.prototype),"build",r).call(r),r}return _inherits(t,e),t}(WHS.Shape),WHS.init.prototype.Sphere=function(e){return new WHS.Sphere(e).addTo(this)},WHS.Tetrahedron=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,"tetrahedron"));return api.extend(e.geometry,{radius:1,detail:0}),r.mesh=new Physijs.ConvexMesh(new THREE.TetrahedronGeometry(e.geometry.radius,e.geometry.detail),_get(Object.getPrototypeOf(t.prototype),"_initMaterial",r).call(r,e.material),e.mass),_get(Object.getPrototypeOf(t.prototype),"build",r).call(r),r}return _inherits(t,e),t}(WHS.Shape),WHS.init.prototype.Tetrahedron=function(e){return new WHS.Tetrahedron(e).addTo(this)},WHS.Text=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,"text"));return api.extend(e.geometry,{text:"Hello World!",parameters:{size:1,height:50,curveSegments:1,font:"Adelle",weight:"normal",style:"normal",bevelEnabled:!1,bevelThickness:10,bevelSize:8}}),r.mesh=new Physijs.ConcaveMesh(new THREE.TextGeometry(e.geometry.text,e.geometry.parameters),_get(Object.getPrototypeOf(t.prototype),"_initMaterial",r).call(r,e.material),e.mass),_get(Object.getPrototypeOf(t.prototype),"build",r).call(r),r}return _inherits(t,e),t}(WHS.Shape),WHS.init.prototype.Text=function(e){return new WHS.Text(e).addTo(this)},WHS.Torus=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,"torus"));return api.extend(e.geometry,{radius:100,tube:40,radialSegments:8,tubularSegments:6,arc:2*Math.PI}),r.mesh=new Physijs.ConvexMesh(new THREE.TorusGeometry(e.geometry.radius,e.geometry.tube,e.geometry.radialSegments,e.geometry.tubularSegments,e.geometry.arc),_get(Object.getPrototypeOf(t.prototype),"_initMaterial",r).call(r,e.material),e.mass),_get(Object.getPrototypeOf(t.prototype),"build",r).call(r),r}return _inherits(t,e),t}(WHS.Shape),WHS.init.prototype.Torus=function(e){return new WHS.Torus(e).addTo(this)},WHS.Torusknot=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,"Torusknot"));return api.extend(e.geometry,{radius:100,tube:40,radialSegments:64,tubularSegments:8,p:2,q:3,heightScale:1}),r.mesh=new Physijs.ConvexMesh(new THREE.TorusKnotGeometry(e.geometry.radius,e.geometry.tube,e.geometry.radialSegments,e.geometry.tubularSegments,e.geometry.p,e.geometry.q,e.geometry.heightScale),_get(Object.getPrototypeOf(t.prototype),"_initMaterial",r).call(r,e.material),e.mass),_get(Object.getPrototypeOf(t.prototype),"build",r).call(r),r}return _inherits(t,e),t}(WHS.Shape),WHS.init.prototype.Torusknot=function(e){return new WHS.Torusknot(e).addTo(this)},WHS.Tube=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,"tube"));return api.extend(e.geometry,{path:options.geometryOptions.path?new r.CustomSinCurve(100):!1,segments:20,radius:2,radiusSegments:8,closed:!1}),r.mesh=new Physijs.ConvexMesh(new THREE.TubeGeometry(e.geometry.path,e.geometry.segments,e.geometry.radius,e.geometry.radiusSegments,e.geometry.closed),_get(Object.getPrototypeOf(t.prototype),"_initMaterial",r).call(r,e.material),e.mass),_get(Object.getPrototypeOf(t.prototype),"build",r).call(r),r}return _inherits(t,e),_createClass(t,[{key:"CustomSinCurve",get:function(){return THREE.Curve.create(function(e){this.scale=e||1},function(e){var t=3*e-1.5,r=Math.sin(2*Math.PI*e),o=0;return new THREE.Vector3(t,r,o).multiplyScalar(this.scale)})}}]),t}(WHS.Shape),WHS.init.prototype.Tube=function(e){return new WHS.Tube(e).addTo(this)},WHS.init.prototype.addGrass=function(e,t){var r={};r.root=this,r.opts=t,r.onlyvis=!0,r.opts.coords||console.warn("Please add grass objects coordinates! @addGrass"),r.grassMeshes=[];var o=new THREE.Mesh(new THREE.Geometry,new THREE.MeshFaceMaterial);return r.opts.coords.forEach(function(t){var a=new THREE.Mesh(new THREE.Geometry,new THREE.MeshBasicMaterial({map:THREE.ImageUtils.loadTexture("assets/textures/thingrass.png"),side:THREE.DoubleSide,blending:THREE.NormalBlending,transparent:!0,alphaTest:.5})),n=WHS.API.getheight({x:t.x,y:t.y},500,e,-1)[0],i=n.object.geometry.vertices,s=new THREE.Geometry;s.faces.push(new THREE.Face3(0,1,2)),s.vertices.push(i[n.face.a]),s.vertices.push(i[n.face.c]),s.vertices.push(i[n.face.b]),s.computeFaceNormals(),a.position.set(0,0,0),a.geometry.vertices.push(i[n.face.a].clone()),a.geometry.vertices.push(i[n.face.c].clone()),a.geometry.vertices.push(i[n.face.a].clone().add(s.faces[0].normal)),a.geometry.vertices.push(i[n.face.c].clone().add(s.faces[0].normal));var c=new THREE.Vector3(i[n.face.a].clone().x/2+i[n.face.c].clone().x/2,i[n.face.a].clone().y/2+i[n.face.c].clone().y/2,i[n.face.a].clone().z/2+i[n.face.c].clone().z/2);a.geometry.vertices.push(c.clone().add(c.clone().sub(i[n.face.b].clone()))),a.geometry.vertices.push(i[n.face.b].clone()),a.geometry.vertices.push(i[n.face.b].clone().add(s.faces[0].normal)),a.geometry.vertices.push(c.clone().add(c.clone().sub(i[n.face.b].clone())).add(s.faces[0].normal)),a.geometry.faces.push(new THREE.Face3(0,1,2)),a.geometry.faces.push(new THREE.Face3(1,2,3)),a.geometry.faces.push(new THREE.Face3(4,6,5)),a.geometry.faces.push(new THREE.Face3(4,6,7)),a.geometry.faceVertexUvs[0].push([new THREE.Vector2(0,0),new THREE.Vector2(1,0),new THREE.Vector2(0,1)]),a.geometry.faceVertexUvs[0].push([new THREE.Vector2(0,0),new THREE.Vector2(1,1),new THREE.Vector2(0,1)]),a.geometry.faceVertexUvs[0].push([new THREE.Vector2(0,0),new THREE.Vector2(1,1),new THREE.Vector2(1,0)]),a.geometry.faceVertexUvs[0].push([new THREE.Vector2(0,0),new THREE.Vector2(1,1),new THREE.Vector2(0,1)]),a.geometry.uvsNeedUpdate=!0,o.geometry.merge(a.geometry,a.matrix),o.material.materials.push(a.material),r.grassMeshes.push(a)}),r.wrap(o),r.update=function(){},r.update(),r},WHS.init.prototype.addGround=function(e,t,r,o){var a={pos:o},n=new WHS.Shape(this,a,e);switch(n.skip=!0,api.extend({width:100,height:100},t),n.materialType=api.loadMaterial(r)._material,e){case"smooth":n.mesh=new Physijs.BoxMesh(new THREE.BoxGeometry(t.width,1,t.height),n.materialType,0);break;case"terrain":var i=document.createElement("canvas");if(i.setAttribute("width",t.width),i.setAttribute("height",t.height),i.getContext){var s=i.getContext("2d");s.drawImage(t.terrain,0,0)}var c=api.TextureLoader().load(n.root._settings.assets+"/textures/terrain/dirt-512.jpg");c.wrapS=c.wrapT=THREE.RepeatWrapping;var l=api.TextureLoader().load(n.root._settings.assets+"/textures/terrain/sand-512.jpg");l.wrapS=l.wrapT=THREE.RepeatWrapping;var h=api.TextureLoader().load(n.root._settings.assets+"/textures/terrain/grass-512.jpg");h.wrapS=h.wrapT=THREE.RepeatWrapping;var p=api.TextureLoader().load(n.root._settings.assets+"/textures/terrain/rock-512.jpg");p.wrapS=p.wrapT=THREE.RepeatWrapping;var u=api.TextureLoader().load(n.root._settings.assets+"/textures/terrain/snow-512.jpg");u.wrapS=u.wrapT=THREE.RepeatWrapping;var m=(THREE.NormalMapShader,256),d=256,g={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat},y=new THREE.WebGLRenderTarget(m,d,g);y.texture=api.TextureLoader().load(n.root._settings.assets+"/terrain/default_terrain.png");var f=new THREE.WebGLRenderTarget(m,d,g);f.texture=api.TextureLoader().load(n.root._settings.assets+"/terrain/NormalMap.png");var E=new THREE.WebGLRenderTarget(256,256,g);E.texture=api.TextureLoader().load(n.root._settings.assets+"/terrain/default_terrain.png");var v=THREE.ShaderTerrain.terrain,w=Object.assign(THREE.UniformsUtils.clone(v.uniforms),{oceanTexture:{type:"t",value:c},sandyTexture:{type:"t",value:l},grassTexture:{type:"t",value:h},rockyTexture:{type:"t",value:p},snowyTexture:{type:"t",value:u},fog:!0,lights:!0},THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{ambient:{type:"c",value:new THREE.Color(16777215)},emissive:{type:"c",value:new THREE.Color(0)},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}});w.tDisplacement.value=y,w.shadowMap.value=[f],w.uDisplacementScale.value=100,w.uRepeatOverlay.value.set(6,6);var r=new THREE.ShaderMaterial({uniforms:w,vertexShader:v.vertexShader,fragmentShader:v.fragmentShader,lights:!0,fog:!0,side:THREE.DoubleSide,shading:THREE.SmoothShading}),b=new THREE.PlaneGeometry(256,256,255,255);b.verticesNeedUpdate=!0,n._rot.set(Math.PI/180*-90,0,0);for(var T=0,H=0,S=s.getImageData(0,0,256,256).data,R=0;255>=R;R++)for(var _=255;_>=0;_--)b.vertices[T].z=S[H]/255*100,H+=4,T++;n.mesh=new Physijs.HeightfieldMesh(b,Physijs.createMaterial(r,.8,.1)),b.computeVertexNormals(),b.computeFaceNormals(),b.computeTangents(),n.mesh.updateMatrix(),n.mesh.castShadow=!0,n.mesh.receiveShadow=!0}return n.build(n.mesh).wrap(),n},WHS.Smooth=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,"smooth"));return api.extend(e.geometry,{width:10,height:10}),r.mesh=new Physijs.BoxMesh(new THREE.BoxGeometry(e.geometry.width,1,e.geometry.height),_get(Object.getPrototypeOf(t.prototype),"_initMaterial",r).call(r,e.material),0),_get(Object.getPrototypeOf(t.prototype),"build",r).call(r),r}return _inherits(t,e),t}(WHS.Shape),WHS.init.prototype.Smooth=function(e){return new WHS.Smooth(e).addTo(this)},WHS.Terrain=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,"terrain"));api.extend(e.geometry,{width:1,height:1,depth:1,map:!1});var o=document.createElement("canvas");if(o.setAttribute("width",e.geometry.width),o.setAttribute("height",e.geometry.height),o.getContext){var a=o.getContext("2d");a.drawImage(e.geometry.map,0,0)}var n=api.TextureLoader().load(WHS._settings.assets+"/textures/terrain/dirt-512.jpg");n.wrapS=n.wrapT=THREE.RepeatWrapping;var i=api.TextureLoader().load(WHS._settings.assets+"/textures/terrain/sand-512.jpg");i.wrapS=i.wrapT=THREE.RepeatWrapping;var s=api.TextureLoader().load(WHS._settings.assets+"/textures/terrain/grass-512.jpg");s.wrapS=s.wrapT=THREE.RepeatWrapping;
var c=api.TextureLoader().load(WHS._settings.assets+"/textures/terrain/rock-512.jpg");c.wrapS=c.wrapT=THREE.RepeatWrapping;var l=api.TextureLoader().load(WHS._settings.assets+"/textures/terrain/snow-512.jpg");l.wrapS=l.wrapT=THREE.RepeatWrapping;var h=(THREE.NormalMapShader,256),p=256,u={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat},m=new THREE.WebGLRenderTarget(h,p,u);m.texture=api.TextureLoader().load(WHS._settings.assets+"/terrain/default_terrain.png");var d=new THREE.WebGLRenderTarget(h,p,u);d.texture=api.TextureLoader().load(WHS._settings.assets+"/terrain/NormalMap.png");var g=new THREE.WebGLRenderTarget(256,256,u);g.texture=api.TextureLoader().load(WHS._settings.assets+"/terrain/default_terrain.png");var y=THREE.ShaderTerrain.terrain,f=Object.assign(THREE.UniformsUtils.clone(y.uniforms),{oceanTexture:{type:"t",value:n},sandyTexture:{type:"t",value:i},grassTexture:{type:"t",value:s},rockyTexture:{type:"t",value:c},snowyTexture:{type:"t",value:l},fog:!0,lights:!0},THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{ambient:{type:"c",value:new THREE.Color(16777215)},emissive:{type:"c",value:new THREE.Color(0)},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}});f.tDisplacement.value=m,f.shadowMap.value=[d],f.uDisplacementScale.value=100,f.uRepeatOverlay.value.set(6,6);var E=new THREE.ShaderMaterial({uniforms:f,vertexShader:y.vertexShader,fragmentShader:y.fragmentShader,lights:!0,fog:!0,side:THREE.DoubleSide,shading:THREE.SmoothShading}),v=new THREE.PlaneGeometry(256,256,255,255);v.verticesNeedUpdate=!0,r._rot.set(Math.PI/180*-90,0,0);for(var w=0,b=0,T=a.getImageData(0,0,256,256).data,H=0;255>=H;H++)for(var S=255;S>=0;S--)v.vertices[w].z=T[b]/255*100,b+=4,w++;return r.mesh=new Physijs.HeightfieldMesh(v,Physijs.createMaterial(E,.8,.1)),v.computeVertexNormals(),v.computeFaceNormals(),v.computeTangents(),r.mesh.updateMatrix(),r.mesh.castShadow=!0,r.mesh.receiveShadow=!0,_get(Object.getPrototypeOf(t.prototype),"build",r).call(r,"skip"),r}return _inherits(t,e),t}(WHS.Shape),WHS.init.prototype.Terrain=function(e){return new WHS.Terrain(e).addTo(this)},WHS.init.prototype.addFog=function(e,t){var r={};switch(api.extend(t,{hex:0,near:.015,far:1e3,density:25e-5}),e){case"fog":r=new THREE.Fog(t.hex,t.near,t.far);break;case"fogexp2":r=new THREE.FogExp2(t.hex,t.density)}return r},WHS.init.prototype.addLight=function(e,t){var r=new WHS.Shape(this,t,e);switch(api.extend(t,{color:16777215,skyColor:16777215,groundColor:16777215,intensity:1,distance:100,angle:Math.PI/3,shadowmap:{cast:!0,bias:1e-4,width:1024,height:1024,near:!0,far:400,fov:60,darkness:.3,top:200,bottom:-200,left:-200,right:200}}),e){case"ambient":r.mesh=new THREE.AmbientLight(16777215);break;case"directional":r.mesh=new THREE.DirectionalLight(t.color,t.intensity);break;case"hemisphere":r.mesh=new THREE.HemisphereLight(t.skyColor,t.groundColor,t.intensity);break;case"light":r.mesh=new THREE.Light(t.color);break;case"point":r.mesh=new THREE.PointLight(t.color,t.intensity,t.distance);break;case"spot":r.mesh=new THREE.SpotLight(t.color,t.intensity,t.distance,t.angle)}return r.mesh.castShadow=t.shadowmap.cast,r.mesh.shadowMapWidth=t.shadowmap.width,r.mesh.shadowMapHeight=t.shadowmap.height,r.mesh.shadowBias=t.shadowmap.bias,r.mesh.shadowCameraNear=t.shadowmap.near,r.mesh.shadowCameraFar=t.shadowmap.far,r.mesh.shadowCameraFov=t.shadowmap.fov,r.mesh.shadowDarkness=t.shadowmap.darkness,r.mesh.shadowCameraLeft=t.shadowmap.left,r.mesh.shadowCameraRight=t.shadowmap.right,r.mesh.shadowCameraTop=t.shadowmap.top,r.mesh.shadowCameraBottom=t.shadowmap.bottom,r.mesh.target&&r.mesh.target.position.set(r._target.x,r._target.y,r._target.z),r.build().wrap(),r},WHS.AmbientLight=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,"ambientlight"));return r.mesh=new THREE.AmbientLight(e.light.color),_get(Object.getPrototypeOf(t.prototype),"build",r).call(r),_get(Object.getPrototypeOf(t.prototype),"buildShadow",r).call(r),r}return _inherits(t,e),t}(WHS.Light),WHS.init.prototype.AmbientLight=function(e){return new WHS.AmbientLight(e).addTo(this)},WHS.DirectionalLight=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,"directionallight"));return r.mesh=new THREE.DirectionalLight(e.light.color,e.light.intensity),_get(Object.getPrototypeOf(t.prototype),"build",r).call(r),_get(Object.getPrototypeOf(t.prototype),"buildShadow",r).call(r),r}return _inherits(t,e),t}(WHS.Light),WHS.init.prototype.DirectionalLight=function(e){return new WHS.DirectionalLight(e).addTo(this)},WHS.HemisphereLight=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,"hemispherelight"));return r.mesh=new THREE.HemisphereLight(e.light.skyColor,e.light.groundColor,e.light.intensity),_get(Object.getPrototypeOf(t.prototype),"build",r).call(r),_get(Object.getPrototypeOf(t.prototype),"buildShadow",r).call(r),r}return _inherits(t,e),t}(WHS.Light),WHS.init.prototype.HemisphereLight=function(e){return new WHS.HemisphereLight(e).addTo(this)},WHS.NormalLight=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,"normallight"));return r.mesh=new THREE.Light(e.light.color),_get(Object.getPrototypeOf(t.prototype),"build",r).call(r),_get(Object.getPrototypeOf(t.prototype),"buildShadow",r).call(r),r}return _inherits(t,e),t}(WHS.Light),WHS.init.prototype.NormalLight=function(e){return new WHS.NormalLight(e).addTo(this)},WHS.PointLight=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,"pointlight"));return r.mesh=new THREE.PointLight(e.light.color,e.light.intensity,e.light.distance),_get(Object.getPrototypeOf(t.prototype),"build",r).call(r),_get(Object.getPrototypeOf(t.prototype),"buildShadow",r).call(r),r}return _inherits(t,e),t}(WHS.Light),WHS.init.prototype.PointLight=function(e){return new WHS.PointLight(e).addTo(this)},WHS.SpotLight=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,"spotlight"));return r.mesh=new THREE.SpotLight(e.light.color,e.light.intensity,e.light.distance,e.light.angle),_get(Object.getPrototypeOf(t.prototype),"build",r).call(r),_get(Object.getPrototypeOf(t.prototype),"buildShadow",r).call(r),r}return _inherits(t,e),t}(WHS.Light),WHS.init.prototype.SpotLight=function(e){return new WHS.SpotLight(e).addTo(this)},WHS.init.prototype.addWagner=function(e,t,r){r=r||{};var o={_composer:this._composer},a=api.extend(r,{hex:0,near:.015,far:1e3,density:25e-5});switch(t){case"zoomBlurPass":o.effect=new e.ZoomBlurPass,a=api.extend(a,{strength:.05,center:{x:.5*this._composer.width,y:.5*this._composer.height}});break;case"multiPassBloomPass":o.effect=new e.MultiPassBloomPass,a=api.extend(a,{strength:.5,blurAmount:1.32,applyZoomBlur:!0,zoomBlurStrength:.84,useTexture:!0,center:{x:.5*this._composer.width,y:.5*this._composer.height}}),o.effect.glowTexture=e.Pass.prototype.getOfflineTexture(this._composer.width,this._composer.height,!1);break;case"vignettePass":o.effect=new e.VignettePass,a=api.extend(a,{amount:.7,falloff:.2});break;case"directionalBlurPass":o.effect=new e.DirectionalBlurPass,a=api.extend(a,{delta:.1});break;case"motionBlurPass":o.effect=new e.DirectionalBlurPass,o.motionBlurEnable=!0,a=api.extend(a,{delta:0});break;case"ASCIIPass":o.effect=new e.ASCIIPass;break;case"dotScreenPass":o.effect=new e.DotScreenPass;break;case"fxaaPass":o.effect=new e.FXAAPass;break;case"chromaticAberrationPass":o.effect=new e.ChromaticAberrationPass;break;case"dirtPass":o.effect=new e.DirtPass;break;case"edgeDetectionPass":o.effect=new e.SobelEdgeDetectionPass;break;case"highPassPass":o.effect=new e.HighPassPass;break;case"grayscalePass":o.effect=new e.GrayscalePass;break;case"halftonePass":o.effect=new e.HalftonePass;break;case"invertPass":o.effect=new e.InvertPass;break;default:return void console.warn('No Wagner effect "'+t+'" exists. If it should exist, open an issue. (@addWagner)')}return o.effect.params=a,this._composer.pass(o.effect),this._composer.toScreen(),o.apply=function(){return this._composer.eff.push(o.effect),o},o};var PI_2=Math.PI/2;WHS.init.prototype.MakeFirstPerson=function(e,t){var r=WHS.API.extend(t,{block:document.getElementById("blocker"),speed:1,ypos:1});this.controls=new function(e,t,r){function o(e){if(c.enabled!==!1){var t=e.movementX||e.mozMovementX||e.getMovementX()||0,r=e.movementY||e.mozMovementY||e.getMovementY()||0;p.rotation.y-=.002*t,h.rotation.x-=.002*r,h.rotation.x=Math.max(-PI_2,Math.min(PI_2,h.rotation.x))}}function a(e){switch(e.keyCode){case 38:case 87:m=!0;break;case 37:case 65:g=!0;break;case 40:case 83:d=!0;break;case 39:case 68:y=!0;break;case 32:1==f&&(l.applyCentralImpulse({x:0,y:300,z:0}),console.log(l.applyCentralImpulse)),f=!1;break;case 16:s=.5}}function n(e){switch(e.keyCode){case 38:case 87:m=!1;break;case 37:case 65:g=!1;break;case 40:case 83:d=!1;break;case 39:case 68:y=!1;break;case 16:s=.25}}var i=1,s=.25;t.setAngularFactor({x:0,y:0,z:0});var c=this,l=t,h=new THREE.Object3D;h.add(e);var p=new THREE.Object3D;p.position.y=r.ypos,p.add(h);var u=new THREE.Quaternion,m=!1,d=!1,g=!1,y=!1,f=!1;l.addEventListener("collision",function(e,t,r,o){o.y<.5&&(f=!0)}),document.body.addEventListener("mousemove",o,!1),document.body.addEventListener("keydown",a,!1),document.body.addEventListener("keyup",n,!1),this.enabled=!1,this.getObject=function(){return p},this.getDirection=function(e){e.set(0,0,-1),u.multiplyVector3(e)};var E=new THREE.Vector3,v=new THREE.Euler;this.update=function(e){new THREE.Vector3;if(c.enabled!==!1){e=e||.5,e=Math.min(e,.5),E.set(0,0,0);var t=i*e*r.speed*s;m&&(E.z=-t),d&&(E.z=t),g&&(E.x=-t),y&&(E.x=t),v.x=h.rotation.x,v.y=p.rotation.y,v.order="XYZ",u.setFromEuler(v),E.applyQuaternion(u),l.applyCentralImpulse({x:10*E.x,y:0,z:10*E.z}),l.setAngularVelocity({x:10*E.z,y:0,z:10*-E.x}),l.setAngularFactor({x:0,y:0,z:0}),p.position.copy(l.position)}}}(this._camera,e.mesh,r);var o=this.controls;if(WHS.API.merge(this.scene,this.controls.getObject()),"pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document){var a=document.body;this.pointerlockchange=function(){document.pointerLockElement===a||document.mozPointerLockElement===a||document.webkitPointerLockElement===a?(o.enabled=!0,r.block.fadeOut()):(o.enabled=!1,r.block.fadeIn())}}else console.warn("Your browser does not support the PointerLock API.");document.addEventListener("pointerlockchange",this.pointerlockchange,!1),document.addEventListener("mozpointerlockchange",this.pointerlockchange,!1),document.addEventListener("webkitpointerlockchange",this.pointerlockchange,!1),this.pointerlockerror=function(){console.warn("Pointer lock error.")},document.addEventListener("pointerlockerror",this.pointerlockerror,!1),document.addEventListener("mozpointerlockerror",this.pointerlockerror,!1),document.addEventListener("webkitpointerlockerror",this.pointerlockerror,!1),r.block.addEventListener("click",function(){if(a.requestPointerLock=a.requestPointerLock||a.mozRequestPointerLock||a.webkitRequestPointerLock,a.requestFullscreen=a.requestFullscreen||a.mozRequestFullscreen||a.mozRequestFullScreen||a.webkitRequestFullscreen,/Firefox/i.test(navigator.userAgent)){var e=function t(){(document.fullscreenElement===a||document.mozFullscreenElement===a||document.mozFullScreenElement===a)&&(document.removeEventListener("fullscreenchange",t),document.removeEventListener("mozfullscreenchange",t),a.requestPointerLock())};document.addEventListener("fullscreenchange",e,!1),document.addEventListener("mozfullscreenchange",e,!1),a.requestFullscreen()}else a.requestPointerLock()})},WHS.init.prototype.OrbitControls=function(e){if(this.controls=new THREE.OrbitControls(this._camera,this.renderer.domElement),e)if(e._whsobject){var t=e?e.mesh.position:new THREE.Vector3(0,0,0);this.controls.target=t}else"object"==("undefined"==typeof e?"undefined":_typeof(e))?this.controls.target.copy(t):console.error("Object must be a THREE.JS vector! @OrbitControls")},WHS.init.prototype.addSkybox=function(e){e.skyType=e.skyType||"box",e.imgSuffix="box"==e.skyType?e.imgSuffix||".png":e.imgSuffix||"";var t=new WHS.Shape(this,e,"skybox");t.skip=!0;var r,o;switch(e.skyType){case"box":var a=["xpos","xneg","ypos","yneg","zpos","zneg"];r=new THREE.CubeGeometry(this._camera.far,this._camera.far,this._camera.far);for(var n=[],i=0;6>i;i++)n.push(new THREE.MeshBasicMaterial({map:THREE.ImageUtils.loadTexture(e.src+a[i]+e.imgSuffix),side:THREE.BackSide}));o=new THREE.MeshFaceMaterial(n);break;case"sphere":r=new THREE.SphereGeometry(this._camera.far/2,60,40),o=new THREE.MeshBasicMaterial({map:THREE.ImageUtils.loadTexture(e.src+e.imgSuffix),side:THREE.BackSide})}return t.mesh=new THREE.Mesh(r,o),t.mesh.renderDepth=1e3,t.build().wrap(),t},WHS.Skybox=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,"skybox"));api.extend(e,{skyType:"box",detail:".png",radius:10,path:""});var o,a;switch(e.skyType){case"box":var n=["xpos","xneg","ypos","yneg","zpos","zneg"];o=new THREE.CubeGeometry(e.radius,e.radius,e.radius);for(var i=[],s=0;6>s;s++)i.push(new THREE.MeshBasicMaterial({map:THREE.ImageUtils.loadTexture(e.path+n[s]+e.imgSuffix),side:THREE.BackSide}));a=new THREE.MeshFaceMaterial(i);break;case"sphere":o=new THREE.SphereGeometry(e.radius/2,60,40),a=new THREE.MeshBasicMaterial({map:THREE.ImageUtils.loadTexture(e.path+e.imgSuffix),side:THREE.BackSide})}return r.mesh=new THREE.Mesh(o,a),r.mesh.renderDepth=1e3,_get(Object.getPrototypeOf(t.prototype),"build",r).call(r),r}return _inherits(t,e),t}(WHS.Shape),WHS.init.prototype.Skybox=function(e){return new WHS.Skybox(e).addTo(this)};