{"version":3,"file":"whs.physics.ammo.js","sources":["../node_modules/@babel/runtime/helpers/classCallCheck.js","../node_modules/@babel/runtime/helpers/createClass.js","../src/modules/WorldModule.js","../node_modules/@babel/runtime/helpers/defineProperty.js","../tools/worker-plugin/workerhelper.js","../src/engines/ammojs/worker.js","../src/engines/ammojs/commands.js","../src/engines/ammojs/AmmoEngine.js"],"sourcesContent":["function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nmodule.exports = _classCallCheck;","function _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nmodule.exports = _createClass;","export class WorldModule {\n  constructor(options) {\n    this.engine = options.engine;\n  }\n\n  setup(app, {manager}) {\n\n  }\n}\n","function _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nmodule.exports = _defineProperty;","var TARGET = typeof Symbol === 'undefined' ? '__target' : Symbol(),\n    SCRIPT_TYPE = 'application/javascript',\n    BlobBuilder = window.BlobBuilder || window.WebKitBlobBuilder || window.MozBlobBuilder || window.MSBlobBuilder,\n    URL = window.URL || window.webkitURL,\n    Worker = window.Worker;\n\n/**\n * Returns a wrapper around Web Worker code that is constructible.\n *\n * @function shimWorker\n *\n * @param { String }    filename    The name of the file\n * @param { Function }  fn          Function wrapping the code of the worker\n */\nexport default function shimWorker (filename, fn) {\n    return function ShimWorker (forceFallback) {\n        var o = this;\n\n        if (!fn) {\n            return new Worker(filename);\n        }\n        else if (Worker && !forceFallback) {\n            // Convert the function's inner code to a string to construct the worker\n            var source = fn.toString().replace(/^function.+?{/, '').slice(0, -1),\n                objURL = createSourceObject(source);\n\n            this[TARGET] = new Worker(objURL);\n            URL.revokeObjectURL(objURL);\n            return this[TARGET];\n        }\n        else {\n            var selfShim = {\n                    postMessage: function(m) {\n                        if (o.onmessage) {\n                            setTimeout(function(){ o.onmessage({ data: m, target: selfShim }) });\n                        }\n                    }\n                };\n\n            fn.call(selfShim);\n            this.postMessage = function(m) {\n                setTimeout(function(){ selfShim.onmessage({ data: m, target: o }) });\n            };\n            this.isThisThread = true;\n        }\n    };\n};\n\n// Test Worker capabilities\nif (Worker) {\n    var testWorker,\n        objURL = createSourceObject('self.onmessage = function () {}'),\n        testArray = new Uint8Array(1);\n\n    try {\n        // No workers via blobs in Edge 12 and IE 11 and lower :(\n        if (/(?:Trident|Edge)\\/(?:[567]|12)/i.test(navigator.userAgent)) {\n            throw new Error('Not available');\n        }\n        testWorker = new Worker(objURL);\n\n        // Native browser on some Samsung devices throws for transferables, let's detect it\n        testWorker.postMessage(testArray, [testArray.buffer]);\n    }\n    catch (e) {\n        Worker = null;\n    }\n    finally {\n        URL.revokeObjectURL(objURL);\n        if (testWorker) {\n            testWorker.terminate();\n        }\n    }\n}\n\nfunction createSourceObject(str) {\n    try {\n        return URL.createObjectURL(new Blob([str], { type: SCRIPT_TYPE }));\n    }\n    catch (e) {\n        var blob = new BlobBuilder();\n        blob.append(str);\n        return URL.createObjectURL(blob.getBlob(type));\n    }\n}\n","import shimWorker from '__tools/worker-plugin__';\nexport default new shimWorker(\"./worker.js\", function (window, document) {\nvar self = this;\n\"use strict\";\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nvar CMD = {\n  INITIALIZE: 1,\n  CREATE_OBJECT: 2\n};\nvar transferableMessage = self.webkitPostMessage || self.postMessage;\nnew (\n/*#__PURE__*/\nfunction () {\n  function AmmoBackend() {\n    var _this = this;\n\n    _classCallCheck(this, AmmoBackend);\n\n    console.log(123);\n\n    self.onmessage = function (_ref) {\n      var data = _ref.data;\n\n      switch (data[0] || data.cmd) {\n        case CMD.INITIALIZE:\n          _this.initialize(data.data.path);\n\n          transferableMessage(true);\n          break;\n\n        default:\n      }\n    };\n  }\n\n  _createClass(AmmoBackend, [{\n    key: \"initialize\",\n    value: function initialize(ammoPath) {\n      importScripts(ammoPath);\n    }\n  }]);\n\n  return AmmoBackend;\n}())();\n\n});","export default {\n  INITIALIZE: 1,\n  CREATE_OBJECT: 2\n};\n","import AmmoWorker from 'worker!./worker.js';\nimport CMD from './commands';\n\nexport class AmmoEngine {\n  static CMD = CMD;\n  static ArrayBuffer = SharedArrayBuffer || ArrayBuffer;\n  isShared = AmmoEngine.ArrayBuffer instanceof SharedArrayBuffer;\n\n  constructor(options) {\n    this.worker = new AmmoWorker();\n    this.worker.transferableMessage = this.worker.webkitPostMessage || this.worker.postMessage;\n    this.send(CMD.INITIALIZE, options);\n  }\n\n  send(command, data) {\n    if (Array.isArray(data)) {\n      this.sendBuffer(command, data);\n      return;\n    }\n\n    this.worker.transferableMessage({\n      cmd: CMD.INITIALIZE,\n      data\n    });\n  }\n\n  sendBuffer(command, data = []) {\n    const buffer = this.buffer = new AmmoEngine.ArrayBuffer(Float32Array.BYTES_PER_ELEMENT * (data.length + 1));\n    const array = this.array = new Float32Array(buffer);\n    array[0] = command;\n\n    array.set(data, 1);\n    this.worker.transferableMessage(array, buffer);\n  }\n}\n"],"names":["_classCallCheck","instance","Constructor","TypeError","module","_defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","_createClass","protoProps","staticProps","prototype","WorldModule","options","engine","app","manager","_defineProperty","obj","value","TARGET","Symbol","SCRIPT_TYPE","BlobBuilder","window","WebKitBlobBuilder","MozBlobBuilder","MSBlobBuilder","URL","webkitURL","Worker","shimWorker","filename","fn","ShimWorker","forceFallback","o","source","toString","replace","slice","objURL","createSourceObject","revokeObjectURL","selfShim","postMessage","m","onmessage","setTimeout","data","call","isThisThread","testWorker","testArray","Uint8Array","test","navigator","userAgent","Error","buffer","e","terminate","str","createObjectURL","Blob","type","blob","append","getBlob","document","self","CMD","INITIALIZE","CREATE_OBJECT","transferableMessage","webkitPostMessage","AmmoBackend","_this","console","log","_ref","cmd","initialize","path","ammoPath","importScripts","AmmoEngine","ArrayBuffer","SharedArrayBuffer","worker","AmmoWorker","send","command","Array","isArray","sendBuffer","Float32Array","BYTES_PER_ELEMENT","array","set"],"mappings":"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"}