{"version":3,"file":"whs.physics.ammo.module.js","sources":["../node_modules/@babel/runtime/helpers/classCallCheck.js","../node_modules/@babel/runtime/helpers/createClass.js","../src/modules/WorldModule.js","../node_modules/@babel/runtime/helpers/defineProperty.js","../tools/worker-plugin/workerhelper.js","../src/engines/ammojs/worker.js","../src/engines/ammojs/commands.js","../src/engines/ammojs/AmmoEngine.js"],"sourcesContent":["function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nmodule.exports = _classCallCheck;","function _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nmodule.exports = _createClass;","export class WorldModule {\n  constructor(options) {\n    this.engine = options.engine;\n  }\n\n  setup(app, {manager}) {\n\n  }\n}\n","function _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nmodule.exports = _defineProperty;","var TARGET = typeof Symbol === 'undefined' ? '__target' : Symbol(),\n    SCRIPT_TYPE = 'application/javascript',\n    BlobBuilder = window.BlobBuilder || window.WebKitBlobBuilder || window.MozBlobBuilder || window.MSBlobBuilder,\n    URL = window.URL || window.webkitURL,\n    Worker = window.Worker;\n\n/**\n * Returns a wrapper around Web Worker code that is constructible.\n *\n * @function shimWorker\n *\n * @param { String }    filename    The name of the file\n * @param { Function }  fn          Function wrapping the code of the worker\n */\nexport default function shimWorker (filename, fn) {\n    return function ShimWorker (forceFallback) {\n        var o = this;\n\n        if (!fn) {\n            return new Worker(filename);\n        }\n        else if (Worker && !forceFallback) {\n            // Convert the function's inner code to a string to construct the worker\n            var source = fn.toString().replace(/^function.+?{/, '').slice(0, -1),\n                objURL = createSourceObject(source);\n\n            this[TARGET] = new Worker(objURL);\n            URL.revokeObjectURL(objURL);\n            return this[TARGET];\n        }\n        else {\n            var selfShim = {\n                    postMessage: function(m) {\n                        if (o.onmessage) {\n                            setTimeout(function(){ o.onmessage({ data: m, target: selfShim }) });\n                        }\n                    }\n                };\n\n            fn.call(selfShim);\n            this.postMessage = function(m) {\n                setTimeout(function(){ selfShim.onmessage({ data: m, target: o }) });\n            };\n            this.isThisThread = true;\n        }\n    };\n};\n\n// Test Worker capabilities\nif (Worker) {\n    var testWorker,\n        objURL = createSourceObject('self.onmessage = function () {}'),\n        testArray = new Uint8Array(1);\n\n    try {\n        // No workers via blobs in Edge 12 and IE 11 and lower :(\n        if (/(?:Trident|Edge)\\/(?:[567]|12)/i.test(navigator.userAgent)) {\n            throw new Error('Not available');\n        }\n        testWorker = new Worker(objURL);\n\n        // Native browser on some Samsung devices throws for transferables, let's detect it\n        testWorker.postMessage(testArray, [testArray.buffer]);\n    }\n    catch (e) {\n        Worker = null;\n    }\n    finally {\n        URL.revokeObjectURL(objURL);\n        if (testWorker) {\n            testWorker.terminate();\n        }\n    }\n}\n\nfunction createSourceObject(str) {\n    try {\n        return URL.createObjectURL(new Blob([str], { type: SCRIPT_TYPE }));\n    }\n    catch (e) {\n        var blob = new BlobBuilder();\n        blob.append(str);\n        return URL.createObjectURL(blob.getBlob(type));\n    }\n}\n","import shimWorker from '__tools/worker-plugin__';\nexport default new shimWorker(\"./worker.js\", function (window, document) {\nvar self = this;\n\"use strict\";\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nvar CMD = {\n  INITIALIZE: 1,\n  CREATE_OBJECT: 2\n};\nvar transferableMessage = self.webkitPostMessage || self.postMessage;\nnew (\n/*#__PURE__*/\nfunction () {\n  function AmmoBackend() {\n    var _this = this;\n\n    _classCallCheck(this, AmmoBackend);\n\n    console.log(123);\n\n    self.onmessage = function (_ref) {\n      var data = _ref.data;\n\n      switch (data[0] || data.cmd) {\n        case CMD.INITIALIZE:\n          _this.initialize(data.data.path);\n\n          transferableMessage(true);\n          break;\n\n        default:\n      }\n    };\n  }\n\n  _createClass(AmmoBackend, [{\n    key: \"initialize\",\n    value: function initialize(ammoPath) {\n      importScripts(ammoPath);\n    }\n  }]);\n\n  return AmmoBackend;\n}())();\n\n});","export default {\n  INITIALIZE: 1,\n  CREATE_OBJECT: 2\n};\n","import AmmoWorker from 'worker!./worker.js';\nimport CMD from './commands';\n\nexport class AmmoEngine {\n  static CMD = CMD;\n  static ArrayBuffer = SharedArrayBuffer || ArrayBuffer;\n  isShared = AmmoEngine.ArrayBuffer instanceof SharedArrayBuffer;\n\n  constructor(options) {\n    this.worker = new AmmoWorker();\n    this.worker.transferableMessage = this.worker.webkitPostMessage || this.worker.postMessage;\n    this.send(CMD.INITIALIZE, options);\n  }\n\n  send(command, data) {\n    if (Array.isArray(data)) {\n      this.sendBuffer(command, data);\n      return;\n    }\n\n    this.worker.transferableMessage({\n      cmd: CMD.INITIALIZE,\n      data\n    });\n  }\n\n  sendBuffer(command, data = []) {\n    const buffer = this.buffer = new AmmoEngine.ArrayBuffer(Float32Array.BYTES_PER_ELEMENT * (data.length + 1));\n    const array = this.array = new Float32Array(buffer);\n    array[0] = command;\n\n    array.set(data, 1);\n    this.worker.transferableMessage(array, buffer);\n  }\n}\n"],"names":["_classCallCheck","instance","Constructor","TypeError","module","_defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","_createClass","protoProps","staticProps","prototype","WorldModule","options","engine","app","manager","_defineProperty","obj","value","TARGET","Symbol","SCRIPT_TYPE","BlobBuilder","window","WebKitBlobBuilder","MozBlobBuilder","MSBlobBuilder","URL","webkitURL","Worker","shimWorker","filename","fn","ShimWorker","forceFallback","o","source","toString","replace","slice","objURL","createSourceObject","revokeObjectURL","selfShim","postMessage","m","onmessage","setTimeout","data","call","isThisThread","testWorker","testArray","Uint8Array","test","navigator","userAgent","Error","buffer","e","terminate","str","createObjectURL","Blob","type","blob","append","getBlob","document","self","CMD","INITIALIZE","CREATE_OBJECT","transferableMessage","webkitPostMessage","AmmoBackend","_this","console","log","_ref","cmd","initialize","path","ammoPath","importScripts","AmmoEngine","ArrayBuffer","SharedArrayBuffer","worker","AmmoWorker","send","command","Array","isArray","sendBuffer","Float32Array","BYTES_PER_ELEMENT","array","set"],"mappings":"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"}