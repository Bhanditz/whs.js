{"version":3,"sources":["meshes/Model.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;;;AACA;;;;AAEA;;;;AACA;;;;IAEM,K;;;AACJ,mBAAyB;AAAA,QAAb,MAAa,yDAAJ,EAAI;AAAA;;AAAA,+GACjB,MADiB,EACT,OADS;;AAGvB,qBAAO,OAAO,QAAd,EAAwB;;AAEtB,YAAM,EAFgB;AAGtB,eAAS;;AAHa,KAAxB;;AAOA,UAAK,KAAL,CAAW,MAAX;AACA,kGAAW,MAAX;AAXuB;AAYxB;;;;4BAEkB;AAAA,UAAb,MAAa,yDAAJ,EAAI;;AACjB,UAAM,SAAS,IAAf;UACE,OAAO,KAAK,OAAL,GAAe,8BAAQ,WAAvB,GAAqC,gBAAM,IADpD;;AAGA,UAAM,UAAU,sBAAY,UAAC,OAAD,EAAa;AACvC,2BAAS,OAAO,QAAP,CAAgB,IAAzB,EAA+B,UAAC,IAAD,EAAO,SAAP,EAAqB;AAClD,cAAI,OAAO,QAAP,CAAgB,OAApB,EAA6B;AAC3B,+BAAS,OAAO,QAAP,CAAgB,OAAzB,EAAkC,iBAAS;AACzC,kBAAI,OAAO,QAAP,CAAgB,eAApB,EAAqC;AACnC,2BAAW,uBACT,iBAAO,OAAO,QAAd,EAAwB;AACtB,gCAAc,IADQ;AAEtB,gCAAc,gBAAM;AAFE,iBAAxB,CADS,EAKT,SALF;AAMD,eAPD,MAOO,IAAI,CAAC,SAAD,IAAc,OAAO,QAAP,CAAgB,iBAAlC,EAAqD;AAC1D,2BAAW,uBACT,OAAO,QADE,EAET,SAFF;AAGD,eAJM,MAIA,WAAW,IAAI,gBAAM,aAAV,CAAwB,SAAxB,CAAX;;AAEP,mBAAK,kBAAL;AACA,mBAAK,oBAAL;;AAEA,qBAAO,SAAP,CAAiB,IAAI,IAAJ,CACf,IADe,EAEf,QAFe,EAGf,OAAO,IAHQ,EAIf,KAJe,EAKf,OAAO,KALQ,CAAjB;;AAQA;AACD,aA1BD;AA2BD,WA5BD,MA4BO;AACL,gBAAI,OAAO,QAAP,CAAgB,eAApB,EAAqC;AACnC,yBAAW,uBACT,iBAAO,OAAO,QAAd,EAAwB;AACtB,8BAAc,IADQ;AAEtB,8BAAc,gBAAM;AAFE,eAAxB,CADS,EAKT,SALF;AAMD,aAPD,MAOO,IAAI,CAAC,SAAD,IAAc,OAAO,QAAP,CAAgB,iBAAlC,EAAqD;AAC1D,yBAAW,uBACT,OAAO,QADE,EAET,SAFF;AAGD,aAJM,MAIA,WAAW,IAAI,gBAAM,aAAV,CAAwB,SAAxB,CAAX;;AAEP,iBAAK,kBAAL;AACA,iBAAK,oBAAL;;AAEA,mBAAO,SAAP,CAAiB,IAAI,IAAJ,CACf,IADe,EAEf,QAFe,EAGf,OAAO,IAHQ,CAAjB;;AAMA;AACD;AACF,SAtDD;AAuDD,OAxDe,CAAhB;;AA0DA,kGAAW,OAAX;;AAEA,aAAO,OAAP;AACD;;;4BAEO;AACN,aAAO,IAAI,KAAJ,CAAU,KAAK,SAAL,EAAV,EAA4B,KAAK,KAAjC,EAAwC,IAAxC,CAA6C,IAA7C,CAAP;AACD;;;;;QAIQ,O,GAAT,K","file":"Model.js","sourcesContent":["import THREE from 'three';\nimport Physijs from 'whitestormjs-physijs';\n\nimport Shape from '../core/Shape';\nimport {extend, loadJSON, loadMaterial} from '../extras/api';\n\nclass Model extends Shape {\n  constructor(params = {}) {\n    super(params, 'model');\n\n    extend(params.geometry, {\n\n      path: '',\n      physics: ''\n\n    });\n\n    this.build(params);\n    super.wrap('wait');\n  }\n\n  build(params = {}) {\n    const _scope = this,\n      Mesh = this.physics ? Physijs.ConcaveMesh : THREE.Mesh;\n\n    const promise = new Promise((resolve) => {\n      loadJSON(params.geometry.path, (data, materials) => {\n        if (params.geometry.physics) {\n          loadJSON(params.geometry.physics, data2 => {\n            if (params.material.useVertexColors) {\n              material = loadMaterial(\n                extend(params.material, {\n                  morphTargets: true,\n                  vertexColors: THREE.FaceColors\n                })\n              )._material;\n            } else if (!materials || params.material.useCustomMaterial) {\n              material = loadMaterial(\n                params.material\n              )._material;\n            } else material = new THREE.MultiMaterial(materials);\n\n            data.computeFaceNormals();\n            data.computeVertexNormals();\n\n            _scope.setNative(new Mesh(\n              data,\n              material,\n              params.mass,\n              data2,\n              params.scale\n            ));\n\n            resolve();\n          });\n        } else {\n          if (params.material.useVertexColors) {\n            material = loadMaterial(\n              extend(params.material, {\n                morphTargets: true,\n                vertexColors: THREE.FaceColors\n              })\n            )._material;\n          } else if (!materials || params.material.useCustomMaterial) {\n            material = loadMaterial(\n              params.material\n            )._material;\n          } else material = new THREE.MultiMaterial(materials);\n\n          data.computeFaceNormals();\n          data.computeVertexNormals();\n\n          _scope.setNative(new Mesh(\n            data,\n            material,\n            params.mass\n          ));\n\n          resolve();\n        }\n      });\n    });\n\n    super.wait(promise);\n\n    return promise;\n  }\n\n  clone() {\n    return new Model(this.getParams(), this._type).copy(this);\n  }\n}\n\nexport {\n  Model as default\n};\n"]}