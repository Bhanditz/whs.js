{"version":3,"sources":["core/World.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;IAAY,K;;AACZ;;;;AACA;;;;AAEA;;AACA;;AACA;;;;;;IAEM,K;;;;;;;;;;AAOJ,mBAAyB;AAAA;;AAAA,QAAb,MAAa,yDAAJ,EAAI;AAAA;;AAAA,uGACjB;;AAEJ,aAAO,KAFH;AAGJ,kBAAY,KAHR;;AAKJ,iBAAW;AACT,iBAAS,IADA;AAET,cAAM,MAAM;AAFH,OALP;;AAUJ,eAAS;AACP,cAAM,KADC;AAEP,cAAM;AAFC,OAVL;;AAeJ,eAAS;AACP,WAAG,CADI;AAEP,WAAG,CAFI;AAGP,WAAG;AAHI,OAfL;;AAqBJ,cAAQ;AACN,gBAAQ,EADF;AAEN,cAAM,CAFA;AAGN,aAAK,IAHC;;AAKN,WAAG,CALG;AAMN,WAAG,CANG;AAON,WAAG;AAPG,OArBJ;;AA+BJ,cAAQ,CA/BJ,E;AAgCJ,eAAS,CAhCL,E;;AAkCJ,aAAO,OAAO,UAlCV,E;AAmCJ,cAAQ,OAAO,WAnCX,E;;AAqCJ,eAAS;;AAEP,2BAAmB,CAFZ;AAGP,2BAAmB,KAHZ;;AAKP,gBAAQ;AACN,sBAAY,EADN;AAEN,qBAAW;AAFL,SALD;;AAUP,qBAAa;AACX,oCAA0B,GADf;AAEX,6CAAmC;AAFxB;;AAVN,OArCL;;AAsDJ,kBAAY,QAtDR;AAuDJ,cAAQ,UAvDJ;AAwDJ,iBAAW,SAAS,IAxDhB;;AA0DJ,aAAO;AACL,gBAAQ,2BADH;AAEL,cAAM;AAFD;;AA1DH,KADiB;;AAkEvB,+FAAgB,MAAhB;;;AAGA,UAAK,UAAL;AACA,UAAK,QAAL;;AAEA,QAAI,EACF,QAAO,OAAP,uDAAO,OAAP,OAAmB,QAAnB,IACG,OAAO,SAAP,CAAiB,QAAjB,CAA0B,IAA1B,CAA+B,OAA/B,MAA4C,kBAF7C,CAAJ,EAGK,MAAK,UAAL;;AAEL,UAAK,WAAL;AACA,UAAK,aAAL;AACA,UAAK,YAAL;;;AAGA,QAAM,aAAN;;AAEA,QAAI,MAAK,SAAL,GAAiB,UAArB,EAAiC;AAC/B,aAAO,gBAAP,CAAwB,QAAxB,EAAkC,YAAM;AACtC,cAAM,OAAN,CAAc,OAAO,UAArB,EAAiC,OAAO,WAAxC;AACD,OAFD;AAGD;;AAED,UAAM,KAAN,GAAc,EAAd;;AAEA,kBAAO,KAAP;AACD;;;;;;;;;iCAKY;AACX,WAAK,YAAL;;AAEA,cAAQ,GAAR,CAAY,gBAAQ,OAAR,CAAgB,MAA5B;;AAEA,UAAM,QAAQ,IAAI,gBAAQ,KAAZ,EAAd;;AAEA,YAAM,UAAN,CACE,IAAI,MAAM,OAAV,CACE,KAAK,SAAL,GAAiB,OAAjB,CAAyB,CAD3B,EAEE,KAAK,SAAL,GAAiB,OAAjB,CAAyB,CAF3B,EAGE,KAAK,SAAL,GAAiB,OAAjB,CAAyB,CAH3B,CADF;;AAQA,WAAK,QAAL,CAAc,KAAd;;;AAGA,WAAK,QAAL,GAAgB,EAAhB;AACD;;;4BAEO,I,EAAM;AACZ,WAAK,KAAL,CAAW,IAAX,CAAgB,IAAhB,E;;AAED;;;+BAEU,I,EAAM;AACf,WAAK,KAAL,CAAW,MAAX,CAAkB,UAAC,CAAD;AAAA,eAAO,MAAM,IAAb;AAAA,OAAlB;AACD;;;;;;;;mCAKc;AACb,WAAK,QAAL,GAAgB,IAAhB;;AAEA,sBAAQ,OAAR,CAAgB,MAAhB,GAAyB,KAAK,SAAL,GAAiB,KAAjB,CAAuB,MAAhD;AACA,sBAAQ,OAAR,CAAgB,IAAhB,GAAuB,KAAK,SAAL,GAAiB,KAAjB,CAAuB,IAA9C;AACD;;;;;;;;+BAKU;AACT,WAAK,SAAL,GAAiB,SAAjB,CAA2B,KAA3B,CAAiC,MAAjC,GAA0C,CAA1C;AACA,WAAK,SAAL,GAAiB,SAAjB,CAA2B,KAA3B,CAAiC,OAAjC,GAA2C,CAA3C;AACA,WAAK,SAAL,GAAiB,SAAjB,CAA2B,KAA3B,CAAiC,QAAjC,GAA4C,UAA5C;AACA,WAAK,SAAL,GAAiB,SAAjB,CAA2B,KAA3B,CAAiC,QAAjC,GAA4C,QAA5C;;AAEA,WAAK,IAAL,GAAY,SAAS,aAAT,CAAuB,KAAvB,CAAZ;AACA,WAAK,IAAL,CAAU,SAAV,GAAsB,KAAtB;;AAEA,WAAK,SAAL,GAAiB,SAAjB,CAA2B,WAA3B,CAAuC,KAAK,IAA5C;;AAEA,aAAO,KAAK,IAAZ;AACD;;;;;;;;iCAKY;;AAEX,UAAI,KAAK,SAAL,GAAiB,KAArB,EAA4B;AAC1B,aAAK,MAAL,GAAc,qBAAd;;AAEA,YAAI,KAAK,SAAL,GAAiB,KAAjB,KAA2B,KAA/B,EACE,KAAK,MAAL,CAAY,OAAZ,CAAoB,CAApB,EADF,KAGK,IAAI,KAAK,SAAL,GAAiB,KAAjB,KAA2B,IAA/B,EACH,KAAK,MAAL,CAAY,OAAZ,CAAoB,CAApB,EADG,KAGA,IAAI,KAAK,SAAL,GAAiB,KAAjB,KAA2B,IAA/B,EACH,KAAK,MAAL,CAAY,OAAZ,CAAoB,CAApB,EADG,KAGA;AACH,eAAK,MAAL,CAAY,OAAZ,CAAoB,CAApB;AACA,kBAAQ,IAAR,CAAa,CAAC,KAAK,MAAN,CAAb,EAA4B,0CAA5B;AACD;;AAED,aAAK,MAAL,CAAY,UAAZ,CAAuB,KAAvB,CAA6B,QAA7B,GAAwC,UAAxC;AACA,aAAK,MAAL,CAAY,UAAZ,CAAuB,KAAvB,CAA6B,IAA7B,GAAoC,KAApC;AACA,aAAK,MAAL,CAAY,UAAZ,CAAuB,KAAvB,CAA6B,MAA7B,GAAsC,KAAtC;;AAEA,aAAK,IAAL,CAAU,WAAV,CAAsB,KAAK,MAAL,CAAY,UAAlC;AACD;AACF;;;;;;;;kCAKa;AACZ,cAAQ,GAAR,CAAY,KAAK,SAAL,EAAZ;;AAEA,WAAK,SAAL,CAAe,yCAAsB;AACnC,gBAAQ;AACN,eAAK,KAAK,SAAL,GAAiB,MAAjB,CAAwB,MADvB;AAEN,kBAAQ,KAAK,SAAL,GAAiB,KAAjB,GAAyB,KAAK,SAAL,GAAiB,MAF5C;AAGN,gBAAM,KAAK,SAAL,GAAiB,MAAjB,CAAwB,IAHxB;AAIN,eAAK,KAAK,SAAL,GAAiB,MAAjB,CAAwB;AAJvB,SAD2B;;AAQnC,aAAK;AACH,aAAG,KAAK,SAAL,GAAiB,MAAjB,CAAwB,CADxB;AAEH,aAAG,KAAK,SAAL,GAAiB,MAAjB,CAAwB,CAFxB;AAGH,aAAG,KAAK,SAAL,GAAiB,MAAjB,CAAwB;AAHxB;AAR8B,OAAtB,CAAf;;AAeA,WAAK,SAAL,GAAiB,KAAjB,CAAuB,IAAvB;AACD;;;;;;;;oCAKe;AACd,WAAK,MAAL,GAAc,IAAd;;;AAGA,WAAK,WAAL,CAAiB,IAAI,MAAM,aAAV,EAAjB;AACA,WAAK,WAAL,GAAmB,aAAnB,CAAiC,KAAK,SAAL,GAAiB,UAAlD;;;AAGA,WAAK,WAAL,GAAmB,SAAnB,CAA6B,OAA7B,GAAuC,KAAK,SAAL,GAAiB,SAAjB,CAA2B,OAAlE;AACA,WAAK,WAAL,GAAmB,SAAnB,CAA6B,IAA7B,GAAoC,KAAK,SAAL,GAAiB,SAAjB,CAA2B,IAA/D;AACA,WAAK,WAAL,GAAmB,SAAnB,CAA6B,OAA7B,GAAuC,IAAvC;;AAEA,WAAK,WAAL,GAAmB,OAAnB,CACQ,OAAO,KAAK,SAAL,GAAiB,KAAjB,GAAyB,KAAK,SAAL,GAAiB,MAAjD,EAAyD,OAAzD,EADR,EAEQ,OAAO,KAAK,SAAL,GAAiB,MAAjB,GAA0B,KAAK,SAAL,GAAiB,OAAlD,EAA2D,OAA3D,EAFR;;AAKA,WAAK,WAAL,GAAmB,MAAnB,CAA0B,KAAK,QAAL,EAA1B,EAA2C,KAAK,SAAL,GAAiB,SAAjB,EAA3C;;AAEA,WAAK,IAAL,CAAU,WAAV,CAAsB,KAAK,WAAL,GAAmB,UAAzC;;AAEA,WAAK,WAAL,GAAmB,UAAnB,CAA8B,KAA9B,CAAoC,KAApC,GAA4C,MAA5C;AACA,WAAK,WAAL,GAAmB,UAAnB,CAA8B,KAA9B,CAAoC,MAApC,GAA6C,MAA7C;AACD;;;;;;;;mCAKc;AACb,UAAI,KAAK,SAAL,GAAiB,OAAjB,CAAyB,IAA7B,EAAmC;AACjC,aAAK,QAAL,GAAgB,GAAhB,CACE,IAAI,MAAM,UAAV,CACE,KAAK,SAAL,GAAiB,OAAjB,CAAyB,IAAzB,CAA8B,IAA9B,GACE,KAAK,SAAL,GAAiB,OAAjB,CAAyB,IAAzB,CAA8B,IADhC,GAEE,CAHJ,CADF;AAOD;;AAED,UAAI,KAAK,SAAL,GAAiB,OAAjB,CAAyB,IAA7B,EAAmC;AACjC,aAAK,QAAL,GAAgB,GAAhB,CACE,IAAI,MAAM,UAAV,CACE,KAAK,SAAL,GAAiB,OAAjB,CAAyB,IAAzB,CAA8B,IAA9B,GACE,KAAK,SAAL,GAAiB,OAAjB,CAAyB,IAAzB,CAA8B,IADhC,GAEE,EAHJ,EAIE,KAAK,SAAL,GAAiB,OAAjB,CAAyB,IAAzB,CAA8B,IAA9B,GACE,KAAK,SAAL,GAAiB,OAAjB,CAAyB,IAAzB,CAA8B,IADhC,GAEE,CANJ,CADF;AAUD;AACF;;;;;;;;4BAKO;AACN,UAAM,QAAQ,IAAI,MAAM,KAAV,EAAd;UACE,QAAQ,IADV;UAEE,QAAQ,MAAM,QAAN,EAFV;UAGE,eAAe,MAAM,SAAN,GAAkB,SAAlB,EAHjB;UAIE,WAAW,MAAM,WAAN,EAJb;;AAMA,aAAO,gBAAP,GAA2B,YAAM;AAC/B,eAAO,OAAO,qBAAP,IACF,OAAO,2BADL,IAEF,OAAO,wBAFL,IAGF,UAAU,QAAV,EAAoB;AACrB,iBAAO,UAAP,CAAkB,QAAlB,EAA4B,OAAO,EAAnC;AACD,SALH;AAMD,OAPyB,EAA1B;;AASA,eAAS,MAAT,CAAgB,IAAhB,EAAsB;AACpB,eAAO,gBAAP,CAAwB,MAAxB;;;AAGA,YAAI,MAAM,MAAV,EAAkB,MAAM,MAAN,CAAa,KAAb;;AAElB,cAAM,QAAN,CAAe,KAAf;;AAEA,YAAI,MAAM,QAAV,EAAoB,MAAM,QAAN;AACpB,YAAI,MAAM,QAAV,EAAoB,MAAM,eAAN;;;AAGpB,YAAI,MAAM,SAAN,IAAmB,MAAM,MAA7B,EAAqC;AACnC,gBAAM,SAAN,CAAgB,KAAhB;AACA,gBAAM,SAAN,CAAgB,MAAhB,CAAuB,KAAvB,EAA8B,YAA9B;AACA,gBAAM,SAAN,CAAgB,IAAhB,CAAqB,MAAM,SAAN,CAAgB,KAArC;AACA,gBAAM,SAAN,CAAgB,QAAhB;AACD,SALD,MAKO,IAAI,MAAM,MAAV,EAAkB,SAAS,MAAT,CAAgB,KAAhB,EAAuB,YAAvB;;AAEzB,cAAM,UAAN,CAAiB,IAAjB;;;AAGA,YAAI,MAAM,MAAV,EAAkB,MAAM,MAAN,CAAa,GAAb;AACnB;;AAED,WAAK,OAAL,GAAe,MAAf;;AAEA,YAAM,OAAN;AACD;;;;;;;;;;+BAOU,I,EAAM;AACf,WAAK,IAAI,IAAI,CAAb,EAAgB,IAAI,KAAK,KAAL,CAAW,MAA/B,EAAuC,GAAvC,EAA4C;AAC1C,YAAM,IAAI,KAAK,KAAL,CAAW,CAAX,CAAV;AACA,YAAI,EAAE,OAAN,EAAe,EAAE,OAAF,CAAU,EAAE,KAAZ,EAAmB,IAAnB;AAChB;AACF;;;;;;;;sCAKiB;AAChB,WAAK,QAAL,CAAc,MAAd,CAAqB,KAAK,GAAL,KAAa,KAAK,IAAvC;AACA,WAAK,IAAL,GAAY,KAAK,GAAL,EAAZ;AACD;;;;;;;;;;6BAOQ,K,EAAO;AACd,UAAM,QAAQ,MAAM,QAAN,EAAd;;AAEA,WAAK,IAAI,IAAI,CAAb,EAAgB,IAAI,KAAK,QAAL,CAAc,MAAlC,EAA0C,GAA1C;AACE,YAAI,KAAK,QAAL,CAAc,CAAd,EAAiB,KAAjB,KAA2B,OAA/B,EAAwC,KAAK,QAAL,CAAc,CAAd,EAAiB,SAAjB,GAA6B,KAA7B,CAAmC,MAAnC,CAA0C,KAA1C;AAD1C;AAED;;;;;;;;8BAK8B;AAAA,UAAvB,KAAuB,yDAAf,CAAe;AAAA,UAAZ,MAAY,yDAAH,CAAG;;AAC7B,WAAK,SAAL,GAAiB,SAAjB,GAA6B,MAA7B,GAAsC,QAAQ,MAA9C;AACA,WAAK,SAAL,GAAiB,SAAjB,GAA6B,sBAA7B;;AAEA,WAAK,WAAL,GAAmB,OAAnB,CACE,OAAO,QAAQ,KAAK,SAAL,GAAiB,MAAhC,EAAwC,OAAxC,EADF,EAEE,OAAO,SAAS,KAAK,SAAL,GAAiB,OAAjC,EAA0C,OAA1C,EAFF;AAID;;;6BAEQ,K,EAAO;AACd,WAAK,KAAL,GAAa,KAAb;AACA,aAAO,KAAK,KAAZ;AACD;;;+BAEU;AACT,aAAO,KAAK,KAAZ;AACD;;;gCAEW,Q,EAAU;AACpB,WAAK,QAAL,GAAgB,QAAhB;AACA,aAAO,KAAK,QAAZ;AACD;;;kCAEa;AACZ,aAAO,KAAK,QAAZ;AACD;;;gCAEW,Q,EAAU;AACpB,UAAM,WAAW,SAAS,IAAT,CAAjB;;AAEA,WAAK,QAAL,GAAgB,oBAAoB,KAApB,GAA4B,SAAS,CAAT,CAA5B,GAA0C,QAA1D;;AAEA,UACE,oBAAoB,KAApB,IACG,OAAO,SAAS,CAAT,CAAP,KAAuB,UAF5B,EAGE,SAAS,CAAT,EAAY,IAAZ;;AAEF,aAAO,KAAK,QAAZ;AACD;;;;;;;;;;8BAOS,M,EAAQ;AAChB,UAAI,gCAAJ,EACE,KAAK,MAAL,GAAc,MAAd,CADF,KAGE,QAAQ,KAAR,CAAc,sDAAd;AACH;;;gCAEW;AACV,aAAO,KAAK,MAAZ;AACD;;;;;QAID,K,GAAA,K","file":"World.js","sourcesContent":["import * as THREE from 'three';\nimport Stats from 'stats.js';\nimport Physijs from '../physics/physi.js';\n\nimport {PerspectiveCamera} from '../cameras/PerspectiveCamera';\nimport {Camera} from './Camera';\nimport {WHSObject} from './Object';\n\nclass World extends WHSObject {\n  /**\n   * Create a 3D world and define defaults.\n   *\n   * @param {object} params - The scene settings object.\n   * @return {World} A 3D world whs object.\n   */\n  constructor(params = {}) {\n    super({\n\n      stats: false,\n      autoresize: false,\n\n      shadowmap: {\n        enabled: true,\n        type: THREE.PCFSoftShadowMap\n      },\n\n      helpers: {\n        grid: false,\n        axis: false\n      },\n\n      gravity: {\n        x: 0,\n        y: 0,\n        z: 0\n      },\n\n      camera: {\n        aspect: 75,\n        near: 1,\n        far: 1000,\n\n        x: 0,\n        y: 0,\n        z: 0\n      },\n\n      rWidth: 1, // Resolution(width).\n      rHeight: 1, // Resolution(height).\n\n      width: window.innerWidth, // Container(width).\n      height: window.innerHeight, // Container(height).\n\n      physics: {\n\n        quatNormalizeSkip: 0,\n        quatNormalizeFast: false,\n\n        solver: {\n          iterations: 20,\n          tolerance: 0\n        },\n\n        defMaterial: {\n          contactEquationStiffness: 1e8,\n          contactEquationRegularizationTime: 3\n        }\n\n      },\n\n      background: 0x000000,\n      assets: './assets',\n      container: document.body,\n\n      paths: {\n        worker: '../libs/physijs_worker.js',\n        ammo: '../libs/ammo.js'\n      }\n\n    });\n\n    super.setParams(params);\n\n    // INIT.\n    this._initScene();\n    this._initDOM();\n\n    if (!(\n      typeof process === 'object'\n      && Object.prototype.toString.call(process) === '[object process]'\n      )) this._initStats();\n\n    this._initCamera();\n    this._initRenderer();\n    this._initHelpers();\n\n    // NOTE: ==================== Autoresize. ======================\n    const scope = this;\n\n    if (this.getParams().autoresize) {\n      window.addEventListener('resize', () => {\n        scope.setSize(window.innerWidth, window.innerHeight);\n      });\n    }\n\n    scope.loops = [];\n\n    return scope;\n  }\n\n  /**\n   * Initialize THREE.js scene object.\n   */\n  _initScene() {\n    this._initPhysiJS();\n\n    console.log(Physijs.scripts.worker);\n\n    const scene = new Physijs.Scene();\n\n    scene.setGravity(\n      new THREE.Vector3(\n        this.getParams().gravity.x,\n        this.getParams().gravity.y,\n        this.getParams().gravity.z\n      )\n    );\n\n    this.setScene(scene);\n\n    // Array for processing.\n    this.children = [];\n  }\n\n  addLoop(loop) {\n    this.loops.push(loop); // TODO: Process loops on start\n    // like: this.loops.forEach((elem) => elem.start());\n  }\n\n  removeLoop(loop) {\n    this.loops.filter((l) => l !== loop);\n  }\n\n  /**\n   * Set Physi.js scripts pathes.\n   */\n  _initPhysiJS() {\n    this.simulate = true;\n\n    Physijs.scripts.worker = this.getParams().paths.worker;\n    Physijs.scripts.ammo = this.getParams().paths.ammo;\n  }\n\n  /**\n   * Initialize DOM structure for whitestorm.\n   */\n  _initDOM() {\n    this.getParams().container.style.margin = 0;\n    this.getParams().container.style.padding = 0;\n    this.getParams().container.style.position = 'relative';\n    this.getParams().container.style.overflow = 'hidden';\n\n    this._dom = document.createElement('div');\n    this._dom.className = 'whs';\n\n    this.getParams().container.appendChild(this._dom);\n\n    return this._dom;\n  }\n\n  /**\n   * Inititialize stats plugin.\n   */\n  _initStats() {\n    // Debug Renderer\n    if (this.getParams().stats) {\n      this._stats = new Stats();\n\n      if (this.getParams().stats === 'fps')\n        this._stats.setMode(0);\n\n      else if (this.getParams().stats === 'ms')\n        this._stats.setMode(1);\n\n      else if (this.getParams().stats === 'mb')\n        this._stats.setMode(1);\n\n      else {\n        this._stats.setMode(0);\n        console.warn([this._stats], 'Please, apply stats mode [fps, ms, mb] .');\n      }\n\n      this._stats.domElement.style.position = 'absolute';\n      this._stats.domElement.style.left = '0px';\n      this._stats.domElement.style.bottom = '0px';\n\n      this._dom.appendChild(this._stats.domElement);\n    }\n  }\n\n  /**\n   * Create a camera and add it to scene.\n   */\n  _initCamera() {\n    console.log(this.getParams());\n\n    this.setCamera(new PerspectiveCamera({\n      camera: {\n        fov: this.getParams().camera.aspect,\n        aspect: this.getParams().width / this.getParams().height,\n        near: this.getParams().camera.near,\n        far: this.getParams().camera.far\n      },\n\n      pos: {\n        x: this.getParams().camera.x,\n        y: this.getParams().camera.y,\n        z: this.getParams().camera.z\n      }\n    }));\n\n    this.getCamera().addTo(this);\n  }\n\n  /**\n   * Create a renderer and apply it's options.\n   */\n  _initRenderer() {\n    this.render = true;\n\n        // Renderer.\n    this.setRenderer(new THREE.WebGLRenderer());\n    this.getRenderer().setClearColor(this.getParams().background);\n\n        // Shadowmap.\n    this.getRenderer().shadowMap.enabled = this.getParams().shadowmap.enabled;\n    this.getRenderer().shadowMap.type = this.getParams().shadowmap.type;\n    this.getRenderer().shadowMap.cascade = true;\n\n    this.getRenderer().setSize(\n            Number(this.getParams().width * this.getParams().rWidth).toFixed(),\n            Number(this.getParams().height * this.getParams().rHeight).toFixed()\n        );\n\n    this.getRenderer().render(this.getScene(), this.getCamera().getNative());\n\n    this._dom.appendChild(this.getRenderer().domElement);\n\n    this.getRenderer().domElement.style.width = '100%';\n    this.getRenderer().domElement.style.height = '100%';\n  }\n\n  /**\n   * Add helpers to scene.\n   */\n  _initHelpers() {\n    if (this.getParams().helpers.axis) {\n      this.getScene().add(\n        new THREE.AxisHelper(\n          this.getParams().helpers.axis.size\n          ? this.getParams().helpers.axis.size\n          : 5\n        )\n      );\n    }\n\n    if (this.getParams().helpers.grid) {\n      this.getScene().add(\n        new THREE.GridHelper(\n          this.getParams().helpers.grid.size\n          ? this.getParams().helpers.grid.size\n          : 10,\n          this.getParams().helpers.grid.step\n          ? this.getParams().helpers.grid.step\n          : 1\n        )\n      );\n    }\n  }\n\n  /**\n   * Start animation.\n   */\n  start() {\n    const clock = new THREE.Clock(),\n      scope = this,\n      scene = scope.getScene(),\n      cameraNative = scope.getCamera().getNative(),\n      renderer = scope.getRenderer();\n\n    window.requestAnimFrame = (() => {\n      return window.requestAnimationFrame\n        || window.webkitRequestAnimationFrame\n        || window.mozRequestAnimationFrame\n        || function (callback) {\n          window.setTimeout(callback, 1000 / 60);\n        };\n    })();\n\n    function reDraw(time) {\n      window.requestAnimFrame(reDraw);\n\n      // Init stats.\n      if (scope._stats) scope._stats.begin();\n\n      scope._process(clock);\n\n      if (scope.simulate) scene.simulate();\n      if (scope.controls) scope._updateControls();\n\n      // Effects rendering.\n      if (scope._composer && scope.render) {\n        scope._composer.reset();\n        scope._composer.render(scene, cameraNative);\n        scope._composer.pass(scope._composer.stack);\n        scope._composer.toScreen();\n      } else if (scope.render) renderer.render(scene, cameraNative);\n\n      scope._execLoops(time);\n\n      // End helper.\n      if (scope._stats) scope._stats.end();\n    }\n\n    this._update = reDraw;\n\n    scope._update();\n  }\n\n  /**\n   * Execute all loops with a specific time.\n   *\n   * @params {number} time - The time value that will be passed to loops.\n   */\n  _execLoops(time) {\n    for (let i = 0; i < this.loops.length; i++) {\n      const e = this.loops[i];\n      if (e.enabled) e.execute(e.clock, time);\n    }\n  }\n\n  /**\n   * Update controls time values.\n   */\n  _updateControls() {\n    this.controls.update(Date.now() - this.time);\n    this.time = Date.now();\n  }\n\n  /**\n   * Update morphs animations.\n   *\n   * @params {THREE.Clock} clock - The clock object, which.\n   */\n  _process(clock) {\n    const delta = clock.getDelta();\n\n    for (let i = 0; i < this.children.length; i++)\n      if (this.children[i]._type === 'morph') this.children[i].getNative().mixer.update(delta);\n  }\n\n  /**\n   * This functon will scene properties when it's called.\n   */\n  setSize(width = 1, height = 1) {\n    this.getCamera().getNative().aspect = width / height;\n    this.getCamera().getNative().updateProjectionMatrix();\n\n    this.getRenderer().setSize(\n      Number(width * this.getParams().rWidth).toFixed(),\n      Number(height * this.getParams().rHeight).toFixed()\n    );\n  }\n\n  setScene(scene) {\n    this.scene = scene;\n    return this.scene;\n  }\n\n  getScene() {\n    return this.scene;\n  }\n\n  setRenderer(renderer) {\n    this.renderer = renderer;\n    return this.renderer;\n  }\n\n  getRenderer() {\n    return this.renderer;\n  }\n\n  setControls(controls) {\n    const recieved = controls(this);\n\n    this.controls = recieved instanceof Array ? recieved[0] : recieved;\n\n    if (\n      recieved instanceof Array\n      && typeof recieved[1] === 'function'\n    ) recieved[1](this);\n\n    return this.controls;\n  }\n\n  /**\n   * Set a camera for rendering world.\n   *\n   * @params {WHS.Camera} camera - The camera to be rendered.\n   */\n  setCamera(camera) {\n    if (camera instanceof Camera)\n      this.camera = camera;\n    else\n      console.error('@WHS.World: camera in not an instance of WHS.Camera.');\n  }\n\n  getCamera() {\n    return this.camera;\n  }\n}\n\nexport {\n  World\n};\n\n"]}