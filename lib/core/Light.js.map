{"version":3,"sources":["core/Light.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;IAAY,K;;AAEZ;;AACA;;AACA;;;;;;IAEM,K;;;;;;;;;;;AAQJ,mBAAyC;AAAA,QAA7B,MAA6B,yDAApB,EAAoB;;AAAA;;AAAA,QAAhB,IAAgB,yDAAT,OAAS;AAAA;;AACvC,QAAM,OAAO,SAAP,IAAO,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,EAAa;AACxB,YAAK,CAAL,GAAS,CAAT;AACA,YAAK,CAAL,GAAS,CAAT;AACA,YAAK,CAAL,GAAS,CAAT;AACD,KAJD;;;;AADuC,uGAQjC;AACJ,aAAO;AACL,eAAO,QADF;AAEL,kBAAU,QAFL;AAGL,qBAAa,QAHR;;AAKL,mBAAW,CALN;AAML,kBAAU,GANL;AAOL,eAAO,KAAK,EAAL,GAAU,CAPZ;AAQL,kBAAU,CARL;AASL,eAAO;AATF,OADH;;AAaJ,cAAQ,KAbJ;;AAeJ,iBAAW;AACT,cAAM,IADG;;AAGT,cAAM,CAHG;;AAKT,eAAO,IALE;AAMT,gBAAQ,IANC;;AAQT,cAAM,IARG;AAST,aAAK,GATI;AAUT,aAAK,EAVI;AAWT,kBAAU,GAXD;;AAaT,aAAK,GAbI;AAcT,gBAAQ,CAAC,GAdA;AAeT,cAAM,CAAC,GAfE;AAgBT,eAAO;AAhBE,OAfP;;AAkCJ,WAAK;AACH,WAAG,CADA;AAEH,WAAG,CAFA;AAGH,WAAG,CAHA;AAIH,aAAK;AAJF,OAlCD;;AAyCJ,WAAK;AACH,WAAG,CADA;AAEH,WAAG,CAFA;AAGH,WAAG,CAHA;AAIH,aAAK;AAJF,OAzCD;;AAgDJ,cAAQ;AACN,WAAG,CADG;AAEN,WAAG,CAFG;AAGN,WAAG,CAHG;AAIN,aAAK;AAJC;AAhDJ,KARiC;;AAgEvC,QAAI,kBAAkB,MAAM,KAA5B,EAAmC;AACjC,iGAAgB;AACd,aAAK,EAAC,GAAG,OAAO,QAAP,CAAgB,CAApB,EAAuB,GAAG,OAAO,QAAP,CAAgB,CAA1C,EAA6C,GAAG,OAAO,QAAP,CAAgB,CAAhE,EADS;AAEd,aAAK,EAAC,GAAG,OAAO,QAAP,CAAgB,CAApB,EAAuB,GAAG,OAAO,QAAP,CAAgB,CAA1C,EAA6C,GAAG,OAAO,QAAP,CAAgB,CAAhE,EAFS;AAGd,gBAAQ,EAAC,GAAG,OAAO,MAAP,CAAc,CAAlB,EAAqB,GAAG,OAAO,MAAP,CAAc,CAAtC,EAAyC,GAAG,OAAO,MAAP,CAAc,CAA1D;AAHM,OAAhB;AAKD,KAND,MAMO,2FAAgB,MAAhB;;AAEP,QAAM,QAAQ,OAAO,MAAP,QACZ;AACE,aAAO,IADT;AAEE,cAAQ,MAAK,QAAL,CAAc,KAFxB;AAGE,kBAAY,MAAK,QAAL,CAAc;AAH5B,KADY,CAAd;;AAQA,QAAI,kBAAkB,MAAM,KAA5B,EAAmC,MAAK,SAAL,CAAe,MAAf;AACnC,QAAI,mBAAS,KAAb,EAAoB,QAAQ,KAAR,wBAAmC,MAAM,KAAzC,cAAyD,KAAzD;;AAEpB,kBAAO,KAAP;AACD;;;;;;;;;;;;2BAQa;AAAA,wCAAN,IAAM;AAAN,YAAM;AAAA;;AACZ,UAAM,SAAS,IAAf;;AAEA,aAAO,IAAI,OAAJ,CAAY,UAAC,OAAD,EAAU,MAAV,EAAqB;AACtC,YAAI;AACF,cAAI,KAAK,OAAL,CAAa,YAAb,IAA6B,CAAjC,EAAoC;AAClC,mBAAO,SAAP,GAAmB,UAAnB,GAAgC,IAAhC;AACA,mBAAO,SAAP,GAAmB,aAAnB,GAAmC,IAAnC;AACD;;AAED,cAAI,KAAK,OAAL,CAAa,eAAb,IAAgC,CAApC,EAAuC;AACrC,mBAAO,QAAP,CAAgB,GAAhB,CACE,OAAO,QAAP,CAAgB,GAAhB,CAAoB,CADtB,EAEE,OAAO,QAAP,CAAgB,GAAhB,CAAoB,CAFtB,EAGE,OAAO,QAAP,CAAgB,GAAhB,CAAoB,CAHtB;;AAMA,mBAAO,QAAP,CAAgB,GAAhB,CACE,OAAO,QAAP,CAAgB,GAAhB,CAAoB,CADtB,EAEE,OAAO,QAAP,CAAgB,GAAhB,CAAoB,CAFtB,EAGE,OAAO,QAAP,CAAgB,GAAhB,CAAoB,CAHtB;AAKD;;AAED,eAAK,OAAL,CAAa,eAAO;AAClB,mBAAO,GAAP,IAAc,IAAd;AACD,WAFD;;AAIA,cAAI,mBAAS,KAAb,EACE,QAAQ,KAAR,wBAAmC,OAAO,KAA1C,sBAAiE,MAAjE;;AAEF,iBAAO,IAAP,CAAY,OAAZ;;AAEA,kBAAQ,MAAR;AACD,SA9BD,CA8BE,OAAO,GAAP,EAAY;AACZ,kBAAQ,KAAR,CAAc,IAAI,OAAlB;AACA;AACD;AACF,OAnCM,CAAP;AAoCD;;;;;;;;;;;0BAQK,M,EAAQ;AACZ,WAAK,MAAL,GAAc,MAAd;;AAEA,UAAM,UAAU,KAAK,MAArB;AAAA,UACE,SAAS,IADX;;AAGA,aAAO,IAAI,OAAJ,CAAY,UAAC,OAAD,EAAU,MAAV,EAAqB;AACtC,YAAI;AACF,iBAAO,MAAP,CAAc,QAAd,GAAyB,GAAzB,CAA6B,OAAO,SAAP,EAA7B;AACA,iBAAO,MAAP,CAAc,QAAd,CAAuB,IAAvB,CAA4B,MAA5B;;AAEA,cAAI,OAAJ,EAAa,OAAO,MAAP,CAAc,QAAd,GAAyB,GAAzB,CAA6B,OAA7B;AACd,SALD,CAKE,OAAO,GAAP,EAAY;AACZ,kBAAQ,KAAR,CAAc,IAAI,OAAlB;AACA;AACD,SARD,SAQU;AACR,cAAI,mBAAS,KAAb,EAAoB;AAClB,oBAAQ,KAAR,0BACyB,OAAO,KADhC,2BAEE,CAAC,MAAD,EAAS,OAAO,MAAhB,CAFF;AAID;;AAED,kBAAQ,MAAR;AACA,iBAAO,IAAP,CAAY,OAAZ;AACD;AACF,OApBM,CAAP;AAqBD;;;;;;;;iCAKY;AAAA;;AACX,UAAM,SAAS,IAAf;;AAEA,aAAO,IAAI,OAAJ,CAAY,UAAC,OAAD,EAAU,MAAV,EAAqB;AACtC,YAAI;AACF,iBAAO,SAAP,GAAmB,MAAnB,CAA0B,OAA1B,CAAkC,KAAlC,GAA0C,OAAK,UAAL,CAAgB,KAA1D;AACA,iBAAO,SAAP,GAAmB,MAAnB,CAA0B,OAA1B,CAAkC,MAAlC,GAA2C,OAAK,UAAL,CAAgB,MAA3D;AACA,iBAAO,SAAP,GAAmB,MAAnB,CAA0B,IAA1B,GAAiC,OAAK,UAAL,CAAgB,IAAjD;;AAEA,iBAAO,SAAP,GAAmB,MAAnB,CAA0B,MAA1B,CAAiC,IAAjC,GAAwC,OAAK,UAAL,CAAgB,IAAxD;AACA,iBAAO,SAAP,GAAmB,MAAnB,CAA0B,MAA1B,CAAiC,GAAjC,GAAuC,OAAK,UAAL,CAAgB,GAAvD;AACA,iBAAO,SAAP,GAAmB,MAAnB,CAA0B,MAA1B,CAAiC,GAAjC,GAAuC,OAAK,UAAL,CAAgB,GAAvD;;AAEA,iBAAO,SAAP,GAAmB,MAAnB,CAA0B,MAA1B,CAAiC,IAAjC,GAAwC,OAAK,UAAL,CAAgB,IAAxD;AACA,iBAAO,SAAP,GAAmB,MAAnB,CAA0B,MAA1B,CAAiC,KAAjC,GAAyC,OAAK,UAAL,CAAgB,KAAzD;AACA,iBAAO,SAAP,GAAmB,MAAnB,CAA0B,MAA1B,CAAiC,GAAjC,GAAuC,OAAK,UAAL,CAAgB,GAAvD;AACA,iBAAO,SAAP,GAAmB,MAAnB,CAA0B,MAA1B,CAAiC,MAAjC,GAA0C,OAAK,UAAL,CAAgB,MAA1D;AACD,SAbD,CAaE,OAAO,GAAP,EAAY;AACZ,kBAAQ,KAAR,CAAc,IAAI,OAAlB;AACA;AACD,SAhBD,SAgBU;AACR,kBAAQ,MAAR;AACD;AACF,OApBM,CAAP;AAqBD;;;;;;;;4BAKO;AACN,aAAO,IAAI,KAAJ,CAAU,KAAK,QAAf,EAAyB,KAAK,KAA9B,EAAqC,IAArC,CAA0C,IAA1C,CAAP;AACD;;;;;;;;;;yBAOI,M,EAAQ;AACX,WAAK,KAAL,GAAa,OAAO,SAAP,GAAmB,KAAnB,EAAb;AACA,UAAI,OAAO,MAAX,EAAmB,KAAK,MAAL,GAAc,OAAO,MAAP,CAAc,KAAd,EAAd;;AAEnB,WAAK,IAAL;;AAEA,WAAK,QAAL,GAAgB,OAAO,QAAP,CAAgB,KAAhB,EAAhB;AACA,WAAK,QAAL,GAAgB,OAAO,QAAP,CAAgB,KAAhB,EAAhB;;AAEA,WAAK,KAAL,GAAa,OAAO,KAApB;;AAEA,aAAO,IAAP;AACD;;;;;;;;6BAKQ;AACP,WAAK,MAAL,CAAY,QAAZ,GAAuB,MAAvB,CAA8B,KAAK,SAAL,EAA9B;AACA,UAAI,OAAO,MAAX,EAAmB,KAAK,MAAL,CAAY,QAAZ,GAAuB,MAAvB,CAA8B,KAAK,MAAnC;;AAEnB,WAAK,MAAL,CAAY,QAAZ,CAAqB,MAArB,CAA4B,KAAK,MAAL,CAAY,QAAZ,CAAqB,OAArB,CAA6B,IAA7B,CAA5B,EAAgE,CAAhE;AACA,WAAK,MAAL,GAAc,IAAd;;AAEA,WAAK,IAAL,CAAU,QAAV;;AAEA,aAAO,IAAP;AACD;;;;;;8BAIS,M,EAAQ;AAChB,WAAK,MAAL,GAAc,MAAd;AACA,aAAO,KAAK,MAAZ;AACD;;;gCAEW;AACV,aAAO,KAAK,MAAZ;AACD;;;2BA0BM,K,EAAkC;AAAA,UAA3B,IAA2B,yDAApB,IAAoB;AAAA,UAAd,IAAc;AAAA,UAAR,MAAQ;;AACvC,UAAM,SAAS,IAAf;AAAA,UACE,OAAO,IADT;;AAGA,UAAI,YAAY,eAAS,iBAAS;AAChC,YAAM,IAAI,MAAM,cAAN,KAAyB,IAAzB,GAAgC,IAA1C;AAAA,YACE,OAAO,MAAM,QAAN,CAAe,CAAf,CADT;AAAA,YAEE,OAAO,MAAM,QAAN,CAAe,CAAC,IAAI,IAAL,IAAa,CAA5B,CAFT;;AAIA,eAAO,QAAP,CAAgB,GAAhB,CAAoB,KAAK,CAAzB,EAA4B,KAAK,CAAjC,EAAoC,KAAK,CAAzC;;AAEA,YAAI,CAAC,MAAL,EAAa,OAAO,MAAP,CAAc,IAAd,EAAb,KACK,IAAI,kBAAkB,MAAM,OAA5B,EAAqC,OAAO,MAAP,CAAc,MAAd,EAArC,KACA,IACD,kBAAkB,MAAM,KAAxB,IACG,kBAAkB,MAAM,SAF1B,EAGD,OAAO,MAAP,CAAc,OAAO,QAAP,CAAgB,CAAhB,CAAd;AACL,OAbe,CAAhB;;AAeA,gBAAU,KAAV;;AAEA,UAAI,IAAJ,EAAU;AACR,oBAAY,YAAM;AAChB,oBAAU,IAAV;;AAEA,sBAAY,eAAS,iBAAS;AAC5B,gBAAM,IAAI,MAAM,cAAN,KAAyB,IAAzB,GAAgC,IAA1C;AAAA,gBACE,OAAO,MAAM,QAAN,CAAe,CAAf,CADT;AAAA,gBAEE,OAAO,MAAM,QAAN,CAAe,CAAC,IAAI,IAAL,IAAa,CAA5B,CAFT;;AAIA,mBAAO,QAAP,CAAgB,GAAhB,CAAoB,KAAK,CAAzB,EAA4B,KAAK,CAAjC,EAAoC,KAAK,CAAzC;;AAEA,gBAAI,CAAC,MAAL,EAAa,OAAO,MAAP,CAAc,IAAd,EAAb,KACK,IAAI,kBAAkB,MAAM,OAA5B,EAAqC,OAAO,MAAP,CAAc,MAAd,EAArC,KACA,IACD,kBAAkB,MAAM,KAAxB,IACG,kBAAkB,MAAM,SAF1B,EAGD,OAAO,MAAP,CAAc,OAAO,QAAP,CAAgB,CAAhB,CAAd;AACL,WAbW,CAAZ;;AAeA,oBAAU,KAAV;AACD,SAnBD,EAmBG,IAnBH;AAoBD,OArBD,MAqBO;AACL,mBAAW,YAAM;AACf,oBAAU,IAAV;AACD,SAFD,EAEG,IAFH;AAGD;AACF;;;wBAvEc;AACb,aAAO,KAAK,SAAL,GAAiB,QAAxB;AACD,K;sBAEY,O,EAAS;AACpB,aAAO,KAAK,SAAL,GAAiB,QAAjB,CAA0B,IAA1B,CAA+B,OAA/B,CAAP;AACD;;;wBAEc;AACb,aAAO,KAAK,SAAL,GAAiB,QAAxB;AACD,K;sBAEY,K,EAAO;AAClB,aAAO,KAAK,SAAL,GAAiB,QAAjB,CAA0B,IAA1B,CAA+B,KAA/B,CAAP;AACD;;;wBAEY;AACX,aAAO,KAAK,SAAL,GAAiB,MAAjB,CAAwB,QAA/B;AACD,K;sBAEU,O,EAAS;AAClB,aAAO,KAAK,SAAL,GAAiB,MAAjB,CAAwB,QAAxB,CAAiC,IAAjC,CAAsC,OAAtC,CAAP;AACD;;;;;QAqDD,K,GAAA,K","file":"Light.js","sourcesContent":["import * as THREE from 'three';\n\nimport {Loop} from '../extensions/Loop';\nimport {defaults} from '../utils/defaults';\nimport {WHSObject} from './Object';\n\nclass Light extends WHSObject {\n  /**\n   * Constructing WHS.Light object.\n   *\n   * @param {Object} params - Inputed parameters.\n   * @param {String} type - Light type.\n   * @return {WHS.Light}\n   */\n  constructor(params = {}, type = 'light') {\n    const _set = (x, y, z) => {\n      this.x = x;\n      this.y = y;\n      this.z = z;\n    };\n\n    // Polyfill for 3D.\n    super({\n      light: {\n        color: 0xffffff,\n        skyColor: 0xffffff,\n        groundColor: 0xffffff,\n\n        intensity: 1,\n        distance: 100,\n        angle: Math.PI / 3,\n        exponent: 0,\n        decay: 1\n      },\n\n      helper: false,\n\n      shadowmap: {\n        cast: true,\n\n        bias: 0,\n\n        width: 1024,\n        height: 1024,\n\n        near: true,\n        far: 400,\n        fov: 60,\n        darkness: 0.3,\n\n        top: 200,\n        bottom: -200,\n        left: -200,\n        right: 200\n      },\n\n      pos: {\n        x: 0,\n        y: 0,\n        z: 0,\n        set: _set\n      },\n\n      rot: {\n        x: 0,\n        y: 0,\n        z: 0,\n        set: _set\n      },\n\n      target: {\n        x: 0,\n        y: 0,\n        z: 0,\n        set: _set\n      }\n    });\n\n    if (params instanceof THREE.Light) {\n      super.setParams({\n        pos: {x: params.position.x, y: params.position.y, z: params.position.z},\n        rot: {x: params.rotation.x, y: params.rotation.y, z: params.rotation.z},\n        target: {x: params.target.x, y: params.target.y, z: params.target.z}\n      });\n    } else super.setParams(params);\n\n    const scope = Object.assign(this,\n      {\n        _type: type,\n        _light: this.__params.light,\n        _shadowmap: this.__params.shadowmap\n      }\n    );\n\n    if (params instanceof THREE.Light) this.setNative(params);\n    if (defaults.debug) console.debug(`@WHS.Light: Light ${scope._type} found.`, scope);\n\n    return scope;\n  }\n\n  /**\n   * Applying shadow & position & rotation.\n   *\n   * @param {...String} tags - Tags that defines what to do with light\n   * additionally.\n   */\n  wrap(...tags) {\n    const _scope = this;\n\n    return new Promise((resolve, reject) => {\n      try {\n        if (tags.indexOf('no-shadows') < 0) {\n          _scope.getNative().castShadow = true;\n          _scope.getNative().receiveShadow = true;\n        }\n\n        if (tags.indexOf('no-transforms') < 0) {\n          _scope.position.set(\n            _scope.__params.pos.x,\n            _scope.__params.pos.y,\n            _scope.__params.pos.z\n          );\n\n          _scope.rotation.set(\n            _scope.__params.rot.x,\n            _scope.__params.rot.y,\n            _scope.__params.rot.z\n          );\n        }\n\n        tags.forEach(tag => {\n          _scope[tag] = true;\n        });\n\n        if (defaults.debug)\n          console.debug(`@WHS.Light: Light ${_scope._type} + ' is ready.`, _scope);\n\n        _scope.emit('ready');\n\n        resolve(_scope);\n      } catch (err) {\n        console.error(err.message);\n        reject();\n      }\n    });\n  }\n\n  /**\n   * Add light to WHS.World object.\n   *\n   * @param {WHS.World} root - World, were this light will be.\n   * @param {...String} tags - Tags for compiling.\n   */\n  addTo(parent) {\n    this.parent = parent;\n\n    const _helper = this.helper,\n      _scope = this;\n\n    return new Promise((resolve, reject) => {\n      try {\n        _scope.parent.getScene().add(_scope.getNative());\n        _scope.parent.children.push(_scope);\n\n        if (_helper) _scope.parent.getScene().add(_helper);\n      } catch (err) {\n        console.error(err.message);\n        reject();\n      } finally {\n        if (defaults.debug) {\n          console.debug(\n            `@WHS.Camera: Camera ${_scope._type} was added to world.`,\n            [_scope, _scope.parent]\n          );\n        }\n\n        resolve(_scope);\n        _scope.emit('ready');\n      }\n    });\n  }\n\n  /**\n   * Set shadow properties for light.\n   */\n  wrapShadow() {\n    const _scope = this;\n\n    return new Promise((resolve, reject) => {\n      try {\n        _scope.getNative().shadow.mapSize.width = this._shadowmap.width;\n        _scope.getNative().shadow.mapSize.height = this._shadowmap.height;\n        _scope.getNative().shadow.bias = this._shadowmap.bias;\n\n        _scope.getNative().shadow.camera.near = this._shadowmap.near;\n        _scope.getNative().shadow.camera.far = this._shadowmap.far;\n        _scope.getNative().shadow.camera.fov = this._shadowmap.fov;\n\n        _scope.getNative().shadow.camera.left = this._shadowmap.left;\n        _scope.getNative().shadow.camera.right = this._shadowmap.right;\n        _scope.getNative().shadow.camera.top = this._shadowmap.top;\n        _scope.getNative().shadow.camera.bottom = this._shadowmap.bottom;\n      } catch (err) {\n        console.error(err.message);\n        reject();\n      } finally {\n        resolve(_scope);\n      }\n    });\n  }\n\n  /**\n   * Clone light.\n   */\n  clone() {\n    return new Light(this.__params, this._type).copy(this);\n  }\n\n  /**\n   * Copy light.\n   *\n   * @param {WHS.Light} source - Source object, that will be applied to this.\n   */\n  copy(source) {\n    this.light = source.getNative().clone();\n    if (source.helper) this.helper = source.helper.clone();\n\n    this.wrap();\n\n    this.position = source.position.clone();\n    this.rotation = source.rotation.clone();\n\n    this._type = source._type;\n\n    return this;\n  }\n\n  /**\n   * Remove this light from world.\n   */\n  remove() {\n    this.parent.getScene().remove(this.getNative());\n    if (source.helper) this.parent.getScene().remove(this.helper);\n\n    this.parent.children.splice(this.parent.children.indexOf(this), 1);\n    this.parent = null;\n\n    this.emit('remove');\n\n    return this;\n  }\n\n  /* Access private data */\n\n  setNative(native) {\n    this.native = native;\n    return this.native;\n  }\n\n  getNative() {\n    return this.native;\n  }\n\n  get position() {\n    return this.getNative().position;\n  }\n\n  set position(vector3) {\n    return this.getNative().position.copy(vector3);\n  }\n\n  get rotation() {\n    return this.getNative().rotation;\n  }\n\n  set rotation(euler) {\n    return this.getNative().rotation.copy(euler);\n  }\n\n  get target() {\n    return this.getNative().target.position;\n  }\n\n  set target(vector3) {\n    return this.getNative().target.position.copy(vector3);\n  }\n\n  follow(curve, time = 1000, loop, lookAt) {\n    const _scope = this,\n      gEnd = time;\n\n    let animation = new Loop(clock => {\n      const u = clock.getElapsedTime() * 1000 / gEnd,\n        vec1 = curve.getPoint(u),\n        vec2 = curve.getPoint((u + 0.01) % 1);\n\n      _scope.position.set(vec1.x, vec1.y, vec1.z);\n\n      if (!lookAt) _scope.lookAt(vec2);\n      else if (lookAt instanceof THREE.Vector3) _scope.lookAt(lookAt);\n      else if (\n          lookAt instanceof THREE.Curve\n          || lookAt instanceof THREE.CurvePath\n        ) _scope.lookAt(lookAt.getPoint(u));\n    });\n\n    animation.start();\n\n    if (loop) {\n      setInterval(() => {\n        animation.stop();\n\n        animation = new Loop(clock => {\n          const u = clock.getElapsedtime() * 1000 / gEnd,\n            vec1 = curve.getPoint(u),\n            vec2 = curve.getPoint((u + 0.01) % 1);\n\n          _scope.position.set(vec1.x, vec1.y, vec1.z);\n\n          if (!lookAt) _scope.lookAt(vec2);\n          else if (lookAt instanceof THREE.Vector3) _scope.lookAt(lookAt);\n          else if (\n              lookAt instanceof THREE.Curve\n              || lookAt instanceof THREE.CurvePath\n            ) _scope.lookAt(lookAt.getPoint(u));\n        });\n\n        animation.start();\n      }, time);\n    } else {\n      setTimeout(() => {\n        animation.stop();\n      }, time);\n    }\n  }\n}\n\nexport {\n  Light\n};\n"]}