{"version":3,"sources":["physics/physi.js"],"names":[],"mappings":"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","file":"physi.js","sourcesContent":["import * as THREE from 'three';\r\n\r\nvar SUPPORT_TRANSFERABLE,\r\n  _Physijs = Physijs, // used for noConflict method\r\n  Physijs = {}, // object assigned to window.Physijs\r\n  Eventable, // class to provide simple event methods\r\n  getObjectId, // returns a unique ID for a Physijs mesh object\r\n  getEulerXYZFromQuaternion, getQuatertionFromEuler,\r\n  convertWorldPositionToObject, // Converts a world-space position to object-space\r\n  addObjectChildren,\r\n\r\n  _temp1, _temp2,\r\n  _temp_vector3_1 = new THREE.Vector3(),\r\n  _temp_vector3_2 = new THREE.Vector3(),\r\n  _temp_matrix4_1 = new THREE.Matrix4(),\r\n  _quaternion_1 = new THREE.Quaternion(),\r\n\r\n// constants\r\n  MESSAGE_TYPES = {\r\n    WORLDREPORT: 0,\r\n    COLLISIONREPORT: 1,\r\n    VEHICLEREPORT: 2,\r\n    CONSTRAINTREPORT: 3\r\n  },\r\n  REPORT_ITEMSIZE = 14,\r\n  COLLISIONREPORT_ITEMSIZE = 5,\r\n  VEHICLEREPORT_ITEMSIZE = 9,\r\n  CONSTRAINTREPORT_ITEMSIZE = 6;\r\n\r\nPhysijs.scripts = {};\r\n\r\nEventable = function () {\r\n  this._eventListeners = {};\r\n};\r\nEventable.prototype.addEventListener = function (event_name, callback) {\r\n  if (!this._eventListeners.hasOwnProperty(event_name)) {\r\n    this._eventListeners[event_name] = [];\r\n  }\r\n  this._eventListeners[event_name].push(callback);\r\n};\r\nEventable.prototype.removeEventListener = function (event_name, callback) {\r\n  var index;\r\n\r\n  if (!this._eventListeners.hasOwnProperty(event_name)) return false;\r\n\r\n  if ((index = this._eventListeners[event_name].indexOf(callback)) >= 0) {\r\n    this._eventListeners[event_name].splice(index, 1);\r\n    return true;\r\n  }\r\n\r\n  return false;\r\n};\r\nEventable.prototype.dispatchEvent = function (event_name) {\r\n  var i,\r\n    parameters = Array.prototype.splice.call(arguments, 1);\r\n\r\n  if (this._eventListeners.hasOwnProperty(event_name)) {\r\n    for (i = 0; i < this._eventListeners[event_name].length; i++) {\r\n      this._eventListeners[event_name][i].apply(this, parameters);\r\n    }\r\n  }\r\n};\r\nEventable.make = function (obj) {\r\n  obj.prototype.addEventListener = Eventable.prototype.addEventListener;\r\n  obj.prototype.removeEventListener = Eventable.prototype.removeEventListener;\r\n  obj.prototype.dispatchEvent = Eventable.prototype.dispatchEvent;\r\n};\r\n\r\ngetObjectId = (function () {\r\n  var _id = 1;\r\n  return function () {\r\n    return _id++;\r\n  };\r\n})();\r\n\r\ngetEulerXYZFromQuaternion = function (x, y, z, w) {\r\n  return new THREE.Vector3(\r\n    Math.atan2(2 * ( x * w - y * z ), ( w * w - x * x - y * y + z * z )),\r\n    Math.asin(2 * ( x * z + y * w )),\r\n    Math.atan2(2 * ( z * w - x * y ), ( w * w + x * x - y * y - z * z ))\r\n  );\r\n};\r\n\r\ngetQuatertionFromEuler = function (x, y, z) {\r\n  var c1, s1, c2, s2, c3, s3, c1c2, s1s2;\r\n  c1 = Math.cos(y);\r\n  s1 = Math.sin(y);\r\n  c2 = Math.cos(-z);\r\n  s2 = Math.sin(-z);\r\n  c3 = Math.cos(x);\r\n  s3 = Math.sin(x);\r\n\r\n  c1c2 = c1 * c2;\r\n  s1s2 = s1 * s2;\r\n\r\n  return {\r\n    w: c1c2 * c3 - s1s2 * s3,\r\n    x: c1c2 * s3 + s1s2 * c3,\r\n    y: s1 * c2 * c3 + c1 * s2 * s3,\r\n    z: c1 * s2 * c3 - s1 * c2 * s3\r\n  };\r\n};\r\n\r\nconvertWorldPositionToObject = function (position, object) {\r\n  _temp_matrix4_1.identity(); // reset temp matrix\r\n\r\n  // Set the temp matrix's rotation to the object's rotation\r\n  _temp_matrix4_1.identity().makeRotationFromQuaternion(object.quaternion);\r\n\r\n  // Invert rotation matrix in order to \"unrotate\" a point back to object space\r\n  _temp_matrix4_1.getInverse(_temp_matrix4_1);\r\n\r\n  // Yay! Temp vars!\r\n  _temp_vector3_1.copy(position);\r\n  _temp_vector3_2.copy(object.position);\r\n\r\n  // Apply the rotation\r\n\r\n  return _temp_vector3_1.sub(_temp_vector3_2).applyMatrix4(_temp_matrix4_1);\r\n};\r\n\r\n\r\n// Physijs.noConflict\r\nPhysijs.noConflict = function () {\r\n  window.Physijs = _Physijs;\r\n  return Physijs;\r\n};\r\n\r\n\r\n// Physijs.createMaterial\r\nPhysijs.createMaterial = function (material, friction, restitution) {\r\n  var physijs_material = function () {\r\n  };\r\n  physijs_material.prototype = material;\r\n  physijs_material = new physijs_material;\r\n\r\n  physijs_material._physijs = {\r\n    id: material.id,\r\n    friction: friction === undefined ? .8 : friction,\r\n    restitution: restitution === undefined ? .2 : restitution\r\n  };\r\n\r\n  return physijs_material;\r\n};\r\n\r\n\r\n// Constraints\r\nPhysijs.PointConstraint = function (objecta, objectb, position) {\r\n  if (position === undefined) {\r\n    position = objectb;\r\n    objectb = undefined;\r\n  }\r\n\r\n  this.type = 'point';\r\n  this.appliedImpulse = 0;\r\n  this.id = getObjectId();\r\n  this.objecta = objecta._physijs.id;\r\n  this.positiona = convertWorldPositionToObject(position, objecta).clone();\r\n\r\n  if (objectb) {\r\n    this.objectb = objectb._physijs.id;\r\n    this.positionb = convertWorldPositionToObject(position, objectb).clone();\r\n  }\r\n};\r\nPhysijs.PointConstraint.prototype.getDefinition = function () {\r\n  return {\r\n    type: this.type,\r\n    id: this.id,\r\n    objecta: this.objecta,\r\n    objectb: this.objectb,\r\n    positiona: this.positiona,\r\n    positionb: this.positionb\r\n  };\r\n};\r\n\r\nPhysijs.HingeConstraint = function (objecta, objectb, position, axis) {\r\n  if (axis === undefined) {\r\n    axis = position;\r\n    position = objectb;\r\n    objectb = undefined;\r\n  }\r\n\r\n  this.type = 'hinge';\r\n  this.appliedImpulse = 0;\r\n  this.id = getObjectId();\r\n  this.scene = objecta.parent;\r\n  this.objecta = objecta._physijs.id;\r\n  this.positiona = convertWorldPositionToObject(position, objecta).clone();\r\n  this.position = position.clone();\r\n  this.axis = axis;\r\n\r\n  if (objectb) {\r\n    this.objectb = objectb._physijs.id;\r\n    this.positionb = convertWorldPositionToObject(position, objectb).clone();\r\n  }\r\n};\r\nPhysijs.HingeConstraint.prototype.getDefinition = function () {\r\n  return {\r\n    type: this.type,\r\n    id: this.id,\r\n    objecta: this.objecta,\r\n    objectb: this.objectb,\r\n    positiona: this.positiona,\r\n    positionb: this.positionb,\r\n    axis: this.axis\r\n  };\r\n};\r\n/*\r\n * low = minimum angle in radians\r\n * high = maximum angle in radians\r\n * bias_factor = applied as a factor to constraint error\r\n * relaxation_factor = controls bounce (0.0 == no bounce)\r\n */\r\nPhysijs.HingeConstraint.prototype.setLimits = function (low, high, bias_factor, relaxation_factor) {\r\n  this.scene.execute('hinge_setLimits', {\r\n    constraint: this.id,\r\n    low: low,\r\n    high: high,\r\n    bias_factor: bias_factor,\r\n    relaxation_factor: relaxation_factor\r\n  });\r\n};\r\nPhysijs.HingeConstraint.prototype.enableAngularMotor = function (velocity, acceleration) {\r\n  this.scene.execute('hinge_enableAngularMotor', {\r\n    constraint: this.id,\r\n    velocity: velocity,\r\n    acceleration: acceleration\r\n  });\r\n};\r\nPhysijs.HingeConstraint.prototype.disableMotor = function (velocity, acceleration) {\r\n  this.scene.execute('hinge_disableMotor', {constraint: this.id});\r\n};\r\n\r\nPhysijs.SliderConstraint = function (objecta, objectb, position, axis) {\r\n  if (axis === undefined) {\r\n    axis = position;\r\n    position = objectb;\r\n    objectb = undefined;\r\n  }\r\n\r\n  this.type = 'slider';\r\n  this.appliedImpulse = 0;\r\n  this.id = getObjectId();\r\n  this.scene = objecta.parent;\r\n  this.objecta = objecta._physijs.id;\r\n  this.positiona = convertWorldPositionToObject(position, objecta).clone();\r\n  this.axis = axis;\r\n\r\n  if (objectb) {\r\n    this.objectb = objectb._physijs.id;\r\n    this.positionb = convertWorldPositionToObject(position, objectb).clone();\r\n  }\r\n};\r\nPhysijs.SliderConstraint.prototype.getDefinition = function () {\r\n  return {\r\n    type: this.type,\r\n    id: this.id,\r\n    objecta: this.objecta,\r\n    objectb: this.objectb,\r\n    positiona: this.positiona,\r\n    positionb: this.positionb,\r\n    axis: this.axis\r\n  };\r\n};\r\nPhysijs.SliderConstraint.prototype.setLimits = function (lin_lower, lin_upper, ang_lower, ang_upper) {\r\n  this.scene.execute('slider_setLimits', {\r\n    constraint: this.id,\r\n    lin_lower: lin_lower,\r\n    lin_upper: lin_upper,\r\n    ang_lower: ang_lower,\r\n    ang_upper: ang_upper\r\n  });\r\n};\r\nPhysijs.SliderConstraint.prototype.setRestitution = function (linear, angular) {\r\n  this.scene.execute(\r\n    'slider_setRestitution',\r\n    {\r\n      constraint: this.id,\r\n      linear: linear,\r\n      angular: angular\r\n    }\r\n  );\r\n};\r\nPhysijs.SliderConstraint.prototype.enableLinearMotor = function (velocity, acceleration) {\r\n  this.scene.execute('slider_enableLinearMotor', {\r\n    constraint: this.id,\r\n    velocity: velocity,\r\n    acceleration: acceleration\r\n  });\r\n};\r\nPhysijs.SliderConstraint.prototype.disableLinearMotor = function () {\r\n  this.scene.execute('slider_disableLinearMotor', {constraint: this.id});\r\n};\r\nPhysijs.SliderConstraint.prototype.enableAngularMotor = function (velocity, acceleration) {\r\n  this.scene.execute('slider_enableAngularMotor', {\r\n    constraint: this.id,\r\n    velocity: velocity,\r\n    acceleration: acceleration\r\n  });\r\n};\r\nPhysijs.SliderConstraint.prototype.disableAngularMotor = function () {\r\n  this.scene.execute('slider_disableAngularMotor', {constraint: this.id});\r\n};\r\n\r\nPhysijs.ConeTwistConstraint = function (objecta, objectb, position) {\r\n  if (position === undefined) {\r\n    throw 'Both objects must be defined in a ConeTwistConstraint.';\r\n  }\r\n  this.type = 'conetwist';\r\n  this.appliedImpulse = 0;\r\n  this.id = getObjectId();\r\n  this.scene = objecta.parent;\r\n  this.objecta = objecta._physijs.id;\r\n  this.positiona = convertWorldPositionToObject(position, objecta).clone();\r\n  this.objectb = objectb._physijs.id;\r\n  this.positionb = convertWorldPositionToObject(position, objectb).clone();\r\n  this.axisa = {x: objecta.rotation.x, y: objecta.rotation.y, z: objecta.rotation.z};\r\n  this.axisb = {x: objectb.rotation.x, y: objectb.rotation.y, z: objectb.rotation.z};\r\n};\r\nPhysijs.ConeTwistConstraint.prototype.getDefinition = function () {\r\n  return {\r\n    type: this.type,\r\n    id: this.id,\r\n    objecta: this.objecta,\r\n    objectb: this.objectb,\r\n    positiona: this.positiona,\r\n    positionb: this.positionb,\r\n    axisa: this.axisa,\r\n    axisb: this.axisb\r\n  };\r\n};\r\nPhysijs.ConeTwistConstraint.prototype.setLimit = function (x, y, z) {\r\n  this.scene.execute('conetwist_setLimit', {constraint: this.id, x: x, y: y, z: z});\r\n};\r\nPhysijs.ConeTwistConstraint.prototype.enableMotor = function () {\r\n  this.scene.execute('conetwist_enableMotor', {constraint: this.id});\r\n};\r\nPhysijs.ConeTwistConstraint.prototype.setMaxMotorImpulse = function (max_impulse) {\r\n  this.scene.execute('conetwist_setMaxMotorImpulse', {constraint: this.id, max_impulse: max_impulse});\r\n};\r\nPhysijs.ConeTwistConstraint.prototype.setMotorTarget = function (target) {\r\n  if (target instanceof THREE.Vector3) {\r\n    target = new THREE.Quaternion().setFromEuler(new THREE.Euler(target.x, target.y, target.z));\r\n  } else if (target instanceof THREE.Euler) {\r\n    target = new THREE.Quaternion().setFromEuler(target);\r\n  } else if (target instanceof THREE.Matrix4) {\r\n    target = new THREE.Quaternion().setFromRotationMatrix(target);\r\n  }\r\n  this.scene.execute('conetwist_setMotorTarget', {\r\n    constraint: this.id,\r\n    x: target.x,\r\n    y: target.y,\r\n    z: target.z,\r\n    w: target.w\r\n  });\r\n};\r\nPhysijs.ConeTwistConstraint.prototype.disableMotor = function () {\r\n  this.scene.execute('conetwist_disableMotor', {constraint: this.id});\r\n};\r\n\r\nPhysijs.DOFConstraint = function (objecta, objectb, position) {\r\n  if (position === undefined) {\r\n    position = objectb;\r\n    objectb = undefined;\r\n  }\r\n  this.type = 'dof';\r\n  this.appliedImpulse = 0;\r\n  this.id = getObjectId();\r\n  this.scene = objecta.parent;\r\n  this.objecta = objecta._physijs.id;\r\n  this.positiona = convertWorldPositionToObject(position, objecta).clone();\r\n  this.axisa = {x: objecta.rotation.x, y: objecta.rotation.y, z: objecta.rotation.z};\r\n\r\n  if (objectb) {\r\n    this.objectb = objectb._physijs.id;\r\n    this.positionb = convertWorldPositionToObject(position, objectb).clone();\r\n    this.axisb = {x: objectb.rotation.x, y: objectb.rotation.y, z: objectb.rotation.z};\r\n  }\r\n};\r\nPhysijs.DOFConstraint.prototype.getDefinition = function () {\r\n  return {\r\n    type: this.type,\r\n    id: this.id,\r\n    objecta: this.objecta,\r\n    objectb: this.objectb,\r\n    positiona: this.positiona,\r\n    positionb: this.positionb,\r\n    axisa: this.axisa,\r\n    axisb: this.axisb\r\n  };\r\n};\r\nPhysijs.DOFConstraint.prototype.setLinearLowerLimit = function (limit) {\r\n  this.scene.execute('dof_setLinearLowerLimit', {constraint: this.id, x: limit.x, y: limit.y, z: limit.z});\r\n};\r\nPhysijs.DOFConstraint.prototype.setLinearUpperLimit = function (limit) {\r\n  this.scene.execute('dof_setLinearUpperLimit', {constraint: this.id, x: limit.x, y: limit.y, z: limit.z});\r\n};\r\nPhysijs.DOFConstraint.prototype.setAngularLowerLimit = function (limit) {\r\n  this.scene.execute('dof_setAngularLowerLimit', {constraint: this.id, x: limit.x, y: limit.y, z: limit.z});\r\n};\r\nPhysijs.DOFConstraint.prototype.setAngularUpperLimit = function (limit) {\r\n  this.scene.execute('dof_setAngularUpperLimit', {constraint: this.id, x: limit.x, y: limit.y, z: limit.z});\r\n};\r\nPhysijs.DOFConstraint.prototype.enableAngularMotor = function (which) {\r\n  this.scene.execute('dof_enableAngularMotor', {constraint: this.id, which: which});\r\n};\r\nPhysijs.DOFConstraint.prototype.configureAngularMotor = function (which, low_angle, high_angle, velocity, max_force) {\r\n  this.scene.execute('dof_configureAngularMotor', {\r\n    constraint: this.id,\r\n    which: which,\r\n    low_angle: low_angle,\r\n    high_angle: high_angle,\r\n    velocity: velocity,\r\n    max_force: max_force\r\n  });\r\n};\r\nPhysijs.DOFConstraint.prototype.disableAngularMotor = function (which) {\r\n  this.scene.execute('dof_disableAngularMotor', {constraint: this.id, which: which});\r\n};\r\n\r\n// Physijs.Scene\r\nPhysijs.Scene = function (params) {\r\n  var self = this;\r\n\r\n  Eventable.call(this);\r\n  THREE.Scene.call(this);\r\n\r\n  this._worker = new Worker(Physijs.scripts.worker || 'physijs_worker.js');\r\n  this._worker.transferableMessage = this._worker.webkitPostMessage || this._worker.postMessage;\r\n  this._materials_ref_counts = {};\r\n  this._objects = {};\r\n  this._vehicles = {};\r\n  this._constraints = {};\r\n  this._is_simulating = false;\r\n\r\n  var ab = new ArrayBuffer(1);\r\n  this._worker.transferableMessage(ab, [ab]);\r\n  SUPPORT_TRANSFERABLE = ( ab.byteLength === 0 );\r\n\r\n  this._worker.onmessage = function (event) {\r\n    var _temp,\r\n      data = event.data;\r\n\r\n    if (data instanceof ArrayBuffer && data.byteLength !== 1) { // byteLength === 1 is the worker making a SUPPORT_TRANSFERABLE test\r\n      data = new Float32Array(data);\r\n    }\r\n\r\n    if (data instanceof Float32Array) {\r\n\r\n      // transferable object\r\n      switch (data[0]) {\r\n        case MESSAGE_TYPES.WORLDREPORT:\r\n          self._updateScene(data);\r\n          break;\r\n\r\n        case MESSAGE_TYPES.COLLISIONREPORT:\r\n          self._updateCollisions(data);\r\n          break;\r\n\r\n        case MESSAGE_TYPES.VEHICLEREPORT:\r\n          self._updateVehicles(data);\r\n          break;\r\n\r\n        case MESSAGE_TYPES.CONSTRAINTREPORT:\r\n          self._updateConstraints(data);\r\n          break;\r\n      }\r\n\r\n    } else {\r\n\r\n      if (data.cmd) {\r\n\r\n        // non-transferable object\r\n        switch (data.cmd) {\r\n          case 'objectReady':\r\n            _temp = data.params;\r\n            if (self._objects[_temp]) {\r\n              self._objects[_temp].dispatchEvent('ready');\r\n            }\r\n            break;\r\n\r\n          case 'worldReady':\r\n            self.dispatchEvent('ready');\r\n            break;\r\n\r\n          case 'vehicle':\r\n            window.test = data;\r\n            break;\r\n\r\n          default:\r\n            // Do nothing, just show the message\r\n            console.debug('Received: ' + data.cmd);\r\n            console.dir(data.params);\r\n            break;\r\n        }\r\n\r\n      } else {\r\n\r\n        switch (data[0]) {\r\n          case MESSAGE_TYPES.WORLDREPORT:\r\n            self._updateScene(data);\r\n            break;\r\n\r\n          case MESSAGE_TYPES.COLLISIONREPORT:\r\n            self._updateCollisions(data);\r\n            break;\r\n\r\n          case MESSAGE_TYPES.VEHICLEREPORT:\r\n            self._updateVehicles(data);\r\n            break;\r\n\r\n          case MESSAGE_TYPES.CONSTRAINTREPORT:\r\n            self._updateConstraints(data);\r\n            break;\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n  };\r\n\r\n\r\n  params = params || {};\r\n  params.ammo = Physijs.scripts.ammo || 'ammo.js';\r\n  params.fixedTimeStep = params.fixedTimeStep || 1 / 60;\r\n  params.rateLimit = params.rateLimit || true;\r\n  this.execute('init', params);\r\n\r\n  console.log(this._worker);\r\n};\r\n\r\nPhysijs.Scene.prototype = new THREE.Scene;\r\nPhysijs.Scene.prototype.constructor = Physijs.Scene;\r\nEventable.make(Physijs.Scene);\r\n\r\nPhysijs.Scene.prototype._updateScene = function (data) {\r\n  var num_objects = data[1],\r\n    object,\r\n    i, offset;\r\n\r\n  for (i = 0; i < num_objects; i++) {\r\n    offset = 2 + i * REPORT_ITEMSIZE;\r\n    object = this._objects[data[offset]];\r\n\r\n    if (object === undefined) {\r\n      continue;\r\n    }\r\n\r\n    if (object.__dirtyPosition === false) {\r\n      object.position.set(\r\n        data[offset + 1],\r\n        data[offset + 2],\r\n        data[offset + 3]\r\n      );\r\n    }\r\n\r\n    if (object.__dirtyRotation === false) {\r\n      object.quaternion.set(\r\n        data[offset + 4],\r\n        data[offset + 5],\r\n        data[offset + 6],\r\n        data[offset + 7]\r\n      );\r\n    }\r\n\r\n    object._physijs.linearVelocity.set(\r\n      data[offset + 8],\r\n      data[offset + 9],\r\n      data[offset + 10]\r\n    );\r\n\r\n    object._physijs.angularVelocity.set(\r\n      data[offset + 11],\r\n      data[offset + 12],\r\n      data[offset + 13]\r\n    );\r\n\r\n  }\r\n\r\n  if (SUPPORT_TRANSFERABLE) {\r\n    // Give the typed array back to the worker\r\n    this._worker.transferableMessage(data.buffer, [data.buffer]);\r\n  }\r\n\r\n  this._is_simulating = false;\r\n  this.dispatchEvent('update');\r\n};\r\n\r\nPhysijs.Scene.prototype._updateVehicles = function (data) {\r\n  var vehicle, wheel,\r\n    i, offset;\r\n\r\n  for (i = 0; i < ( data.length - 1 ) / VEHICLEREPORT_ITEMSIZE; i++) {\r\n    offset = 1 + i * VEHICLEREPORT_ITEMSIZE;\r\n    vehicle = this._vehicles[data[offset]];\r\n\r\n    if (vehicle === undefined) {\r\n      continue;\r\n    }\r\n\r\n    wheel = vehicle.wheels[data[offset + 1]];\r\n\r\n    wheel.position.set(\r\n      data[offset + 2],\r\n      data[offset + 3],\r\n      data[offset + 4]\r\n    );\r\n\r\n    wheel.quaternion.set(\r\n      data[offset + 5],\r\n      data[offset + 6],\r\n      data[offset + 7],\r\n      data[offset + 8]\r\n    );\r\n  }\r\n\r\n  if (SUPPORT_TRANSFERABLE) {\r\n    // Give the typed array back to the worker\r\n    this._worker.transferableMessage(data.buffer, [data.buffer]);\r\n  }\r\n};\r\n\r\nPhysijs.Scene.prototype._updateConstraints = function (data) {\r\n  var constraint, object,\r\n    i, offset;\r\n\r\n  for (i = 0; i < ( data.length - 1 ) / CONSTRAINTREPORT_ITEMSIZE; i++) {\r\n    offset = 1 + i * CONSTRAINTREPORT_ITEMSIZE;\r\n    constraint = this._constraints[data[offset]];\r\n    object = this._objects[data[offset + 1]];\r\n\r\n    if (constraint === undefined || object === undefined) {\r\n      continue;\r\n    }\r\n\r\n    _temp_vector3_1.set(\r\n      data[offset + 2],\r\n      data[offset + 3],\r\n      data[offset + 4]\r\n    );\r\n    _temp_matrix4_1.extractRotation(object.matrix);\r\n    _temp_vector3_1.applyMatrix4(_temp_matrix4_1);\r\n\r\n    constraint.positiona.addVectors(object.position, _temp_vector3_1);\r\n    constraint.appliedImpulse = data[offset + 5];\r\n  }\r\n\r\n  if (SUPPORT_TRANSFERABLE) {\r\n    // Give the typed array back to the worker\r\n    this._worker.transferableMessage(data.buffer, [data.buffer]);\r\n  }\r\n};\r\n\r\nPhysijs.Scene.prototype._updateCollisions = function (data) {\r\n  /**\r\n   * #TODO\r\n   * This is probably the worst way ever to handle collisions. The inherent evilness is a residual\r\n   * effect from the previous version's evilness which mutated when switching to transferable objects.\r\n   *\r\n   * If you feel inclined to make this better, please do so.\r\n   */\r\n\r\n  var i, j, offset, object, object2, id1, id2,\r\n    collisions = {}, normal_offsets = {};\r\n\r\n  // Build collision manifest\r\n  for (i = 0; i < data[1]; i++) {\r\n    offset = 2 + i * COLLISIONREPORT_ITEMSIZE;\r\n    object = data[offset];\r\n    object2 = data[offset + 1];\r\n\r\n    normal_offsets[object + '-' + object2] = offset + 2;\r\n    normal_offsets[object2 + '-' + object] = -1 * ( offset + 2 );\r\n\r\n    // Register collisions for both the object colliding and the object being collided with\r\n    if (!collisions[object]) collisions[object] = [];\r\n    collisions[object].push(object2);\r\n\r\n    if (!collisions[object2]) collisions[object2] = [];\r\n    collisions[object2].push(object);\r\n  }\r\n\r\n  // Deal with collisions\r\n  for (id1 in this._objects) {\r\n    if (!this._objects.hasOwnProperty(id1)) continue;\r\n    object = this._objects[id1];\r\n\r\n    // If object touches anything, ...\r\n    if (collisions[id1]) {\r\n\r\n      // Clean up touches array\r\n      for (j = 0; j < object._physijs.touches.length; j++) {\r\n        if (collisions[id1].indexOf(object._physijs.touches[j]) === -1) {\r\n          object._physijs.touches.splice(j--, 1);\r\n        }\r\n      }\r\n\r\n      // Handle each colliding object\r\n      for (j = 0; j < collisions[id1].length; j++) {\r\n        id2 = collisions[id1][j];\r\n        object2 = this._objects[id2];\r\n\r\n        if (object2) {\r\n          // If object was not already touching object2, notify object\r\n          if (object._physijs.touches.indexOf(id2) === -1) {\r\n            object._physijs.touches.push(id2);\r\n\r\n            _temp_vector3_1.subVectors(object.getLinearVelocity(), object2.getLinearVelocity());\r\n            _temp1 = _temp_vector3_1.clone();\r\n\r\n            _temp_vector3_1.subVectors(object.getAngularVelocity(), object2.getAngularVelocity());\r\n            _temp2 = _temp_vector3_1.clone();\r\n\r\n            var normal_offset = normal_offsets[object._physijs.id + '-' + object2._physijs.id];\r\n            if (normal_offset > 0) {\r\n              _temp_vector3_1.set(\r\n                -data[normal_offset],\r\n                -data[normal_offset + 1],\r\n                -data[normal_offset + 2]\r\n              );\r\n            } else {\r\n              normal_offset *= -1;\r\n              _temp_vector3_1.set(\r\n                data[normal_offset],\r\n                data[normal_offset + 1],\r\n                data[normal_offset + 2]\r\n              );\r\n            }\r\n\r\n            object.dispatchEvent('collision', object2, _temp1, _temp2, _temp_vector3_1);\r\n          }\r\n        }\r\n      }\r\n\r\n    } else {\r\n\r\n      // not touching other objects\r\n      object._physijs.touches.length = 0;\r\n\r\n    }\r\n\r\n  }\r\n\r\n  this.collisions = collisions;\r\n\r\n  if (SUPPORT_TRANSFERABLE) {\r\n    // Give the typed array back to the worker\r\n    this._worker.transferableMessage(data.buffer, [data.buffer]);\r\n  }\r\n};\r\n\r\nPhysijs.Scene.prototype.addConstraint = function (constraint, show_marker) {\r\n  this._constraints[constraint.id] = constraint;\r\n  this.execute('addConstraint', constraint.getDefinition());\r\n\r\n  if (show_marker) {\r\n    var marker;\r\n\r\n    switch (constraint.type) {\r\n      case 'point':\r\n        marker = new THREE.Mesh(\r\n          new THREE.SphereGeometry(1.5),\r\n          new THREE.MeshNormalMaterial\r\n        );\r\n        marker.position.copy(constraint.positiona);\r\n        this._objects[constraint.objecta].add(marker);\r\n        break;\r\n\r\n      case 'hinge':\r\n        marker = new THREE.Mesh(\r\n          new THREE.SphereGeometry(1.5),\r\n          new THREE.MeshNormalMaterial\r\n        );\r\n        marker.position.copy(constraint.positiona);\r\n        this._objects[constraint.objecta].add(marker);\r\n        break;\r\n\r\n      case 'slider':\r\n        marker = new THREE.Mesh(\r\n          new THREE.BoxGeometry(10, 1, 1),\r\n          new THREE.MeshNormalMaterial\r\n        );\r\n        marker.position.copy(constraint.positiona);\r\n        // This rotation isn't right if all three axis are non-0 values\r\n        // TODO: change marker's rotation order to ZYX\r\n        marker.rotation.set(\r\n          constraint.axis.y, // yes, y and\r\n          constraint.axis.x, // x axis are swapped\r\n          constraint.axis.z\r\n        );\r\n        this._objects[constraint.objecta].add(marker);\r\n        break;\r\n\r\n      case 'conetwist':\r\n        marker = new THREE.Mesh(\r\n          new THREE.SphereGeometry(1.5),\r\n          new THREE.MeshNormalMaterial\r\n        );\r\n        marker.position.copy(constraint.positiona);\r\n        this._objects[constraint.objecta].add(marker);\r\n        break;\r\n\r\n      case 'dof':\r\n        marker = new THREE.Mesh(\r\n          new THREE.SphereGeometry(1.5),\r\n          new THREE.MeshNormalMaterial\r\n        );\r\n        marker.position.copy(constraint.positiona);\r\n        this._objects[constraint.objecta].add(marker);\r\n        break;\r\n    }\r\n  }\r\n\r\n  return constraint;\r\n};\r\n\r\nPhysijs.Scene.prototype.onSimulationResume = function () {\r\n  this.execute('onSimulationResume', {});\r\n};\r\n\r\nPhysijs.Scene.prototype.removeConstraint = function (constraint) {\r\n  if (this._constraints[constraint.id] !== undefined) {\r\n    this.execute('removeConstraint', {id: constraint.id});\r\n    delete this._constraints[constraint.id];\r\n  }\r\n};\r\n\r\nPhysijs.Scene.prototype.execute = function (cmd, params) {\r\n  this._worker.postMessage({cmd: cmd, params: params});\r\n};\r\n\r\naddObjectChildren = function (parent, object) {\r\n  var i;\r\n\r\n  for (i = 0; i < object.children.length; i++) {\r\n    if (object.children[i]._physijs) {\r\n      object.children[i].updateMatrix();\r\n      object.children[i].updateMatrixWorld();\r\n\r\n      _temp_vector3_1.setFromMatrixPosition(object.children[i].matrixWorld);\r\n      _quaternion_1.setFromRotationMatrix(object.children[i].matrixWorld);\r\n\r\n      object.children[i]._physijs.position_offset = {\r\n        x: _temp_vector3_1.x,\r\n        y: _temp_vector3_1.y,\r\n        z: _temp_vector3_1.z\r\n      };\r\n\r\n      object.children[i]._physijs.rotation = {\r\n        x: _quaternion_1.x,\r\n        y: _quaternion_1.y,\r\n        z: _quaternion_1.z,\r\n        w: _quaternion_1.w\r\n      };\r\n\r\n      parent._physijs.children.push(object.children[i]._physijs);\r\n    }\r\n\r\n    addObjectChildren(parent, object.children[i]);\r\n  }\r\n};\r\n\r\nPhysijs.Scene.prototype.add = function (object) {\r\n  THREE.Mesh.prototype.add.call(this, object);\r\n\r\n  if (object._physijs) {\r\n\r\n    object.world = this;\r\n\r\n    if (object instanceof Physijs.Vehicle) {\r\n\r\n      this.add(object.mesh);\r\n      this._vehicles[object._physijs.id] = object;\r\n      this.execute('addVehicle', object._physijs);\r\n\r\n    } else {\r\n\r\n      object.__dirtyPosition = false;\r\n      object.__dirtyRotation = false;\r\n      this._objects[object._physijs.id] = object;\r\n\r\n      if (object.children.length) {\r\n        object._physijs.children = [];\r\n        addObjectChildren(object, object);\r\n      }\r\n\r\n      if (object.material._physijs) {\r\n        if (!this._materials_ref_counts.hasOwnProperty(object.material._physijs.id)) {\r\n          this.execute('registerMaterial', object.material._physijs);\r\n          object._physijs.materialId = object.material._physijs.id;\r\n          this._materials_ref_counts[object.material._physijs.id] = 1;\r\n        } else {\r\n          this._materials_ref_counts[object.material._physijs.id]++;\r\n        }\r\n      }\r\n\r\n      // Object starting position + rotation\r\n      object._physijs.position = {x: object.position.x, y: object.position.y, z: object.position.z};\r\n      object._physijs.rotation = {\r\n        x: object.quaternion.x,\r\n        y: object.quaternion.y,\r\n        z: object.quaternion.z,\r\n        w: object.quaternion.w\r\n      };\r\n\r\n      // Check for scaling\r\n      var mass_scaling = new THREE.Vector3(1, 1, 1);\r\n      if (object._physijs.width) {\r\n        object._physijs.width *= object.scale.x;\r\n      }\r\n      if (object._physijs.height) {\r\n        object._physijs.height *= object.scale.y;\r\n      }\r\n      if (object._physijs.depth) {\r\n        object._physijs.depth *= object.scale.z;\r\n      }\r\n\r\n      this.execute('addObject', object._physijs);\r\n\r\n    }\r\n  }\r\n};\r\n\r\nPhysijs.Scene.prototype.remove = function (object) {\r\n  if (object instanceof Physijs.Vehicle) {\r\n    this.execute('removeVehicle', {id: object._physijs.id});\r\n    while (object.wheels.length) {\r\n      this.remove(object.wheels.pop());\r\n    }\r\n    this.remove(object.mesh);\r\n    delete this._vehicles[object._physijs.id];\r\n  } else {\r\n    THREE.Mesh.prototype.remove.call(this, object);\r\n    if (object._physijs) {\r\n      delete this._objects[object._physijs.id];\r\n      this.execute('removeObject', {id: object._physijs.id});\r\n    }\r\n  }\r\n  if (object.material && object.material._physijs && this._materials_ref_counts.hasOwnProperty(object.material._physijs.id)) {\r\n    this._materials_ref_counts[object.material._physijs.id]--;\r\n    if (this._materials_ref_counts[object.material._physijs.id] == 0) {\r\n      this.execute('unRegisterMaterial', object.material._physijs);\r\n      delete this._materials_ref_counts[object.material._physijs.id];\r\n    }\r\n  }\r\n};\r\n\r\nPhysijs.Scene.prototype.setFixedTimeStep = function (fixedTimeStep) {\r\n  if (fixedTimeStep) {\r\n    this.execute('setFixedTimeStep', fixedTimeStep);\r\n  }\r\n};\r\n\r\nPhysijs.Scene.prototype.setGravity = function (gravity) {\r\n  if (gravity) {\r\n    this.execute('setGravity', gravity);\r\n  }\r\n};\r\n\r\nPhysijs.Scene.prototype.simulate = function (timeStep, maxSubSteps) {\r\n  var object_id, object, update;\r\n\r\n  if (this._is_simulating) {\r\n    return false;\r\n  }\r\n\r\n  this._is_simulating = true;\r\n\r\n  for (object_id in this._objects) {\r\n    if (!this._objects.hasOwnProperty(object_id)) continue;\r\n\r\n    object = this._objects[object_id];\r\n\r\n    if (object.__dirtyPosition || object.__dirtyRotation) {\r\n      update = {id: object._physijs.id};\r\n\r\n      if (object.__dirtyPosition) {\r\n        update.pos = {x: object.position.x, y: object.position.y, z: object.position.z};\r\n        object.__dirtyPosition = false;\r\n      }\r\n\r\n      if (object.__dirtyRotation) {\r\n        update.quat = {\r\n          x: object.quaternion.x,\r\n          y: object.quaternion.y,\r\n          z: object.quaternion.z,\r\n          w: object.quaternion.w\r\n        };\r\n        object.__dirtyRotation = false;\r\n      }\r\n\r\n      this.execute('updateTransform', update);\r\n    }\r\n  }\r\n\r\n  this.execute('simulate', {timeStep: timeStep, maxSubSteps: maxSubSteps});\r\n\r\n  return true;\r\n};\r\n\r\n\r\n// Phsijs.Mesh\r\nPhysijs.Mesh = function (geometry, material, mass) {\r\n  var index;\r\n\r\n  if (!geometry) {\r\n    return;\r\n  }\r\n\r\n  Eventable.call(this);\r\n  THREE.Mesh.call(this, geometry, material);\r\n\r\n  if (!geometry.boundingBox) {\r\n    geometry.computeBoundingBox();\r\n  }\r\n\r\n  this._physijs = {\r\n    type: null,\r\n    id: getObjectId(),\r\n    mass: mass || 0,\r\n    touches: [],\r\n    linearVelocity: new THREE.Vector3,\r\n    angularVelocity: new THREE.Vector3\r\n  };\r\n};\r\nPhysijs.Mesh.prototype = new THREE.Mesh;\r\nPhysijs.Mesh.prototype.constructor = Physijs.Mesh;\r\nEventable.make(Physijs.Mesh);\r\n\r\n// Physijs.Mesh.mass\r\nPhysijs.Mesh.prototype.__defineGetter__('mass', function () {\r\n  return this._physijs.mass;\r\n});\r\nPhysijs.Mesh.prototype.__defineSetter__('mass', function (mass) {\r\n  this._physijs.mass = mass;\r\n  if (this.world) {\r\n    this.world.execute('updateMass', {id: this._physijs.id, mass: mass});\r\n  }\r\n});\r\n\r\n// Physijs.Mesh.applyCentralImpulse\r\nPhysijs.Mesh.prototype.applyCentralImpulse = function (force) {\r\n  if (this.world) {\r\n    this.world.execute('applyCentralImpulse', {id: this._physijs.id, x: force.x, y: force.y, z: force.z});\r\n  }\r\n};\r\n\r\n// Physijs.Mesh.applyImpulse\r\nPhysijs.Mesh.prototype.applyImpulse = function (force, offset) {\r\n  if (this.world) {\r\n    this.world.execute('applyImpulse', {\r\n      id: this._physijs.id,\r\n      impulse_x: force.x,\r\n      impulse_y: force.y,\r\n      impulse_z: force.z,\r\n      x: offset.x,\r\n      y: offset.y,\r\n      z: offset.z\r\n    });\r\n  }\r\n};\r\n\r\n// Physijs.Mesh.applyTorque\r\nPhysijs.Mesh.prototype.applyTorque = function (force) {\r\n  if (this.world) {\r\n    this.world.execute('applyTorque', {\r\n      id: this._physijs.id,\r\n      torque_x: force.x,\r\n      torque_y: force.y,\r\n      torque_z: force.z\r\n    });\r\n  }\r\n};\r\n\r\n// Physijs.Mesh.applyCentralForce\r\nPhysijs.Mesh.prototype.applyCentralForce = function (force) {\r\n  if (this.world) {\r\n    this.world.execute('applyCentralForce', {id: this._physijs.id, x: force.x, y: force.y, z: force.z});\r\n  }\r\n};\r\n\r\n// Physijs.Mesh.applyForce\r\nPhysijs.Mesh.prototype.applyForce = function (force, offset) {\r\n  if (this.world) {\r\n    this.world.execute('applyForce', {\r\n      id: this._physijs.id,\r\n      force_x: force.x,\r\n      force_y: force.y,\r\n      force_z: force.z,\r\n      x: offset.x,\r\n      y: offset.y,\r\n      z: offset.z\r\n    });\r\n  }\r\n};\r\n\r\n// Physijs.Mesh.getAngularVelocity\r\nPhysijs.Mesh.prototype.getAngularVelocity = function () {\r\n  return this._physijs.angularVelocity;\r\n};\r\n\r\n// Physijs.Mesh.setAngularVelocity\r\nPhysijs.Mesh.prototype.setAngularVelocity = function (velocity) {\r\n  if (this.world) {\r\n    this.world.execute('setAngularVelocity', {id: this._physijs.id, x: velocity.x, y: velocity.y, z: velocity.z});\r\n  }\r\n};\r\n\r\n// Physijs.Mesh.getLinearVelocity\r\nPhysijs.Mesh.prototype.getLinearVelocity = function () {\r\n  return this._physijs.linearVelocity;\r\n};\r\n\r\n// Physijs.Mesh.setLinearVelocity\r\nPhysijs.Mesh.prototype.setLinearVelocity = function (velocity) {\r\n  if (this.world) {\r\n    this.world.execute('setLinearVelocity', {id: this._physijs.id, x: velocity.x, y: velocity.y, z: velocity.z});\r\n  }\r\n};\r\n\r\n// Physijs.Mesh.setAngularFactor\r\nPhysijs.Mesh.prototype.setAngularFactor = function (factor) {\r\n  if (this.world) {\r\n    this.world.execute('setAngularFactor', {id: this._physijs.id, x: factor.x, y: factor.y, z: factor.z});\r\n  }\r\n};\r\n\r\n// Physijs.Mesh.setLinearFactor\r\nPhysijs.Mesh.prototype.setLinearFactor = function (factor) {\r\n  if (this.world) {\r\n    this.world.execute('setLinearFactor', {id: this._physijs.id, x: factor.x, y: factor.y, z: factor.z});\r\n  }\r\n};\r\n\r\n// Physijs.Mesh.setDamping\r\nPhysijs.Mesh.prototype.setDamping = function (linear, angular) {\r\n  if (this.world) {\r\n    this.world.execute('setDamping', {id: this._physijs.id, linear: linear, angular: angular});\r\n  }\r\n};\r\n\r\n// Physijs.Mesh.setCcdMotionThreshold\r\nPhysijs.Mesh.prototype.setCcdMotionThreshold = function (threshold) {\r\n  if (this.world) {\r\n    this.world.execute('setCcdMotionThreshold', {id: this._physijs.id, threshold: threshold});\r\n  }\r\n};\r\n\r\n// Physijs.Mesh.setCcdSweptSphereRadius\r\nPhysijs.Mesh.prototype.setCcdSweptSphereRadius = function (radius) {\r\n  if (this.world) {\r\n    this.world.execute('setCcdSweptSphereRadius', {id: this._physijs.id, radius: radius});\r\n  }\r\n};\r\n\r\n\r\n// Physijs.PlaneMesh\r\nPhysijs.PlaneMesh = function (geometry, material, mass) {\r\n  var width, height;\r\n\r\n  Physijs.Mesh.call(this, geometry, material, mass);\r\n\r\n  if (!geometry.boundingBox) {\r\n    geometry.computeBoundingBox();\r\n  }\r\n\r\n  width = geometry.boundingBox.max.x - geometry.boundingBox.min.x;\r\n  height = geometry.boundingBox.max.y - geometry.boundingBox.min.y;\r\n\r\n  this._physijs.type = 'plane';\r\n  this._physijs.normal = geometry.faces[0].normal.clone();\r\n  this._physijs.mass = (typeof mass === 'undefined') ? width * height : mass;\r\n};\r\nPhysijs.PlaneMesh.prototype = new Physijs.Mesh;\r\nPhysijs.PlaneMesh.prototype.constructor = Physijs.PlaneMesh;\r\n\r\n// Physijs.HeightfieldMesh\r\nPhysijs.HeightfieldMesh = function (geometry, material, mass, xdiv, ydiv) {\r\n  Physijs.Mesh.call(this, geometry, material, mass);\r\n\r\n  this._physijs.type = 'heightfield';\r\n  this._physijs.xsize = geometry.boundingBox.max.x - geometry.boundingBox.min.x;\r\n  this._physijs.ysize = geometry.boundingBox.max.y - geometry.boundingBox.min.y;\r\n  this._physijs.xpts = (typeof xdiv === 'undefined') ? Math.sqrt(geometry.vertices.length) : xdiv + 1;\r\n  this._physijs.ypts = (typeof ydiv === 'undefined') ? Math.sqrt(geometry.vertices.length) : ydiv + 1;\r\n  // note - this assumes our plane geometry is square, unless we pass in specific xdiv and ydiv\r\n  this._physijs.absMaxHeight = Math.max(geometry.boundingBox.max.z, Math.abs(geometry.boundingBox.min.z));\r\n\r\n  var points = [];\r\n\r\n  var a, b;\r\n  for (var i = 0; i < geometry.vertices.length; i++) {\r\n\r\n    a = i % this._physijs.xpts;\r\n    b = Math.round(( i / this._physijs.xpts ) - ( (i % this._physijs.xpts) / this._physijs.xpts ));\r\n    points[i] = geometry.vertices[a + ( ( this._physijs.ypts - b - 1 ) * this._physijs.ypts )].z;\r\n\r\n    //points[i] = geometry.vertices[i];\r\n  }\r\n\r\n  this._physijs.points = points;\r\n};\r\nPhysijs.HeightfieldMesh.prototype = new Physijs.Mesh;\r\nPhysijs.HeightfieldMesh.prototype.constructor = Physijs.HeightfieldMesh;\r\n\r\n// Physijs.BoxMesh\r\nPhysijs.BoxMesh = function (geometry, material, mass) {\r\n  var width, height, depth;\r\n\r\n  Physijs.Mesh.call(this, geometry, material, mass);\r\n\r\n  if (!geometry.boundingBox) {\r\n    geometry.computeBoundingBox();\r\n  }\r\n\r\n  width = geometry.boundingBox.max.x - geometry.boundingBox.min.x;\r\n  height = geometry.boundingBox.max.y - geometry.boundingBox.min.y;\r\n  depth = geometry.boundingBox.max.z - geometry.boundingBox.min.z;\r\n\r\n  this._physijs.type = 'box';\r\n  this._physijs.width = width;\r\n  this._physijs.height = height;\r\n  this._physijs.depth = depth;\r\n  this._physijs.mass = (typeof mass === 'undefined') ? width * height * depth : mass;\r\n};\r\nPhysijs.BoxMesh.prototype = new Physijs.Mesh;\r\nPhysijs.BoxMesh.prototype.constructor = Physijs.BoxMesh;\r\n\r\n\r\n// Physijs.SphereMesh\r\nPhysijs.SphereMesh = function (geometry, material, mass) {\r\n  Physijs.Mesh.call(this, geometry, material, mass);\r\n\r\n  if (!geometry.boundingSphere) {\r\n    geometry.computeBoundingSphere();\r\n  }\r\n\r\n  this._physijs.type = 'sphere';\r\n  this._physijs.radius = geometry.boundingSphere.radius;\r\n  this._physijs.mass = (typeof mass === 'undefined') ? (4 / 3) * Math.PI * Math.pow(this._physijs.radius, 3) : mass;\r\n};\r\nPhysijs.SphereMesh.prototype = new Physijs.Mesh;\r\nPhysijs.SphereMesh.prototype.constructor = Physijs.SphereMesh;\r\n\r\n\r\n// Physijs.CylinderMesh\r\nPhysijs.CylinderMesh = function (geometry, material, mass) {\r\n  var width, height, depth;\r\n\r\n  Physijs.Mesh.call(this, geometry, material, mass);\r\n\r\n  if (!geometry.boundingBox) {\r\n    geometry.computeBoundingBox();\r\n  }\r\n\r\n  width = geometry.boundingBox.max.x - geometry.boundingBox.min.x;\r\n  height = geometry.boundingBox.max.y - geometry.boundingBox.min.y;\r\n  depth = geometry.boundingBox.max.z - geometry.boundingBox.min.z;\r\n\r\n  this._physijs.type = 'cylinder';\r\n  this._physijs.width = width;\r\n  this._physijs.height = height;\r\n  this._physijs.depth = depth;\r\n  this._physijs.mass = (typeof mass === 'undefined') ? width * height * depth : mass;\r\n};\r\nPhysijs.CylinderMesh.prototype = new Physijs.Mesh;\r\nPhysijs.CylinderMesh.prototype.constructor = Physijs.CylinderMesh;\r\n\r\n\r\n// Physijs.CapsuleMesh\r\nPhysijs.CapsuleMesh = function (geometry, material, mass) {\r\n  var width, height, depth;\r\n\r\n  Physijs.Mesh.call(this, geometry, material, mass);\r\n\r\n  if (!geometry.boundingBox) {\r\n    geometry.computeBoundingBox();\r\n  }\r\n\r\n  width = geometry.boundingBox.max.x - geometry.boundingBox.min.x;\r\n  height = geometry.boundingBox.max.y - geometry.boundingBox.min.y;\r\n  depth = geometry.boundingBox.max.z - geometry.boundingBox.min.z;\r\n\r\n  this._physijs.type = 'capsule';\r\n  this._physijs.radius = Math.max(width / 2, depth / 2);\r\n  this._physijs.height = height;\r\n  this._physijs.mass = (typeof mass === 'undefined') ? width * height * depth : mass;\r\n};\r\nPhysijs.CapsuleMesh.prototype = new Physijs.Mesh;\r\nPhysijs.CapsuleMesh.prototype.constructor = Physijs.CapsuleMesh;\r\n\r\n\r\n// Physijs.ConeMesh\r\nPhysijs.ConeMesh = function (geometry, material, mass) {\r\n  var width, height, depth;\r\n\r\n  Physijs.Mesh.call(this, geometry, material, mass);\r\n\r\n  if (!geometry.boundingBox) {\r\n    geometry.computeBoundingBox();\r\n  }\r\n\r\n  width = geometry.boundingBox.max.x - geometry.boundingBox.min.x;\r\n  height = geometry.boundingBox.max.y - geometry.boundingBox.min.y;\r\n\r\n  this._physijs.type = 'cone';\r\n  this._physijs.radius = width / 2;\r\n  this._physijs.height = height;\r\n  this._physijs.mass = (typeof mass === 'undefined') ? width * height : mass;\r\n};\r\nPhysijs.ConeMesh.prototype = new Physijs.Mesh;\r\nPhysijs.ConeMesh.prototype.constructor = Physijs.ConeMesh;\r\n\r\n\r\n// Physijs.ConcaveMesh\r\nPhysijs.ConcaveMesh = function (geom, material, mass, cGeometry, cScale) {\r\n  var i,\r\n    width, height, depth,\r\n    vertices, face,\r\n    geometry = cGeometry ? cGeometry : geom,\r\n    triangles = new Array(geometry.faces.length);\r\n\r\n  Physijs.Mesh.call(this, geom, material, mass);\r\n\r\n  if (!geometry.boundingBox) {\r\n    geometry.computeBoundingBox();\r\n  }\r\n\r\n  cScale = cScale || {x: 1, y: 1, z: 1};\r\n  cScale.x = cScale.x || 1;\r\n  cScale.y = cScale.y || 1;\r\n  cScale.z = cScale.z || 1;\r\n\r\n  vertices = geometry.vertices;\r\n\r\n  for (i = 0; i < geometry.faces.length; i++) {\r\n    face = geometry.faces[i];\r\n\r\n    triangles[i] = [\r\n      {x: vertices[face.a].x * cScale.x, y: vertices[face.a].y * cScale.y, z: vertices[face.a].z * cScale.z},\r\n      {x: vertices[face.b].x * cScale.x, y: vertices[face.b].y * cScale.y, z: vertices[face.b].z * cScale.z},\r\n      {x: vertices[face.c].x * cScale.x, y: vertices[face.c].y * cScale.y, z: vertices[face.c].z * cScale.z}\r\n    ];\r\n  }\r\n\r\n  width = geometry.boundingBox.max.x - geometry.boundingBox.min.x;\r\n  height = geometry.boundingBox.max.y - geometry.boundingBox.min.y;\r\n  depth = geometry.boundingBox.max.z - geometry.boundingBox.min.z;\r\n\r\n  this._physijs.type = 'concave';\r\n  this._physijs.triangles = triangles;\r\n  this._physijs.mass = (typeof mass === 'undefined') ? width * height * depth : mass;\r\n};\r\nPhysijs.ConcaveMesh.prototype = new Physijs.Mesh;\r\nPhysijs.ConcaveMesh.prototype.constructor = Physijs.ConcaveMesh;\r\n\r\n\r\n// Physijs.ConvexMesh\r\nPhysijs.ConvexMesh = function (geometry, material, mass) {\r\n  var i,\r\n    width, height, depth,\r\n    points = [];\r\n\r\n  Physijs.Mesh.call(this, geometry, material, mass);\r\n\r\n  if (!geometry.boundingBox) {\r\n    geometry.computeBoundingBox();\r\n  }\r\n\r\n  for (i = 0; i < geometry.vertices.length; i++) {\r\n    points.push({\r\n      x: geometry.vertices[i].x,\r\n      y: geometry.vertices[i].y,\r\n      z: geometry.vertices[i].z\r\n    });\r\n  }\r\n\r\n\r\n  width = geometry.boundingBox.max.x - geometry.boundingBox.min.x;\r\n  height = geometry.boundingBox.max.y - geometry.boundingBox.min.y;\r\n  depth = geometry.boundingBox.max.z - geometry.boundingBox.min.z;\r\n\r\n  this._physijs.type = 'convex';\r\n  this._physijs.points = points;\r\n  this._physijs.mass = (typeof mass === 'undefined') ? width * height * depth : mass;\r\n};\r\nPhysijs.ConvexMesh.prototype = new Physijs.Mesh;\r\nPhysijs.ConvexMesh.prototype.constructor = Physijs.ConvexMesh;\r\n\r\n\r\n// Physijs.Vehicle\r\nPhysijs.Vehicle = function (mesh, tuning) {\r\n  tuning = tuning || new Physijs.VehicleTuning;\r\n  this.mesh = mesh;\r\n  this.wheels = [];\r\n  this._physijs = {\r\n    id: getObjectId(),\r\n    rigidBody: mesh._physijs.id,\r\n    suspension_stiffness: tuning.suspension_stiffness,\r\n    suspension_compression: tuning.suspension_compression,\r\n    suspension_damping: tuning.suspension_damping,\r\n    max_suspension_travel: tuning.max_suspension_travel,\r\n    friction_slip: tuning.friction_slip,\r\n    max_suspension_force: tuning.max_suspension_force\r\n  };\r\n};\r\nPhysijs.Vehicle.prototype.addWheel = function (wheel_geometry, wheel_material, connection_point, wheel_direction, wheel_axle, suspension_rest_length, wheel_radius, is_front_wheel, tuning) {\r\n  var wheel = new THREE.Mesh(wheel_geometry, wheel_material);\r\n  wheel.castShadow = wheel.receiveShadow = true;\r\n  wheel.position.copy(wheel_direction).multiplyScalar(suspension_rest_length / 100).add(connection_point);\r\n  this.world.add(wheel);\r\n  this.wheels.push(wheel);\r\n\r\n  this.world.execute('addWheel', {\r\n    id: this._physijs.id,\r\n    connection_point: {x: connection_point.x, y: connection_point.y, z: connection_point.z},\r\n    wheel_direction: {x: wheel_direction.x, y: wheel_direction.y, z: wheel_direction.z},\r\n    wheel_axle: {x: wheel_axle.x, y: wheel_axle.y, z: wheel_axle.z},\r\n    suspension_rest_length: suspension_rest_length,\r\n    wheel_radius: wheel_radius,\r\n    is_front_wheel: is_front_wheel,\r\n    tuning: tuning\r\n  });\r\n};\r\nPhysijs.Vehicle.prototype.setSteering = function (amount, wheel) {\r\n  if (wheel !== undefined && this.wheels[wheel] !== undefined) {\r\n    this.world.execute('setSteering', {id: this._physijs.id, wheel: wheel, steering: amount});\r\n  } else if (this.wheels.length > 0) {\r\n    for (var i = 0; i < this.wheels.length; i++) {\r\n      this.world.execute('setSteering', {id: this._physijs.id, wheel: i, steering: amount});\r\n    }\r\n  }\r\n};\r\nPhysijs.Vehicle.prototype.setBrake = function (amount, wheel) {\r\n  if (wheel !== undefined && this.wheels[wheel] !== undefined) {\r\n    this.world.execute('setBrake', {id: this._physijs.id, wheel: wheel, brake: amount});\r\n  } else if (this.wheels.length > 0) {\r\n    for (var i = 0; i < this.wheels.length; i++) {\r\n      this.world.execute('setBrake', {id: this._physijs.id, wheel: i, brake: amount});\r\n    }\r\n  }\r\n};\r\nPhysijs.Vehicle.prototype.applyEngineForce = function (amount, wheel) {\r\n  if (wheel !== undefined && this.wheels[wheel] !== undefined) {\r\n    this.world.execute('applyEngineForce', {id: this._physijs.id, wheel: wheel, force: amount});\r\n  } else if (this.wheels.length > 0) {\r\n    for (var i = 0; i < this.wheels.length; i++) {\r\n      this.world.execute('applyEngineForce', {id: this._physijs.id, wheel: i, force: amount});\r\n    }\r\n  }\r\n};\r\n\r\n// Physijs.VehicleTuning\r\nPhysijs.VehicleTuning = function (suspension_stiffness, suspension_compression, suspension_damping, max_suspension_travel, friction_slip, max_suspension_force) {\r\n  this.suspension_stiffness = suspension_stiffness !== undefined ? suspension_stiffness : 5.88;\r\n  this.suspension_compression = suspension_compression !== undefined ? suspension_compression : 0.83;\r\n  this.suspension_damping = suspension_damping !== undefined ? suspension_damping : 0.88;\r\n  this.max_suspension_travel = max_suspension_travel !== undefined ? max_suspension_travel : 500;\r\n  this.friction_slip = friction_slip !== undefined ? friction_slip : 10.5;\r\n  this.max_suspension_force = max_suspension_force !== undefined ? max_suspension_force : 6000;\r\n};\r\n\r\nexport {\r\n  Physijs as default\r\n};\r\n"]}